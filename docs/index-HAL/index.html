<!DOCTYPE HTML>
<html lang="en-US">
<head profile="http://www.w3.org/2005/10/profile">
  <meta charset="UTF-8">
  <title>Hardware Abstract Layer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="generator" content="Jekyll v3.1.6">
  <!--  <link rel="alternate" type="application/rss+xml" title="Jekyll • Simple, blog-aware, static sites - Feed" href="/feed.xml"> -->

  


  <link rel="alternate" type="application/atom+xml" title="Recent commits to Machinekit's master branch" href="https://github.com/machinekit/machinekit/commits/master.atom">
  <link href='http://fonts.googleapis.com/css?family=Alegreya+Sans' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Alegreya+Sans+SC' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/screen.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!--[if lt IE 9]>
  <script src="/js/html5shiv.js"></script>
  <script src="/js/respond.min.js"></script>
  <![endif]-->
  <link rel="icon" type="image/png" href="/images/favicon.png" />
</head>


<body class="wrap">
  <header>
  <nav class="mobile-nav show-on-mobiles">
    <ul>
  <li class="">
    <a href="/">Home</a>
  </li>
  <li class="">
    <a href="/about/">About</a>
  </li>
  <li class="">
    <a href="/community/home">
      <span class="hide-on-mobiles">Community</span>
      <span class="show-on-mobiles">Community</span>
    </a>
  </li>
  <li class="current">
    <a href="/docs/">
      <span class="hide-on-mobiles">Documentation</span>
      <span class="show-on-mobiles">Docs</span>
    </a>
  </li>
  <li class="">
    <a href="http://blog.machinekit.io/">Blog</a>
  <li>
  <li>
    <a href="https://github.com/machinekit/machinekit">GitHub</a>
  </li>
</ul>

  </nav>
  <div class="grid">
      <div class="unit one-quarter hide-on-mobiles" >
        <img id='logo' src="/images/gear-256px-color.png"> 
      </div>
         
    <div class="unit three-quarters">
      <h1 id="maintitle" class="hide-on-mobiles">Machinekit</h1>
      <h1 id="maintitle-mobile" class="show-on-mobiles">Machinekit</h1>
       <nav class="main-nav hide-on-mobiles">
         <ul>
  <li class="">
    <a href="/">Home</a>
  </li>
  <li class="">
    <a href="/about/">About</a>
  </li>
  <li class="">
    <a href="/community/home">
      <span class="hide-on-mobiles">Community</span>
      <span class="show-on-mobiles">Community</span>
    </a>
  </li>
  <li class="current">
    <a href="/docs/">
      <span class="hide-on-mobiles">Documentation</span>
      <span class="show-on-mobiles">Docs</span>
    </a>
  </li>
  <li class="">
    <a href="http://blog.machinekit.io/">Blog</a>
  <li>
  <li>
    <a href="https://github.com/machinekit/machinekit">GitHub</a>
  </li>
</ul>

       </nav>
    </div>
  </div>
</header>


  <div id="content">
    <section class="docs">
    <div class="grid">

      <div class="docs-nav-mobile unit whole show-on-mobiles">
  <select onchange="if (this.value) window.location.href=this.value">
    <option value="">Navigate the docs…</option>
    
    <optgroup label="For starters">
      


  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="http://test.machinekit.io/docs/index-getting-started/">Getting Started</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="http://test.machinekit.io/docs/index-user/">Machinekit Introduction</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="http://test.machinekit.io/docs/index-HAL/">Hardware Abstract Layer</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="http://test.machinekit.io/docs/getting-help/">Getting help</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


    </optgroup>
    
    <optgroup label="Developing">
      


  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="http://test.machinekit.io/docs/index-integrator/">Integrator Manual</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="http://test.machinekit.io/docs/index-developer/">Developer manual</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="http://test.machinekit.io/docs/documenting/documenting/">Documenting</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="http://test.machinekit.io/docs/developing/develop-index/">Various developing links</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


    </optgroup>
    
    <optgroup label="Manpages">
      


  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="http://test.machinekit.io/docs/man/man1/">HAL Utilities and GUIs</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="http://test.machinekit.io/docs/man/man3/">RTAPI and HAL Functions</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="http://test.machinekit.io/docs/man/man9/">HAL Components</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


    </optgroup>
    
  </select>
</div>


      <div class="unit four-fifths">
        <article>
          <h1>Hardware Abstract Layer</h1>
          <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#hal-introduction">HAL Introduction</a>
<ul class="sectlevel2">
<li><a href="#hal-is-based-on-traditional-system-design-techniques">HAL is based on traditional system design techniques</a></li>
<li><a href="#hal-concepts-a-id-sec-hal-concepts-a">HAL Concepts<a id="sec:HAL-Concepts"></a></a></li>
<li><a href="#hal-components-a-id-sec-intro-hal-components-a">HAL components<a id="sec:Intro-HAL-components"></a></a></li>
<li><a href="#timing-issues-in-hal-a-id-sec-timing-issues-a">Timing Issues In HAL<a id="sec:Timing-Issues"></a></a></li>
</ul>
</li>
<li><a href="#basic-hal-tutorial">Basic HAL Tutorial</a>
<ul class="sectlevel2">
<li><a href="#sec:Hal-Commands">HAL Commands</a></li>
<li><a href="#sec:Hal-Data">HAL Data</a></li>
<li><a href="#hal-files">HAL Files</a></li>
<li><a href="#hal-components">HAL Components</a></li>
<li><a href="#logic-components">Logic Components</a></li>
<li><a href="#conversion-components">Conversion Components</a></li>
</ul>
</li>
<li><a href="#advanced-hal-tutorial">Advanced HAL Tutorial</a>
<ul class="sectlevel2">
<li><a href="#introduction-a-id-sec-tutorial-intro-a">Introduction<a id="sec:Tutorial-Intro"></a></a></li>
<li><a href="#a-simple-example-a-id-sec-tutorial-simple-example-a">A Simple Example<a id="sec:Tutorial-Simple-Example"></a></a></li>
<li><a href="#halmeter-a-id-sec-tutorial-halmeter-a">Halmeter<a id="sec:Tutorial-Halmeter"></a></a></li>
<li><a href="#stepgen-example">Stepgen Example</a></li>
<li><a href="#halscope-a-id-sec-tutorial-halscope-a">Halscope<a id="sec:Tutorial-Halscope"></a></a></li>
</ul>
</li>
<li><a href="#hal-examples">HAL Examples</a>
<ul class="sectlevel2">
<li><a href="#manual-toolchange">Manual Toolchange</a></li>
<li><a href="#compute-velocity">Compute Velocity</a></li>
<li><a href="#soft-start">Soft Start</a></li>
<li><a href="#stand-alone-hal">Stand Alone HAL</a></li>
</ul>
</li>
<li><a href="#general-reference">General Reference</a>
<ul class="sectlevel2">
<li><a href="#cha:general-reference">General Naming Conventions<a id="sec:GR-Naming-Conventions"></a></a></li>
<li><a href="#sec:GR-Driver-Naming">Hardware Driver Naming Conventions</a></li>
</ul>
</li>
<li><a href="#parallel-port-driver">Parallel Port Driver</a>
<ul class="sectlevel2">
<li><a href="#parport">Parport</a></li>
<li><a href="#sec:probe_parport">probe_parport</a></li>
</ul>
</li>
<li><a href="#hal-component-descriptions">HAL Component Descriptions</a>
<ul class="sectlevel2">
<li><a href="#sec:Stepgen">Stepgen</a></li>
<li><a href="#sec:PWMgen">PWMgen</a></li>
<li><a href="#sec:Encoder">Encoder</a></li>
<li><a href="#sec:PID">PID</a></li>
<li><a href="#simulated-encoder-a-id-sec-simulated-encoder-a">Simulated Encoder<a id="sec:Simulated-Encoder"></a></a></li>
<li><a href="#sec:Debounce">Debounce</a></li>
<li><a href="#siggen-a-id-sec-siggen-a">Siggen<a id="sec:Siggen"></a></a></li>
<li><a href="#sec:lut5">lut5</a></li>
</ul>
</li>
<li><a href="#creating-userspace-python-components">Creating Userspace Python Components</a>
<ul class="sectlevel2">
<li><a href="#basic-usage">Basic usage</a></li>
<li><a href="#userspace-components-and-delays">Userspace components and delays</a></li>
<li><a href="#create-pins-and-parameters">Create pins and parameters</a></li>
<li><a href="#reading-and-writing-pins-and-parameters">Reading and writing pins and parameters</a></li>
<li><a href="#exiting">Exiting</a></li>
<li><a href="#project-ideas">Project ideas</a></li>
</ul>
</li>
<li><a href="#canonical-device-interfaces">Canonical Device Interfaces</a>
<ul class="sectlevel2">
<li><a href="#cha:Canonical-Device-Interfaces">Introduction</a></li>
<li><a href="#digital-input-a-id-sec-canondigin-a">Digital Input<a id="sec:CanonDigIn"></a></a></li>
<li><a href="#digital-output-a-id-sec-canondigout-a">Digital Output<a id="sec:CanonDigOut"></a></a></li>
<li><a href="#analog-input">Analog Input</a></li>
<li><a href="#analog-output">Analog Output</a></li>
</ul>
</li>
<li><a href="#hal-tools">HAL Tools</a>
<ul class="sectlevel2">
<li><a href="#halcmd-a-id-sec-halcmd-a">Halcmd<a id="sec:Halcmd"></a></a></li>
<li><a href="#halmeter-a-id-sec-halmeter-a">Halmeter<a id="sec:Halmeter"></a></a></li>
<li><a href="#halscope-a-id-sec-halscope-a">Halscope<a id="sec:Halscope"></a></a></li>
</ul>
</li>
<li><a href="#halshow">Halshow</a>
<ul class="sectlevel2">
<li><a href="#starting-halshow">Starting Halshow</a></li>
<li><a href="#hal-tree-area">HAL Tree Area</a></li>
<li><a href="#hal-show-area">HAL Show Area</a></li>
<li><a href="#hal-watch-area">HAL Watch Area</a></li>
</ul>
</li>
<li><a href="#developing">Developing</a></li>
<li><a href="#instcomp-hal-component-generator">instcomp HAL Component Generator</a>
<ul class="sectlevel2">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#naming-conventions">Naming Conventions</a></li>
<li><a href="#definitions">Definitions</a></li>
<li><a href="#instance-creation">Instance creation</a></li>
<li><a href="#instanceparams">Instanceparams</a></li>
<li><a href="#backwards-compatability">Backwards compatability</a></li>
<li><a href="#reserved-declarations-etc">Reserved declarations etc.</a></li>
<li><a href="#extra-args">Extra args</a></li>
<li><a href="#syntax-and-options-differences">Syntax and Options differences</a></li>
<li><a href="#options">Options</a></li>
<li><a href="#restrictions">Restrictions</a></li>
<li><a href="#compiling">Compiling</a></li>
<li><a href="#examples">Examples</a></li>
</ul>
</li>
<li><a href="#comp-hal-component-generator">Comp HAL Component Generator</a>
<ul class="sectlevel2">
<li><a href="#introduction-2">Introduction</a></li>
<li><a href="#installing-3">Installing</a></li>
<li><a href="#definitions-2">Definitions</a></li>
<li><a href="#instance-creation-2">Instance creation</a></li>
<li><a href="#implicit-parameters">Implicit Parameters</a></li>
<li><a href="#syntax">Syntax</a></li>
<li><a href="#restrictions-2">Restrictions</a></li>
<li><a href="#convenience-macros">Convenience Macros</a></li>
<li><a href="#components-with-one-function">Components with one function</a></li>
<li><a href="#component-personality">Component Personality</a></li>
<li><a href="#compiling-2">Compiling</a></li>
<li><a href="#sec:Compiling-realtime-components">Compiling realtime components outside the source tree</a></li>
<li><a href="#compiling-userspace-components-outside-the-source-tree">Compiling userspace components outside the source tree</a></li>
<li><a href="#examples-2">Examples</a></li>
</ul>
</li>
<li><a href="#hardware-drivers">Hardware Drivers</a>
<ul class="sectlevel1">
<li><a href="#ax5214h-driver">AX5214H Driver</a>
<ul class="sectlevel2">
<li><a href="#installing-4">Installing</a></li>
<li><a href="#pins-6">Pins</a></li>
<li><a href="#parameters-6">Parameters</a></li>
<li><a href="#functions-5">Functions</a></li>
</ul>
</li>
<li><a href="#gs2-vfd-driver">GS2 VFD Driver</a>
<ul class="sectlevel2">
<li><a href="#command-line-options">Command Line Options</a></li>
<li><a href="#pins-7">Pins</a></li>
<li><a href="#parameters-7">Parameters</a></li>
</ul>
</li>
<li><a href="#vfs11-vfd-driver">VFS11 VFD Driver</a>
<ul class="sectlevel2">
<li><a href="#command-line-options-2">Command Line Options</a></li>
<li><a href="#pins-8">Pins</a></li>
<li><a href="#parameters-8">Parameters</a></li>
<li><a href="#ini-file-configuration">INI file configuration</a></li>
<li><a href="#hal-example">HAL example</a></li>
<li><a href="#panel-operation">Panel operation</a></li>
<li><a href="#error-recovery">Error Recovery</a></li>
<li><a href="#configuring-the-vfs11-vfd-for-modbus-usage">Configuring the VFS11 VFD for Modbus usage</a></li>
<li><a href="#programming-note">Programming Note</a></li>
</ul>
</li>
<li><a href="#mesa-hostmot2-driver">Mesa HostMot2 Driver</a>
<ul class="sectlevel2">
<li><a href="#introduction-3">Introduction</a></li>
<li><a href="#firmware-binaries">Firmware Binaries</a></li>
<li><a href="#installing-firmware">Installing Firmware</a></li>
<li><a href="#loading-hostmot2">Loading HostMot2</a></li>
<li><a href="#watchdog">Watchdog</a></li>
<li><a href="#hostmot2-functions">HostMot2 Functions</a></li>
<li><a href="#pinouts">Pinouts</a></li>
<li><a href="#pin-files">PIN Files</a></li>
<li><a href="#firmware">Firmware</a></li>
<li><a href="#hal-pins">HAL Pins</a></li>
<li><a href="#configurations">Configurations</a></li>
<li><a href="#gpio">GPIO</a></li>
<li><a href="#stepgen">StepGen</a></li>
<li><a href="#pwmgen">PWMGen</a></li>
<li><a href="#encoder">Encoder</a></li>
<li><a href="#5i25-configuration">5i25 Configuration</a></li>
<li><a href="#example-configurations">Example Configurations</a></li>
</ul>
</li>
<li><a href="#motenc-driver">Motenc Driver</a>
<ul class="sectlevel2">
<li><a href="#pins-14">Pins</a></li>
<li><a href="#parameters-14">Parameters</a></li>
<li><a href="#functions-7">Functions</a></li>
</ul>
</li>
<li><a href="#opto22-driver">Opto22 Driver</a>
<ul class="sectlevel2">
<li><a href="#the-adapter-card">The Adapter Card</a></li>
<li><a href="#the-driver">The Driver</a></li>
<li><a href="#pins-15">Pins</a></li>
<li><a href="#parameters-15">Parameters</a></li>
<li><a href="#functions-8">FUNCTIONS</a></li>
<li><a href="#configuring-i-o-ports">Configuring I/O Ports</a></li>
<li><a href="#pin-numbering">Pin Numbering</a></li>
</ul>
</li>
<li><a href="#pico-drivers">Pico Drivers</a>
<ul class="sectlevel2">
<li><a href="#command-line-options-3">Command Line Options</a></li>
<li><a href="#pins-16">Pins</a></li>
<li><a href="#parameters-16">Parameters</a></li>
<li><a href="#functions-9">Functions</a></li>
</ul>
</li>
<li><a href="#pluto-p-driver">Pluto P Driver</a>
<ul class="sectlevel2">
<li><a href="#general-info">General Info</a></li>
<li><a href="#pluto-servo-a-id-sec-pluto-servo-a">Pluto Servo<a id="sec:pluto-servo"></a></a></li>
<li><a href="#pluto-step-a-id-sec-pluto-step-hardware-step-a">Pluto Step<a id="sec:Pluto-step:-Hardware-step"></a></a></li>
</ul>
</li>
<li><a href="#servo-to-go-driver">Servo To Go Driver</a>
<ul class="sectlevel2">
<li><a href="#installing-5">Installing</a></li>
<li><a href="#pins-17">Pins</a></li>
<li><a href="#parameters-17">Parameters</a></li>
</ul>
</li>
<li><a href="#general-mechatronics-driver">General Mechatronics Driver</a>
<ul class="sectlevel2">
<li><a href="#i-o-connectors">I/O connectors</a></li>
<li><a href="#axis-connectors">Axis connectors</a></li>
<li><a href="#can-bus-servo-amplifiers">CAN-bus servo amplifiers</a></li>
<li><a href="#watchdog-timer">Watchdog timer</a></li>
<li><a href="#end-homing-and-e-stop-switches">End-, homing- and E-stop switches</a></li>
<li><a href="#status-leds">Status LEDs</a></li>
<li><a href="#rs485-i-o-expander-modules">RS485 I/O expander modules</a></li>
<li><a href="#errata">Errata</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="hal-introduction">HAL Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:hal-introduction"></a> </p>
</div>
<div class="paragraph">
<p>HAL stands for Hardware Abstraction Layer. At the highest
level, it is simply a way to allow a number of 'building blocks' to be
loaded and interconnected to assemble a complex system. The 'Hardware'
part is because HAL was originally designed to make it easier to
configure Machinekit for a wide variety of hardware devices. Many of the
building blocks are drivers for hardware devices. However, HAL can do
more than just configure hardware drivers.</p>
</div>
<div class="sect2">
<h3 id="hal-is-based-on-traditional-system-design-techniques">HAL is based on traditional system design techniques</h3>
<div class="paragraph">
<p>HAL is based on the same principles that are used to design hardware
circuits and systems, so it is useful to examine those principles
first.</p>
</div>
<div class="paragraph">
<p>Any system (including a CNC machine), consists of
interconnected components. For the CNC machine, those components might
be the main controller, servo amps or stepper drives, motors, encoders,
limit switches, pushbutton pendants, perhaps a VFD for the spindle
drive, a PLC to run a toolchanger, etc. The machine builder must
select, mount and wire these pieces together to make a complete system.</p>
</div>
<div class="sect3">
<h4 id="part-selection">Part Selection</h4>
<div class="paragraph">
<p>The machine builder does not need to worry about how each individual
part works. He treats them as black boxes. During the design stage, he
decides which parts he is going to use - steppers or servos, which
brand of servo amp, what kind of limit switches and how many, etc. The
integrator&#8217;s decisions about which specific components to use is based
on what that component does and the specifications supplied by the
manufacturer of the device. The size of a motor and the load it must
drive will affect the choice of amplifier needed to run it. The choice
of amplifier may affect the kinds of feedback needed by the amp and the
velocity or position signals that must be sent to the amp from a
control.</p>
</div>
<div class="paragraph">
<p>In the HAL world, the integrator must decide what HAL components are
needed. Usually every interface card will require a driver. Additional
components may be needed for software generation of step pulses, PLC
functionality, and a wide variety of other tasks.</p>
</div>
</div>
<div class="sect3">
<h4 id="interconnection-design">Interconnection Design</h4>
<div class="paragraph">
<p>The designer of a hardware system not only selects the parts, he also
decides how those parts will be interconnected. Each black box has
terminals, perhaps only two for a simple switch, or dozens for a servo
drive or PLC. They need to be wired together. The motors connect to the
servo amps, the limit switches connect to the controller, and so on. As
the machine builder works on the design, he creates a large wiring
diagram that shows how all the parts should be interconnected.</p>
</div>
<div class="paragraph">
<p>When using HAL, components are interconnected by signals. The designer
must decide which signals are needed, and what they should connect.</p>
</div>
</div>
<div class="sect3">
<h4 id="implementation">Implementation</h4>
<div class="paragraph">
<p>Once the wiring diagram is complete it is time to build the machine.
The pieces need to be acquired and mounted, and then they are
interconnected according to the wiring diagram. In a physical system,
each interconnection is a piece of wire that needs to be cut and
connected to the appropriate terminals.</p>
</div>
<div class="paragraph">
<p>HAL provides a number of tools to help 'build' a HAL system. Some of
the tools allow you to 'connect' (or disconnect) a single 'wire'. Other
tools allow you to save a complete list of all the parts, wires, and
other information about the system, so that it can be 'rebuilt' with a
single command.</p>
</div>
</div>
<div class="sect3">
<h4 id="testing">Testing</h4>
<div class="paragraph">
<p>Very few machines work right the first time. While testing, the
builder may use a meter to see whether a limit switch is working or to
measure the DC voltage going to a servo motor. He may hook up an
oscilloscope to check the tuning of a drive, or to look for electrical
noise. He may find a problem that requires the wiring diagram to be
changed; perhaps a part needs to be connected differently or replaced
with something completely different.</p>
</div>
<div class="paragraph">
<p>HAL provides the software equivalents of a voltmeter, oscilloscope,
signal generator, and other tools needed for testing and tuning a
system. The same commands used to build the system can be used to make
changes as needed.</p>
</div>
</div>
<div class="sect3">
<h4 id="summary">Summary</h4>
<div class="paragraph">
<p>This document is aimed at people who already know how to do this kind
of hardware system integration, but who do not know how to connect the
hardware to Machinekit. See the <a href="#sec:Remote-Start-Example">Remote Start
Example</a> section in the HAL UI Examples documentation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://preview.machinekit.io/docs/hal/images/remote-start.png" alt="remote start">
</div>
</div>
<div class="paragraph">
<p>The traditional hardware design as described above ends at the edge of
the main control. Outside the control are a bunch of relatively simple
boxes, connected together to do whatever is needed. Inside, the control
is a big mystery&#8201;&#8212;&#8201;one huge black box that we hope works.</p>
</div>
<div class="paragraph">
<p>HAL extends this traditional hardware design method to the inside of
the big black box. It makes device drivers and even some internal parts
of the controller into smaller black boxes that can be interconnected
and even replaced just like the external hardware. It allows the
'system wiring diagram' to show part of the internal controller, rather
than just a big black box. And most importantly, it allows the
integrator to test and modify the controller using the same methods he
would use on the rest of the hardware.</p>
</div>
<div class="paragraph">
<p>Terms like motors, amps, and encoders are familiar to most machine
integrators. When we talk about using extra flexible eight conductor
shielded cable to connect an encoder to the servo input board in the
computer, the reader immediately understands what it is and is led to
the question, 'what kinds of connectors will I need to make up each
end.' The same sort of thinking is essential for the HAL but the
specific train of thought may take a bit to get on track. Using HAL
words may seem a bit strange at first, but the concept of working from
one connection to the next is the same.</p>
</div>
<div class="paragraph">
<p>This idea of extending the wiring diagram to the inside of the
controller is what HAL is all about. If you are comfortable with the
idea of interconnecting hardware black boxes, you will probably have
little trouble using HAL to interconnect software black boxes.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hal-concepts-a-id-sec-hal-concepts-a">HAL Concepts<a id="sec:HAL-Concepts"></a></h3>
<div class="paragraph">
<p>This section is a glossary that defines key HAL terms but it is a bit
different than a traditional glossary because these terms are not
arranged in alphabetical order. They are arranged by their relationship
or flow in the HAL way of things.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Component</dt>
<dd>
<p> When we talked about hardware design, we referred
to the individual pieces as 'parts', 'building blocks', 'black boxes',
etc. The HAL equivalent is a 'component' or 'HAL component'. (This
document uses 'HAL component' when there is likely to be confusion with
other kinds of components, but normally just uses 'component'.) A HAL
component is a piece of software with well-defined inputs, outputs, and
behavior, that can be installed and interconnected as needed.</p>
</dd>
<dt class="hdlist1">Parameter</dt>
<dd>
<p> Many hardware components have adjustments that
are not connected to any other components but still need to be
accessed. For example, servo amps often have trim pots to allow for
tuning adjustments, and test points where a meter or scope can be
attached to view the tuning results. HAL components also can have such
items, which are referred to as 'parameters'. There are two types of
parameters: Input parameters are equivalent to trim pots - they are
values that can be adjusted by the user, and remain fixed once they are
set. Output parameters cannot be adjusted by the user - they are
equivalent to test points that allow internal signals to be monitored.</p>
</dd>
<dt class="hdlist1">Pin</dt>
<dd>
<p> Hardware components have terminals which are used to
interconnect them. The HAL equivalent is a 'pin' or 'HAL pin'. ('HAL
pin' is used when needed to avoid confusion.) All HAL pins are named,
and the pin names are used when interconnecting them. HAL pins are
software entities that exist only inside the computer.</p>
</dd>
<dt class="hdlist1">Physical_Pin</dt>
<dd>
<p> Many I/O devices have real physical pins or
terminals that connect to external hardware, for example the pins of a
parallel port connector. To avoid confusion, these are referred to as
'physical pins'. These are the things that 'stick out' into the real
world.</p>
</dd>
<dt class="hdlist1">Signal</dt>
<dd>
<p> In a physical machine, the terminals of real
hardware components are interconnected by wires. The HAL equivalent of
a wire is a 'signal' or 'HAL signal'. HAL signals connect HAL pins
together as required by the machine builder. HAL signals can be
disconnected and reconnected at will (even while the machine is
running).</p>
</dd>
<dt class="hdlist1">Type</dt>
<dd>
<p> When using real hardware, you would not connect a 24
volt relay output to the +/-10V analog input of a servo amp. HAL pins
have the same restrictions, which are based upon their type. Both pins
and signals have types, and signals can only be connected to pins of
the same type. Currently there are 4 types, as follows:</p>
<div class="ulist">
<ul>
<li>
<p>bit - a single TRUE/FALSE or ON/OFF value</p>
</li>
<li>
<p>float - a 64 bit floating point value, with approximately 53 bits of
resolution and over 1000 bits of dynamic range.</p>
</li>
<li>
<p>u32 - a 32 bit unsigned integer, legal values are 0 to 4,294,967,295</p>
</li>
<li>
<p>s32 - a 32 bit signed integer, legal values are -2,147,483,647 to
+2,147,483,647</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Function</dt>
<dd>
<p>Real hardware components tend to
act immediately on their inputs. For example, if the input voltage to a
servo amp changes, the output also changes automatically. However
software components cannot act 'automatically'. Each component has
specific code that must be executed to do whatever that component is
supposed to do. In some cases, that code simply runs as part of the
component. However in most cases, especially in realtime components,
the code must run in a specific sequence and at specific intervals. For
example, inputs should be read before calculations are performed on the
input data, and outputs should not be written until the calculations
are done. In these cases, the code is made available to the system in
the form of one or more 'functions'. Each function is a block of code
that performs a specific action. The system integrator can use
'threads' to schedule a series of functions to be executed in a
particular order and at specific time intervals.</p>
</dd>
<dt class="hdlist1">Thread</dt>
<dd>
<p>A 'thread' is a list of functions that
runs at specific intervals as part of a realtime task. When a thread is
first created, it has a specific time interval (period), but no
functions. Functions can be added to the thread, and will be executed
in order every time the thread runs.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>As an example, suppose we have a parport component named hal_parport.
That component defines one or more HAL pins for each physical pin. The
pins are described in that component&#8217;s doc section: their names, how
each pin relates to the physical pin, are they inverted, can you change
polarity, etc. But that alone doesn&#8217;t get the data from the HAL pins to
the physical pins. It takes code to do that, and that is where
functions come into the picture. The parport component needs at least
two functions: one to read the physical input pins and update the HAL
pins, the other to take data from the HAL pins and write it to the
physical output pins. Both of these functions are part of the parport
driver.</p>
</div>
</div>
<div class="sect2">
<h3 id="hal-components-a-id-sec-intro-hal-components-a">HAL components<a id="sec:Intro-HAL-components"></a></h3>
<div class="paragraph">
<p>Each HAL component is a piece of software with well-defined inputs,
outputs, and behavior, that can be installed and interconnected as
needed. This section lists some of the available components and a brief
description of what each does. Complete details for each component are
available later in this document.</p>
</div>
<div class="sect3">
<h4 id="external-programs-with-hal-hooks-a-id-sub-externalprograms-a">External Programs with HAL hooks<a id="sub:ExternalPrograms"></a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1">motion</dt>
<dd>
<p> A realtime module that accepts NML
<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup> motion commands and interacts with HAL</p>
</dd>
<dt class="hdlist1">iocontrol</dt>
<dd>
<p>  A user space module that accepts NML I/O commands and
interacts with HAL</p>
</dd>
<dt class="hdlist1">classicladder</dt>
<dd>
<p> A PLC using HAL for all I/O</p>
</dd>
<dt class="hdlist1">halui</dt>
<dd>
<p>  A user space program that interacts with HAL and sends NML
commands, it is intended to work as a full User Interface using
external knobs &amp; switches</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="internal-components-a-id-sub-internalcomponents-a">Internal Components<a id="sub:InternalComponents"></a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1">stepgen</dt>
<dd>
<p>Software step pulse generator with position loop. See section <a href="#sec:Stepgen">Stepgen</a></p>
</dd>
<dt class="hdlist1">encoder</dt>
<dd>
<p>Software based encoder counter. See section <a href="#sec:Encoder">Encoder</a></p>
</dd>
<dt class="hdlist1">pid</dt>
<dd>
<p>Proportional/Integral/Derivative control loops. See section <a href="#sec:PID">PID</a></p>
</dd>
<dt class="hdlist1">siggen</dt>
<dd>
<p> A sine/cosine/triangle/square wave generator for testing.
See section <a href="#sec:Siggen">[sec:Siggen]</a></p>
</dd>
<dt class="hdlist1">supply</dt>
<dd>
<p>a simple source for testing</p>
</dd>
<dt class="hdlist1">blocks</dt>
<dd>
<p> assorted useful components (mux, demux, or, and, integ,
ddt, limit, wcomp, etc.)</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="hardware-drivers-a-id-sub-hardwaredrivers-a">Hardware Drivers<a id="sub:HardwareDrivers"></a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1">hal_ax5214h</dt>
<dd>
<p>  A driver for the Axiom Measurement &amp; Control AX5241H
digital I/O board</p>
</dd>
<dt class="hdlist1">hal_gm</dt>
<dd>
<p> General Mechatronics GM6-PCI board</p>
</dd>
<dt class="hdlist1">hal_m5i20</dt>
<dd>
<p> Mesa Electronics 5i20 board</p>
</dd>
<dt class="hdlist1">hal_motenc</dt>
<dd>
<p> Vital Systems MOTENC-100 board</p>
</dd>
<dt class="hdlist1">hal_parport</dt>
<dd>
<p> PC parallel port.</p>
</dd>
<dt class="hdlist1">hal_ppmc</dt>
<dd>
<p> Pico Systems family of controllers (PPMC, USC and UPC)</p>
</dd>
<dt class="hdlist1">hal_stg</dt>
<dd>
<p> Servo To Go card (version 1 &amp; 2)</p>
</dd>
<dt class="hdlist1">hal_vti</dt>
<dd>
<p> Vigilant Technologies PCI ENCDAC-4 controller</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="tools-and-utilities-a-id-sub-toolsutilities-a">Tools and Utilities<a id="sub:ToolsUtilities"></a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1">halcmd</dt>
<dd>
<p>  Command line tool for configuration and tuning. See
section <a href="#sec:Halcmd">[sec:Halcmd]</a></p>
</dd>
<dt class="hdlist1">halgui</dt>
<dd>
<p>GUI tool for configuration and tuning (not implemented yet).</p>
</dd>
<dt class="hdlist1">halmeter</dt>
<dd>
<p> A handy multimeter for HAL signals. See section <a href="#sec:Halmeter">[sec:Halmeter]</a>.</p>
</dd>
<dt class="hdlist1">halscope</dt>
<dd>
<p>  A full featured digital storage oscilloscope for HAL
signals. See section <a href="#sec:Halscope">[sec:Halscope]</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Each of these building blocks is described in detail in later chapters.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="timing-issues-in-hal-a-id-sec-timing-issues-a">Timing Issues In HAL<a id="sec:Timing-Issues"></a></h3>
<div class="paragraph">
<p>Unlike the physical wiring models between black boxes that we have
said that HAL is based upon, simply connecting two pins with a
hal-signal falls far short of the action of the physical case.</p>
</div>
<div class="paragraph">
<p>True relay logic consists of relays connected together, and when a
contact opens or closes, current flows (or stops) immediately. Other
coils may change state, etc, and it all just 'happens'. But in PLC
style ladder logic, it doesn&#8217;t work that way. Usually in a single pass
through the ladder, each rung is evaluated in the order in which it
appears, and only once per pass. A perfect example is a single rung
ladder, with a NC contact in series with a coil. The contact and coil
belong to the same relay.</p>
</div>
<div class="paragraph">
<p>If this were a conventional relay, as soon as the coil is energized,
the contacts begin to open and de-energize it. That means the contacts
close again, etc, etc. The relay becomes a buzzer.</p>
</div>
<div class="paragraph">
<p>With a PLC, if the coil is OFF and the contact is closed when the PLC
begins to evaluate the rung, then when it finishes that pass, the coil
is ON. The fact that turning on the coil opens the contact feeding it
is ignored until the next pass. On the next pass, the PLC sees that the
contact is open, and de-energizes the coil. So the relay still switches
rapidly between on and off, but at a rate determined by how often the
PLC evaluates the rung.</p>
</div>
<div class="paragraph">
<p>In HAL, the function is the code that evaluates the rung(s). In fact,
the HAL-aware realtime version of ClassicLadder exports a function to
do exactly that. Meanwhile, a thread is the thing that runs the
function at specific time intervals. Just like you can choose to have a
PLC evaluate all its rungs every 10 ms, or every second, you can define
HAL threads with different periods.</p>
</div>
<div class="paragraph">
<p>What distinguishes one thread from another is 'not' what the thread
does - that is determined by which functions are
connected to it. The real distinction is simply how often a thread
runs.</p>
</div>
<div class="paragraph">
<p>In Machinekit you might have a 50 us thread and a 1 ms thread.
These would be created based on BASE_PERIOD and SERVO_PERIOD, the
actual times depend on the values in your ini file.</p>
</div>
<div class="paragraph">
<p>The next step is to decide what each thread needs to do. Some of those
decisions are the same in (nearly) any Machinekit system&#8212;&#8203;For instance,
motion-command-handler is always added to servo-thread.</p>
</div>
<div class="paragraph">
<p>Other connections would be made by the integrator. These might include
hooking the STG driver&#8217;s encoder read and DAC write functions to the
servo thread, or hooking stepgen&#8217;s function to the base-thread, along
with the parport function(s) to write the steps to the port.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="basic-hal-tutorial">Basic HAL Tutorial</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:basic-hal-tutorial"></a> </p>
</div>
<div class="sect2">
<h3 id="sec:Hal-Commands">HAL Commands</h3>
<div class="paragraph">
<p>More detailed information can be found in the man page for halcmd 'man
halcmd' in a terminal window. To see the HAL configuration and check
the status of pins and parameters use the HAL Configuration window on
the Machine menu in AXIS. To watch a pin status open the Watch tab and
click on each pin you wish to watch and it will be added to the watch
window.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../hal/images/HAL_Configuration.png" alt="HAL Configuration">
</div>
<div class="title">Figure 1. HAL Configuration Window<a id="cap:HAL-Configuration-Window"></a></div>
</div>
<div class="sect3">
<h4 id="loadrt-a-id-sub-loadrt-a">loadrt <a id="sub:loadrt"></a> </h4>
<div class="paragraph">
<p>The command 'loadrt' loads a real time HAL component. Real time
component functions need to be added to a thread to be updated at the
rate of the thread. You cannot load a user space component into the
real time space.</p>
</div>
<div class="paragraph">
<p>The syntax and an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt &lt;component&gt; &lt;options&gt;

loadrt mux4 count=1</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="addf-a-id-sub-addf-a">addf <a id="sub:addf"></a> </h4>
<div class="paragraph">
<p>The command 'addf' adds a real time component function to a thread.
You have to add a function from a HAL real time component to a thread
to get the function to update at the rate of the thread.</p>
</div>
<div class="paragraph">
<p>If you used the Stepper Config Wizard to generate your config you will
have two threads.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>base-thread (the high-speed thread): this thread handles items that
need a fast response, like making step pulses, and reading and writing
the parallel port.</p>
</li>
<li>
<p>servo-thread (the slow-speed thread): this thread handles items that
can tolerate a slower response, like the motion controller,
ClassicLadder, and the motion command handler.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The syntax and an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>addf &lt;component&gt; &lt;thread&gt;

addf mux4 servo-thread</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="loadusr-a-id-sub-loadusr-a">loadusr <a id="sub:loadusr"></a> </h4>
<div class="paragraph">
<p>The command 'loadusr' loads a user space HAL component. User space
programs are their own separate processes, which optionally talk to
other HAL components via pins and parameters. You cannot load real time
components into user space.</p>
</div>
<div class="paragraph">
<p>Flags may be one or more of the following:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
-W
</td>
<td class="hdlist2">
<p>to wait for the component to become ready. The component is assumed to
have the same name as the first argument of the command.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
-Wn &lt;name&gt;
</td>
<td class="hdlist2">
<p>to wait for the component, which will have the given &lt;name&gt;.
This only applies if the component has a name option.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
-w
</td>
<td class="hdlist2">
<p>to wait for the program to exit</p>
</td>
</tr>
<tr>
<td class="hdlist1">
-i
</td>
<td class="hdlist2">
<p>to ignore the program return value (with -w)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
-n
</td>
<td class="hdlist2">
<p>name a component when it is a valid option for that component.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The syntax and examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadusr &lt;component&gt; &lt;options&gt;

loadusr halui

loadusr -Wn spindle gs2_vfd -n spindle</pre>
</div>
</div>
<div class="paragraph">
<p>In English it means 'loadusr wait for name spindle component gs2_vfd name spindle'.</p>
</div>
</div>
<div class="sect3">
<h4 id="net-a-id-sub-net-a">net <a id="sub:net"></a> </h4>
<div class="paragraph">
<p>The command 'net' creates a 'connection' between a signal and and one
or more pins. If the signal does not exist net creates the new signal.
This replaces the need to use the command newsig. The optional direction
indicators '&#8656;', '&#8658;' and '&lt;&#8658;' are only to make it easier for humans to follow
the logic and are not used by the net command.</p>
</div>
<div class="listingblock">
<div class="title">Syntax and Example:</div>
<div class="content">
<pre>net signal-name &lt;pin-name&gt; &lt;optional direction&gt; (&lt;pin-name&gt;|&lt;direction&gt;)

net home-x axis.0.home-sw-in &lt;= parport.0.pin-11-in</pre>
</div>
</div>
<div class="paragraph">
<p>In the above example 'home-x' is the signal name, 'axis.0.home-sw-in' is a
'Direction IN' pin, '&#8656;' is the optional direction indicator, and
'parport.0.pin-11-in' is a 'Direction OUT' pin. This may seem confusing but
the in and out labels for a parallel port pin indicates the physical way the
pin works not how it is handled in HAL.</p>
</div>
<div class="paragraph">
<p>A pin can be connected to a signal if it obeys the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An IN pin can always be connected to a signal</p>
</li>
<li>
<p>An IO pin can be connected unless there&#8217;s an OUT pin on the signal</p>
</li>
<li>
<p>An OUT pin can be connected only if there are no other OUT or IO pins
on the signal</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The same &lt;signal-name&gt; can be used in multiple net commands to connect
additional pins, as long as the rules above are obeyed.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../hal/images/signal-direction.png" alt="signal direction">
</div>
<div class="title">Figure 2. Signal Direction<a id="cap:Signal-Direction"></a></div>
</div>
<div class="paragraph">
<p>This example shows the signal xStep with the source being
stepgen.0.out and with two readers, parport.0.pin-02-out and
parport.0.pin-08-out. Basically the value of stepgen.0.out is sent to
the signal xStep and that value is then sent to parport.0.pin-02-out
and parport.0.pin-08-out.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#   signal    source            destination          destination
net xStep stepgen.0.out =&gt; parport.0.pin-02-out parport.0.pin-08-out</pre>
</div>
</div>
<div class="paragraph">
<p>Since the signal xStep contains the value of stepgen.0.out (the
source) you can use the same signal again to send the value to another
reader. To do this just use the signal with the readers on another
line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>net xStep =&gt; parport.0.pin-02-out</pre>
</div>
</div>
<div class="paragraph">
<div class="title">I/O pins</div>
<p>An I/O pin like encoder.N.index-enable can be read or set as allowed by the component.</p>
</div>
</div>
<div class="sect3">
<h4 id="setp-a-id-sub-setp-a">setp <a id="sub:setp"></a> </h4>
<div class="paragraph">
<p>The command 'setp' sets the value of a pin or parameter. The valid
values will depend on the type of the pin or parameter. It is an error
if the data types do not match.</p>
</div>
<div class="paragraph">
<p>Some components have parameters that need to be set before use.
Parameters can be set before use or while running as needed. You cannot
use setp on a pin that is connected to a signal.</p>
</div>
<div class="paragraph">
<p>The syntax and an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>setp &lt;pin/parameter-name&gt; &lt;value&gt;

setp parport.0.pin-08-out TRUE</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sets-a-id-sub-sets-a">sets <a id="sub:sets"></a> </h4>
<div class="paragraph">
<p>The command 'sets' sets the value of a signal.</p>
</div>
<div class="paragraph">
<p>The syntax and an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sets &lt;signal-name&gt; &lt;value&gt;

net mysignal and2.0.in0 pyvcp.my-led

sets mysignal 1</pre>
</div>
</div>
<div class="paragraph">
<p>It is an error if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The signal-name does not exist</p>
</li>
<li>
<p>If the signal already has a writer</p>
</li>
<li>
<p>If value is not the correct type for the signal</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="unlinkp">unlinkp</h4>
<div class="paragraph">
<p>The command 'unlinkp' unlinks a pin from the connected signal. If no
signal was connected to the pin prior running the command, nothing
happens. The 'unlinkp' command is useful for trouble shooting.</p>
</div>
<div class="paragraph">
<p>The syntax and an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>unlinkp &lt;pin-name&gt;

unlinkp parport.0.pin-02-out</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="obsolete-commands">Obsolete Commands</h4>
<div class="paragraph">
<p>The following commands are depreciated and may be removed from future
versions. Any new configuration should use the <a href="#sub:net">'net'</a> command.
These commands are included so older configurations will still work.</p>
</div>
<div class="sect4">
<h5 id="linksp">linksp</h5>
<div class="paragraph">
<p>The command 'linksp' creates a 'connection' between a signal and one
pin.</p>
</div>
<div class="paragraph">
<p>The syntax and an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>linksp &lt;signal-name&gt; &lt;pin-name&gt;
linksp X-step parport.0.pin-02-out</pre>
</div>
</div>
<div class="paragraph">
<p>The 'linksp' command has been superseded by the 'net' command.</p>
</div>
</div>
<div class="sect4">
<h5 id="linkps">linkps</h5>
<div class="paragraph">
<p>The command 'linkps' creates a 'connection' between one pin and one
signal. It is the same as linksp but the arguments are reversed.</p>
</div>
<div class="paragraph">
<p>The syntax and an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>linkps &lt;pin-name&gt; &lt;signal-name&gt;

linkps parport.0.pin-02-out X-Step</pre>
</div>
</div>
<div class="paragraph">
<p>The 'linkps' command has been superseded by the 'net' command.</p>
</div>
</div>
<div class="sect4">
<h5 id="newsig">newsig</h5>
<div class="paragraph">
<p>the command 'newsig' creates a new HAL signal by the name &lt;signame&gt;
and the data type of &lt;type&gt;. Type must be 'bit', 's32', 'u32' or
'float'. Error if &lt;signame&gt; all ready exists.</p>
</div>
<div class="paragraph">
<p>The syntax and an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>newsig &lt;signame&gt; &lt;type&gt;

newsig Xstep bit</pre>
</div>
</div>
<div class="paragraph">
<p>More information can be found in the HAL manual or the man pages for
halrun.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec:Hal-Data">HAL Data</h3>
<div class="sect3">
<h4 id="bit">Bit </h4>
<div class="paragraph">
<p>A bit value is an on or off.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>bit values = true or 1 and false or 0 (True, TRUE, true are all valid)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="float">Float </h4>
<div class="paragraph">
<p>A 'float' is a floating point number. In other words the decimal point
can move as needed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>float values = a 32 bit floating point value, with approximately 24
bits of resolution and over 200 bits of dynamic range.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on floating point numbers see:</p>
</div>
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/Floating_point">http://en.wikipedia.org/wiki/Floating_point</a></p>
</div>
</div>
<div class="sect3">
<h4 id="s32">s32 </h4>
<div class="paragraph">
<p>An 's32' number is a whole number that can have a negative or positive
value.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>s32 values = integer numbers -2147483648 to 2147483647</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="u32">u32 </h4>
<div class="paragraph">
<p>A 'u32' number is a whole number that is positive only.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>u32 values = integer numbers 0 to 4294967295</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hal-files">HAL Files</h3>
<div class="paragraph">
<p>If you used the Stepper Config Wizard to generate your config you will
have up to three HAL files in your config directory.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>my-mill.hal (if your config is named 'my-mill') This file is loaded
first and should not be changed if you used the Stepper Config Wizard.</p>
</li>
<li>
<p>custom.hal This file is loaded next and before the GUI loads. This is
where you put your custom HAL commands that you want loaded before the
GUI is loaded.</p>
</li>
<li>
<p>custom_postgui.hal This file is loaded after the GUI loads. This is
where you put your custom HAL commands that you want loaded after the
GUI is loaded. Any HAL commands that use pyVCP widgets need to be
placed here.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="hal-components">HAL Components</h3>
<div class="paragraph">
<p>Two parameters are automatically added to each HAL component when it
is created. These parameters allow you to scope the execution time of a
component.</p>
</div>
<div class="paragraph">
<p>.time</p>
</div>
<div class="paragraph">
<p>.tmax</p>
</div>
<div class="paragraph">
<p>Time is the number of CPU cycles it took to execute the function.</p>
</div>
<div class="paragraph">
<p>Tmax is the maximum number of CPU cycles it took to execute the
function. Tmax is a read/write parameter so the user can set it to 0 to
get rid of the first time initialization on the function&#8217;s execution
time.</p>
</div>
</div>
<div class="sect2">
<h3 id="logic-components">Logic Components</h3>
<div class="paragraph">
<p>HAL contains several real time logic components. Logic components
follow a 'Truth Table' that states what the output is for any given
input. Typically these are bit manipulators and follow electrical logic
gate truth tables.</p>
</div>
<div class="sect3">
<h4 id="and2">and2</h4>
<div class="paragraph">
<p>The 'and2' component is a two input 'and' gate. The truth table below
shows the output based on each combination of input.</p>
</div>
<div class="paragraph">
<p>Syntax</p>
</div>
<div class="listingblock">
<div class="content">
<pre>and2 [count=N] | [names=name1[,name2...]]</pre>
</div>
</div>
<div class="paragraph">
<p>Functions</p>
</div>
<div class="paragraph">
<p>and2.n</p>
</div>
<div class="paragraph">
<p>Pins</p>
</div>
<div class="literalblock">
<div class="content">
<pre>and2.N.in0 (bit, in)
and2.N.in1 (bit, in)
and2.N.out (bit, out)</pre>
</div>
</div>
<div class="paragraph">
<p>Truth Table</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">in0</th>
<th class="tableblock halign-left valign-top">in1</th>
<th class="tableblock halign-left valign-top">out</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="not">not</h4>
<div class="paragraph">
<p>The 'not' component is a bit inverter.</p>
</div>
<div class="paragraph">
<p>Syntax</p>
</div>
<div class="listingblock">
<div class="content">
<pre>not [count=n] | [names=name1[,name2...]]</pre>
</div>
</div>
<div class="paragraph">
<p>Functions</p>
</div>
<div class="literalblock">
<div class="content">
<pre>not.all
not.n</pre>
</div>
</div>
<div class="paragraph">
<p>Pins</p>
</div>
<div class="literalblock">
<div class="content">
<pre>not.n.in (bit, in)
not.n.out (bit, out)</pre>
</div>
</div>
<div class="paragraph">
<p>Truth Table</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">in</th>
<th class="tableblock halign-left valign-top">out</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="or2">or2</h4>
<div class="paragraph">
<p>The 'or2' component is a two input OR gate.</p>
</div>
<div class="paragraph">
<p>Syntax</p>
</div>
<div class="listingblock">
<div class="content">
<pre>or2[count=n] | [names=name1[,name2...]]</pre>
</div>
</div>
<div class="paragraph">
<p>Functions</p>
</div>
<div class="paragraph">
<p>or2.n</p>
</div>
<div class="paragraph">
<p>Pins</p>
</div>
<div class="literalblock">
<div class="content">
<pre>or2.n.in0 (bit, in)
or2.n.in1 (bit, in)
or2.n.out (bit, out)</pre>
</div>
</div>
<div class="paragraph">
<p>Truth Table</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">in0</th>
<th class="tableblock halign-left valign-top">in1</th>
<th class="tableblock halign-left valign-top">out</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="xor2">xor2</h4>
<div class="paragraph">
<p>The 'xor2' component is a two input XOR (exclusive OR)gate.</p>
</div>
<div class="paragraph">
<p>Syntax</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xor2[count=n] | [names=name1[,name2...]]</pre>
</div>
</div>
<div class="paragraph">
<p>Functions</p>
</div>
<div class="paragraph">
<p>xor2.n</p>
</div>
<div class="paragraph">
<p>Pins</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xor2.n.in0 (bit, in)
xor2.n.in1 (bit, in)
xor2.n.out (bit, out)</pre>
</div>
</div>
<div class="paragraph">
<p>Truth Table</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">in0</th>
<th class="tableblock halign-left valign-top">in1</th>
<th class="tableblock halign-left valign-top">out</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="logic-examples">Logic Examples</h4>
<div class="paragraph">
<p>An 'and2' example connecting two inputs to one output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt and2 count=1

addf and2.0 servo-thread

net my-sigin1 and2.0.in0 &lt;= parport.0.pin-11-in

net my-sigin2 and2.0.in1 &lt;= parport.0.pin-12-in

net both-on parport.0.pin-14-out &lt;= and2.0.out</pre>
</div>
</div>
<div class="paragraph">
<p>In the above example one copy of and2 is loaded into real time space
and added to the servo thread. Next pin 11 of the parallel port is
connected to the in0 bit of the and gate. Next pin 12 is connected to
the in1 bit of the and gate. Last we connect the and2 out bit to the
parallel port pin 14. So following the truth table for and2 if pin 11
and pin 12 are on then the output pin 14 will be on.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="conversion-components">Conversion Components</h3>
<div class="sect3">
<h4 id="weighted_sum">weighted_sum</h4>
<div class="paragraph">
<p>The weighted_sum converts a group of bits to an integer. The
conversion is the sum of the 'weights' of the bits that are on plus any
offset. The weight of the m-th bit is 2^m. This is similar to a binary
coded decimal but with more options. The 'hold' bit stops processing the
input changes so the 'sum' will not change.</p>
</div>
<div class="paragraph">
<p>The following syntax is used to load the weighted_sum component.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt weighted_sum wsum_sizes=size[,size,...]</pre>
</div>
</div>
<div class="paragraph">
<p>Creates weighted sum groups each with the given number of input bits
(size).</p>
</div>
<div class="paragraph">
<p>To update the weighted_sum you need to attach process_wsums to a thread.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>addf process_wsums servo-thread</pre>
</div>
</div>
<div class="paragraph">
<p>This updates the weighted_sum component.</p>
</div>
<div class="paragraph">
<p>In the following example clipped from the HAL Configuration window in
Axis the bits '0' and '2' are true and there is no offset. The 'weight'
of 0 is 1 and the 'weight' of 2 is 4 so the sum is 5.</p>
</div>
<div class="listingblock">
<div class="title">weighted_sum</div>
<div class="content">
<pre>Component Pins:
Owner   Type  Dir         Value  Name
    10  bit   In           TRUE  wsum.0.bit.0.in
    10  s32   I/O             1  wsum.0.bit.0.weight
    10  bit   In          FALSE  wsum.0.bit.1.in
    10  s32   I/O             2  wsum.0.bit.1.weight
    10  bit   In           TRUE  wsum.0.bit.2.in
    10  s32   I/O             4  wsum.0.bit.2.weight
    10  bit   In          FALSE  wsum.0.bit.3.in
    10  s32   I/O             8  wsum.0.bit.3.weight
    10  bit   In          FALSE  wsum.0.hold
    10  s32   I/O             0  wsum.0.offset
    10  s32   Out             5  wsum.0.sum</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced-hal-tutorial">Advanced HAL Tutorial</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:HAL-tutorial"></a> </p>
</div>
<div class="sect2">
<h3 id="introduction-a-id-sec-tutorial-intro-a">Introduction<a id="sec:Tutorial-Intro"></a></h3>
<div class="paragraph">
<p>Configuration moves from theory to device&#8201;&#8212;&#8201;HAL device that is. For
those who have had just a bit of computer programming, this section is
the 'Hello World' of the HAL. Halrun can be used to create a working
system. It is a command line or text file tool for configuration and
tuning. The following examples illustrate its setup and operation.</p>
</div>
<div class="sect3">
<h4 id="notation">Notation</h4>
<div class="paragraph">
<p>Terminal commands are shown without the system prompt unless you are
running 'HAL'. The terminal window is in 'Applications/Accessories'
from the main Debian menu bar.</p>
</div>
<div class="listingblock">
<div class="title">Terminal Command Example</div>
<div class="content">
<pre>me@computer:~machinekit$ halrun
(will be shown like the following line)
halrun

(the halcmd: prompt will be shown when running HAL)
halcmd: loadrt debounce
halcmd: show pin</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tab-completion">Tab-completion</h4>
<div class="paragraph">
<p>Your version of halcmd may include tab-completion. Instead of
completing file names as a shell does, it completes commands with HAL
identifiers. You will have to type enough letters for a unique match.
Try pressing tab after starting a HAL command:</p>
</div>
<div class="listingblock">
<div class="title">Tab Completion</div>
<div class="content">
<pre>halcmd: loa&lt;TAB&gt;
halcmd: load
halcmd: loadrt
halcmd: loadrt deb&lt;TAB&gt;
halcmd: loadrt debounce</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-rtapi-environment">The RTAPI environment</h4>
<div class="paragraph">
<p>RTAPI stands for Real Time Application Programming Interface. Many HAL
components work in realtime, and all HAL components store data in
shared memory so realtime components can access it. Normal Linux does
not support realtime programming or the type of shared memory that HAL
needs. Fortunately there are realtime operating systems (RTOS&#8217;s) that
provide the necessary extensions to Linux. Unfortunately, each RTOS
does things a little differently.</p>
</div>
<div class="paragraph">
<p>To address these differences, the Machinekit team came up with RTAPI, which
provides a consistent way for programs to talk to the RTOS. If you are
a programmer who wants to work on the internals of Machinekit, you may want to
study 'machinekit/src/rtapi/rtapi.h' to understand the API. But if you are a
normal person all you need to
know about RTAPI is that it (and the RTOS) needs to be loaded into the
memory of your computer before you do anything with HAL.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a-simple-example-a-id-sec-tutorial-simple-example-a">A Simple Example<a id="sec:Tutorial-Simple-Example"></a></h3>
<div class="sect3">
<h4 id="loading-a-component">Loading a component</h4>
<div class="paragraph">
<p>For this tutorial, we are going to assume that you have successfully
installed the Live CD and, if using a RIP <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</sup>, invoked the
'rip-environment' script to prepare your shell.
In that case, all you need to do is
load the required RTOS and RTAPI modules into memory. Just run the
following command from a terminal window:</p>
</div>
<div class="listingblock">
<div class="title">Loading HAL</div>
<div class="content">
<pre>cd machinekit
halrun
halcmd:</pre>
</div>
</div>
<div class="paragraph">
<p>With the realtime OS and RTAPI loaded, we can move into the first
example. Notice that the prompt is now shown as 'halcmd:'.
This is because subsequent commands will be interpreted as HAL commands,
not shell commands.</p>
</div>
<div class="paragraph">
<p>For the first example, we will use a HAL component called 'siggen',
which is a simple signal generator. A complete description of the
'siggen' component can be found in the <a href="#sec:Siggen">Siggen</a> section of
this Manual.
It is a realtime component, implemented as a Linux kernel module. To
load 'siggen' use the HAL command 'loadrt'.</p>
</div>
<div class="listingblock">
<div class="title">Loading siggen</div>
<div class="content">
<pre>halcmd: loadrt siggen</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="examining-the-hal">Examining the HAL</h4>
<div class="paragraph">
<p>Now that the module is loaded, it is time to introduce 'halcmd' , the
command line tool used to configure the HAL. This tutorial will
introduce some halcmd features, for a more complete description try
'man halcmd', or see the reference in <a href="#sec:Hal-Commands">Hal Commands</a>
section of this document. The first
halcmd feature is the 'show' command. This command displays information
about the current state of the HAL. To show all installed components:</p>
</div>
<div class="listingblock">
<div class="title">Show Components</div>
<div class="content">
<pre>halcmd: show comp

Loaded HAL Components:
ID     Type  Name                                PID   State
    3  RT    siggen                                    ready
    2  User  halcmd2177                          2177  ready</pre>
</div>
</div>
<div class="paragraph">
<p>Since 'halcmd' itself is a HAL component, it will always show up in
the list. The number after halcmd in the component list is the process ID.
It is possible to run more than one copy of halcmd at the same time (in
different windows for example), so the PID is added to the end of the
name to make it unique. The list also shows the 'siggen' component
that we installed in the previous step. The 'RT' under 'Type' indicates
that 'siggen' is a realtime component. The 'User' under 'Type' indicates
it is a user space component.</p>
</div>
<div class="paragraph">
<p>Next, let&#8217;s see what pins 'siggen' makes available:</p>
</div>
<div class="listingblock">
<div class="title">Show Pins</div>
<div class="content">
<pre>halcmd: show pin

Component Pins:
Owner   Type   Dir        Value  Name
     3  float  IN             1  siggen.0.amplitude
     3  bit    OUT        FALSE  siggen.0.clock
     3  float  OUT            0  siggen.0.cosine
     3  float  IN             1  siggen.0.frequency
     3  float  IN             0  siggen.0.offset
     3  float  OUT            0  siggen.0.sawtooth
     3  float  OUT            0  siggen.0.sine
     3  float  OUT            0  siggen.0.square
     3  float  OUT            0  siggen.0.triangle</pre>
</div>
</div>
<div class="paragraph">
<p>This command displays all of the pins in the current HAL. A complex system
could have dozens or hundreds of pins. But right now there are only
nine pins. All eight of these pins are floating point, and carry data
out of the 'siggen' component. Since we have not yet executed the code
contained within the component, some the pins have a value of zero.</p>
</div>
<div class="paragraph">
<p>The next step is to look at parameters:</p>
</div>
<div class="listingblock">
<div class="title">Show Parameters</div>
<div class="content">
<pre>halcmd: show param

Parameters:
Owner   Type  Dir        Value   Name
     3  s32   RO             0   siggen.0.update.time
     3  s32   RW             0   siggen.0.update.tmax</pre>
</div>
</div>
<div class="paragraph">
<p>The 'show param' command shows all the parameters in the HAL. Right now
each parameter has the default value it was given when the component
was loaded. Note the column labeled 'Dir'. The parameters labeled '-W'
are writable ones that are never changed by the component itself,
instead they are meant to be changed by the user to control the
 component. We will see how to do this later. Parameters labeled 'R-'
are read only parameters. They can be changed only by the component.
 Finally, parameter labeled 'RW' are read-write parameters. That means
that they are changed by the
 component, but can also be changed by the user. Note: the parameters
'siggen.0.update.time' and 'siggen.0.update.tmax' are for debugging
purposes, and won&#8217;t be covered in this section.</p>
</div>
<div class="paragraph">
<p>Most realtime components export one or more functions to actually run
the realtime code they contain. Let&#8217;s see what function(s) 'siggen'
exported:</p>
</div>
<div class="listingblock">
<div class="title">Show Functions</div>
<div class="content">
<pre>halcmd: show funct

Exported Functions:
Owner   CodeAddr  Arg       FP   Users  Name
 00003  f801b000  fae820b8  YES      0   siggen.0.update</pre>
</div>
</div>
<div class="paragraph">
<p>The siggen component exported a single function. It requires floating
point. It is not currently linked to any threads, so 'users' is
zero.</p>
</div>
</div>
<div class="sect3">
<h4 id="making-realtime-code-run">Making realtime code run</h4>
<div class="paragraph">
<p>To actually run the code contained in the function 'siggen.0.update',
we need a realtime thread. The component called 'threads' that is used
to create a new thread. Lets create a thread called 'test-thread' with
a period of 1 ms (1,000 us or 1,000,000 ns):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: loadrt threads name1=test-thread period1=1000000</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s see if that worked:</p>
</div>
<div class="listingblock">
<div class="title">Show Threads</div>
<div class="content">
<pre>halcmd: show thread

Realtime Threads:
     Period  FP     Name               (     Time, Max-Time )
     999855  YES           test-thread (        0,        0 )</pre>
</div>
</div>
<div class="paragraph">
<p>It did. The period is not exactly 1,000,000 ns because of hardware
limitations, but we have a thread that runs at approximately the
correct rate, and which can handle floating point functions. The next
step is to connect the function to the thread:</p>
</div>
<div class="listingblock">
<div class="title">Add Function</div>
<div class="content">
<pre>halcmd: addf siggen.0.update test-thread</pre>
</div>
</div>
<div class="paragraph">
<p>Up till now, we&#8217;ve been using 'halcmd' only to look at the HAL.
However, this time we used the 'addf' (add function) command to
actually change something in the HAL. We
told 'halcmd' to add the function 'siggen.0.update' to the thread
'test-thread', and if we look at the thread list again, we see that it
succeeded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: show thread

Realtime Threads:
     Period  FP     Name                (     Time, Max-Time )
     999855  YES          test-thread   (        0,        0 )
                  1 siggen.0.update</pre>
</div>
</div>
<div class="paragraph">
<p>There is one more step needed before the 'siggen' component starts
generating signals. When the HAL is first started,
the thread(s) are not actually running. This is to allow you to
completely configure the system before the realtime code starts. Once
you are happy with the configuration, you can start the realtime code
like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: start</pre>
</div>
</div>
<div class="paragraph">
<p>Now the signal generator is running. Let&#8217;s look at its output pins:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: show pin

Component Pins:
Owner   Type  Dir         Value  Name
     3  float IN              1  siggen.0.amplitude
     3  bit   OUT         FALSE  siggen.0.clock
     3  float OUT    -0.1640929  siggen.0.cosine
     3  float IN              1  siggen.0.frequency
     3  float IN              0  siggen.0.offset
     3  float OUT    -0.4475303  siggen.0.sawtooth
     3  float OUT     0.9864449  siggen.0.sine
     3  float OUT            -1  siggen.0.square
     3  float OUT    -0.1049393  siggen.0.triangle</pre>
</div>
</div>
<div class="paragraph">
<p>And let&#8217;s look again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: show pin

Component Pins:
Owner   Type  Dir         Value  Name
     3  float IN              1  siggen.0.amplitude
     3  bit   OUT         FALSE  siggen.0.clock
     3  float OUT     0.0507619  siggen.0.cosine
     3  float IN              1  siggen.0.frequency
     3  float IN              0  siggen.0.offset
     3  float OUT     -0.516165  siggen.0.sawtooth
     3  float OUT     0.9987108  siggen.0.sine
     3  float OUT            -1  siggen.0.square
     3  float OUT    0.03232994  siggen.0.triangle</pre>
</div>
</div>
<div class="paragraph">
<p>We did two 'show pin' commands in quick succession, and you can see
that the outputs are no longer zero.
The sine, cosine, sawtooth, and triangle outputs are
changing constantly. The square output is also working, however it
simply switches from +1.0 to -1.0 every cycle.</p>
</div>
</div>
<div class="sect3">
<h4 id="changing-parameters">Changing Parameters</h4>
<div class="paragraph">
<p>The real power of HAL is that you can change things. For example, we
can use the 'setp' command to set the value of a parameter. Let&#8217;s
change the amplitude
of the signal generator from 1.0 to 5.0:</p>
</div>
<div class="listingblock">
<div class="title">Set Pin</div>
<div class="content">
<pre>halcmd: setp siggen.0.amplitude 5</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Check the parameters and pins again</div>
<div class="content">
<pre>halcmd: show param

Parameters:
Owner   Type  Dir         Value  Name
     3  s32   RO           1754  siggen.0.update.time
     3  s32   RW          16997  siggen.0.update.tmax

halcmd: show pin

Component Pins:
Owner   Type  Dir         Value  Name
     3  float IN              5  siggen.0.amplitude
     3  bit   OUT         FALSE  siggen.0.clock
     3  float OUT     0.8515425  siggen.0.cosine
     3  float IN              1  siggen.0.frequency
     3  float IN              0  siggen.0.offset
     3  float OUT      2.772382  siggen.0.sawtooth
     3  float OUT     -4.926954  siggen.0.sine
     3  float OUT             5  siggen.0.square
     3  float OUT      0.544764  siggen.0.triangle</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the value of parameter 'siggen.0.amplitude' has changed to
5, and that the pins now have larger values.</p>
</div>
</div>
<div class="sect3">
<h4 id="saving-the-hal-configuration">Saving the HAL configuration</h4>
<div class="paragraph">
<p>Most of what we have done with 'halcmd' so far has simply been viewing
things with the 'show' command. However two of the commands actually
changed things. As we
design more complex systems with HAL, we will use many commands to
configure things just the way we want them. HAL has the memory of an
elephant, and will retain that configuration until we shut it down. But
what about next time? We don&#8217;t want to manually enter a bunch of
commands every time we want to use the system. We can save the
configuration of the entire HAL with a single command:</p>
</div>
<div class="listingblock">
<div class="title">Save</div>
<div class="content">
<pre>halcmd: save
# components
loadrt threads name1=test-thread period1=1000000
loadrt siggen
# pin aliases
# signals
# nets
# parameter values
setp siggen.0.update.tmax 14687
# realtime thread/function links
addf siggen.0.update test-thread</pre>
</div>
</div>
<div class="paragraph">
<p>The output of the 'save' command is a sequence of HAL commands. If
you start with an 'empty'
HAL and run all these commands, you will get the configuration that
existed when the 'save' command was issued. To save these commands
for later use, we simply
redirect the output to a file:</p>
</div>
<div class="listingblock">
<div class="title">Save to a file</div>
<div class="content">
<pre>halcmd: save all saved.hal</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="exiting-halrun">Exiting halrun</h4>
<div class="paragraph">
<p>When you&#8217;re finished with your HAL session type 'exit' at the 'halcmd:'
prompt. This will return you to the system prompt and close down the HAL
session. Do not simply close the terminal window without shutting down
the HAL session.</p>
</div>
<div class="listingblock">
<div class="title">Exit HAL</div>
<div class="content">
<pre>halcmd: exit</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restoring-the-hal-configuration">Restoring the HAL configuration</h4>
<div class="paragraph">
<p>To restore the HAL configuration stored in 'saved.hal', we need to
execute all of those HAL commands. To do that, we use '-f &lt;file name&gt;'
which reads commands from a file, and '-I' (upper case i) which shows
the halcmd prompt after executing the commands:</p>
</div>
<div class="listingblock">
<div class="title">Run a Saved File</div>
<div class="content">
<pre>halrun -I -f saved.hal</pre>
</div>
</div>
<div class="paragraph">
<p>Notice that there is not a 'start' command in saved.hal. It&#8217;s
necessary to issue it again (or edit saved.hal to add it there).</p>
</div>
</div>
<div class="sect3">
<h4 id="removing-hal-from-memory">Removing HAL from memory</h4>
<div class="paragraph">
<p>If an unexpected shut down of a HAL session occurs you might have to
unload HAL before another session can begin. To do this type the
following command in a terminal window.</p>
</div>
<div class="listingblock">
<div class="title">Removing HAL</div>
<div class="content">
<pre>halrun -U</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="halmeter-a-id-sec-tutorial-halmeter-a">Halmeter<a id="sec:Tutorial-Halmeter"></a></h3>
<div class="paragraph">
<p>You can build very complex HAL systems without ever using a graphical
interface. However there is something satisfying about seeing the
result of your work. The first and simplest GUI tool for the HAL is
halmeter. It is a very simple program that is the HAL equivalent of the
handy Fluke multimeter (or Simpson analog meter for the old timers).</p>
</div>
<div class="paragraph">
<p>We will use the siggen component again to check out halmeter. If you
just finished the previous example, then you can load siggen using the
saved file. If not, we can load it just like we did before:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halrun
halcmd: loadrt siggen
halcmd: loadrt threads name1=test-thread period1=1000000
halcmd: addf siggen.0.update test-thread
halcmd: start
halcmd: setp siggen.0.amplitude 5</pre>
</div>
</div>
<div class="paragraph">
<p>At this point we have the siggen component loaded and running. It&#8217;s
time to start halmeter.</p>
</div>
<div class="listingblock">
<div class="title">Starting Halmeter</div>
<div class="content">
<pre>halcmd: loadusr halmeter</pre>
</div>
</div>
<div class="paragraph">
<p>The first window you will see is the 'Select Item to Probe' window.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="http://preview.machinekit.io/docs/hal/images/halmeter-select.png" alt="halmeter select">
</div>
<div class="title">Figure 3. Halmeter Select Window<a id="cap:HAL-Meter-Select-Window"></a></div>
</div>
<div class="paragraph">
<p>This dialog has three tabs. The first tab displays all of the HAL pins
in the system. The second one displays all the signals, and the third
displays all the parameters. We would like to look at the pin
'siggen.0.cosine' first, so click on it then click the 'Close' button.
The probe
selection dialog will close, and the meter looks something like the
following figure.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="http://preview.machinekit.io/docs/hal/images/halmeter-1.png" alt="halmeter 1">
</div>
<div class="title">Figure 4. Halmeter<a id="cap:Halmeter"></a></div>
</div>
<div class="paragraph">
<p>To change what the meter displays press the 'Select' button which
brings back the 'Select Item to Probe' window.</p>
</div>
<div class="paragraph">
<p>You should see the value changing as siggen generates its cosine wave.
Halmeter refreshes its display about 5 times per second.</p>
</div>
<div class="paragraph">
<p>To shut down halmeter, just click the exit button.</p>
</div>
<div class="paragraph">
<p>If you want to look at more than one pin, signal, or parameter at a
time, you can just start more halmeters. The halmeter window was
intentionally made very small so you could have a lot of them on the
screen at once.</p>
</div>
</div>
<div class="sect2">
<h3 id="stepgen-example">Stepgen Example</h3>
<div class="paragraph">
<p>Up till now we have only loaded one HAL component. But the whole idea
behind the HAL is to allow you to load and connect a number of simple
components to make up a complex system. The next example will use two
components.</p>
</div>
<div class="paragraph">
<p>Before we can begin building this new example, we want to start with a
clean slate. If you just finished one of the previous examples, we need
to remove the all components and reload the RTAPI and HAL libraries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: exit</pre>
</div>
</div>
<div class="sect3">
<h4 id="installing-the-components">Installing the components</h4>
<div class="paragraph">
<p>Now we are going to load the step pulse generator component. For a
detailed description of this component refer to the stepgen section of the
Integrator Manual. In this example we will use the 'velocity' control
type of stepgen.  For now, we can skip the details, and just run the
following commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halrun
halcmd: loadrt stepgen step_type=0,0 ctrl_type=v,v
halcmd: loadrt siggen
halcmd: loadrt threads name1=fast fp1=0 period1=50000 name2=slow period2=1000000</pre>
</div>
</div>
<div class="paragraph">
<p>The first command loads two step generators, both configured to
generate stepping type 0. The second command loads our old friend
siggen, and the third one creates two threads, a fast one with a period
of 50 microseconds and a slow one with a period of 1 millisecond. The fast
thread doesn&#8217;t support floating point functions.</p>
</div>
<div class="paragraph">
<p>As before, we can use 'halcmd show' to take a look at the HAL. This
time we have a lot more pins and parameters than before:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: show pin

Component Pins:
Owner   Type  Dir         Value  Name
     4  float IN              1  siggen.0.amplitude
     4  bit   OUT         FALSE  siggen.0.clock
     4  float OUT             0  siggen.0.cosine
     4  float IN              1  siggen.0.frequency
     4  float IN              0  siggen.0.offset
     4  float OUT             0  siggen.0.sawtooth
     4  float OUT             0  siggen.0.sine
     4  float OUT             0  siggen.0.square
     4  float OUT             0  siggen.0.triangle
     3  s32   OUT             0  stepgen.0.counts
     3  bit   OUT         FALSE  stepgen.0.dir
     3  bit   IN          FALSE  stepgen.0.enable
     3  float OUT             0  stepgen.0.position-fb
     3  bit   OUT         FALSE  stepgen.0.step
     3  float IN              0  stepgen.0.velocity-cmd
     3  s32   OUT             0  stepgen.1.counts
     3  bit   OUT         FALSE  stepgen.1.dir
     3  bit   IN          FALSE  stepgen.1.enable
     3  float OUT             0  stepgen.1.position-fb
     3  bit   OUT         FALSE  stepgen.1.step
     3  float IN              0  stepgen.1.velocity-cmd

halcmd: show param

Parameters:
Owner   Type  Dir         Value  Name
     4  s32   RO              0  siggen.0.update.time
     4  s32   RW              0  siggen.0.update.tmax
     3  u32   RW     0x00000001  stepgen.0.dirhold
     3  u32   RW     0x00000001  stepgen.0.dirsetup
     3  float RO              0  stepgen.0.frequency
     3  float RW              0  stepgen.0.maxaccel
     3  float RW              0  stepgen.0.maxvel
     3  float RW              1  stepgen.0.position-scale
     3  s32   RO              0  stepgen.0.rawcounts
     3  u32   RW     0x00000001  stepgen.0.steplen
     3  u32   RW     0x00000001  stepgen.0.stepspace
     3  u32   RW     0x00000001  stepgen.1.dirhold
     3  u32   RW     0x00000001  stepgen.1.dirsetup
     3  float RO              0  stepgen.1.frequency
     3  float RW              0  stepgen.1.maxaccel
     3  float RW              0  stepgen.1.maxvel
     3  float RW              1  stepgen.1.position-scale
     3  s32   RO              0  stepgen.1.rawcounts
     3  u32   RW     0x00000001  stepgen.1.steplen
     3  u32   RW     0x00000001  stepgen.1.stepspace
     3  s32   RO              0  stepgen.capture-position.time
     3  s32   RW              0  stepgen.capture-position.tmax
     3  s32   RO              0  stepgen.make-pulses.time
     3  s32   RW              0  stepgen.make-pulses.tmax
     3  s32   RO              0  stepgen.update-freq.time
     3  s32   RW              0  stepgen.update-freq.tmax</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="connecting-pins-with-signals">Connecting pins with signals</h4>
<div class="paragraph">
<p>What we have is two step pulse generators, and a signal generator. Now
it is time to create some HAL signals to connect the two components. We
are going to pretend that the two step pulse generators are driving the
X and Y axis of a machine. We want to move the table in circles. To do
this, we will send a cosine signal to the X axis, and a sine signal to
the Y axis. The siggen module creates the sine and cosine, but we need
'wires' to connect the modules together. In the HAL, 'wires' are called
signals. We need to create two of them. We can call them anything we
want, for this example they will be 'X-vel' and 'Y-vel'. The signal
'X-vel' is intended to run from the cosine output of the signal
generator to the velocity input of the first step pulse generator.
The first step is to connect the signal to the signal generator output.
To connect a signal to a pin we use the net command.</p>
</div>
<div class="listingblock">
<div class="title">net command</div>
<div class="content">
<pre>halcmd: net X-vel &lt;= siggen.0.cosine</pre>
</div>
</div>
<div class="paragraph">
<p>To see the effect of the 'net' command, we show the signals again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: show sig

Signals:
Type          Value  Name     (linked to)
float             0  X-vel &lt;== siggen.0.cosine</pre>
</div>
</div>
<div class="paragraph">
<p>When a signal is connected to one or more pins, the show command lists
the pins immediately following the signal name. The 'arrow' shows the
direction of data flow - in this case, data flows from pin
'siggen.0.cosine' to signal 'X-vel'. Now let&#8217;s connect the 'X-vel' to
the velocity input of a step pulse generator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: net X-vel =&gt; stepgen.0.velocity-cmd</pre>
</div>
</div>
<div class="paragraph">
<p>We can also connect up the Y axis signal 'Y-vel'. It is intended to
run from the sine output of the signal generator
to the input of the second step pulse generator. The following command
accomplishes in one line what two 'net' commands accomplished for
'X-vel'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: net Y-vel siggen.0.sine =&gt; stepgen.1.velocity-cmd</pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s take a final look at the signals and the pins connected to
them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: show sig

Signals:
Type          Value  Name     (linked to)
float             0  X-vel &lt;== siggen.0.cosine
                           ==&gt; stepgen.0.velocity-cmd
float             0  Y-vel &lt;== siggen.0.sine
                           ==&gt; stepgen.1.velocity-cmd</pre>
</div>
</div>
<div class="paragraph">
<p>The 'show sig' command makes it clear exactly how data flows through
the HAL. For example, the 'X-vel' signal comes from pin
'siggen.0.cosine', and goes to pin 'stepgen.0.velocity-cmd'.</p>
</div>
</div>
<div class="sect3">
<h4 id="setting-up-realtime-execution-threads-and-functions">Setting up realtime execution - threads and functions</h4>
<div class="paragraph">
<p>Thinking about data flowing through 'wires' makes pins and signals
fairly easy to understand. Threads and functions are a little more
difficult. Functions contain the computer instructions that actually
get things done. Thread are the method used to make those instructions
run when they are needed. First let&#8217;s look at the functions available
to us.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: show funct

Exported Functions:
Owner   CodeAddr  Arg       FP   Users  Name
 00004  f9992000  fc731278  YES      0   siggen.0.update
 00003  f998b20f  fc7310b8  YES      0   stepgen.capture-position
 00003  f998b000  fc7310b8  NO       0   stepgen.make-pulses
 00003  f998b307  fc7310b8  YES      0   stepgen.update-freq</pre>
</div>
</div>
<div class="paragraph">
<p>In general, you will have to refer to the documentation for each
component to see what its functions do. In this case, the function
'siggen.0.update' is used to update the outputs of the signal
generator. Every time it is executed, it calculates the values of
the sine, cosine, triangle, and square outputs. To make smooth
signals, it needs to run at specific intervals.</p>
</div>
<div class="paragraph">
<p>The other three functions are related to the step pulse generators.</p>
</div>
<div class="paragraph">
<p>The first one, 'stepgen.capture_position', is used for position
feedback. It captures the value of an internal
counter that counts the step pulses as they are generated. Assuming no
missed steps, this counter indicates the position of the motor.</p>
</div>
<div class="paragraph">
<p>The main function for the step pulse generator is
'stepgen.make_pulses'. Every time 'make_pulses' runs it decides if it
is time to take a step, and if so sets the
outputs accordingly. For smooth step pulses, it should run as
frequently as possible. Because it needs to run so fast, 'make_pulses'
is highly optimized and performs only a few calculations. Unlike the
others, it does not need floating point math.</p>
</div>
<div class="paragraph">
<p>The last function, 'stepgen.update-freq', is responsible for doing
scaling and some other calculations that need to be performed
only when the frequency command changes.</p>
</div>
<div class="paragraph">
<p>What this means for our example is that we want to run
'siggen.0.update' at a moderate rate to calculate the sine and cosine
values. Immediately after we run 'siggen.0.update', we want to run
'stepgen.update_freq' to load the new values into the step pulse
generator. Finally we need
 to run 'stepgen.make_pulses' as fast as possible for smooth pulses.
Because we don&#8217;t use position
feedback, we don&#8217;t need to run 'stepgen.capture_position' at all.</p>
</div>
<div class="paragraph">
<p>We run functions by adding them to threads. Each thread runs at a
specific rate. Let&#8217;s see what threads we have available.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: show thread

Realtime Threads:
     Period  FP     Name               (     Time, Max-Time )
     996980  YES                  slow (        0,        0 )
      49849  NO                   fast (        0,        0 )</pre>
</div>
</div>
<div class="paragraph">
<p>The two threads were created when we loaded 'threads'. The first one,
'slow', runs every millisecond, and is capable of running floating
point functions. We will use it for 'siggen.0.update' and
'stepgen.update_freq'. The second thread is 'fast', which runs every
50 microseconds, and does not support floating point.
We will use it for 'stepgen.make_pulses'. To connect the
functions to the proper thread, we use the 'addf' command.
We specify the function first, followed by the thread.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: addf siggen.0.update slow
halcmd: addf stepgen.update-freq slow
halcmd: addf stepgen.make-pulses fast</pre>
</div>
</div>
<div class="paragraph">
<p>After we give these commands, we can run the 'show thread' command
again to see what happened.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: show thread

Realtime Threads:
     Period  FP     Name               (     Time, Max-Time )
     996980  YES                  slow (        0,        0 )
                  1 siggen.0.update
                  2 stepgen.update-freq
      49849  NO                   fast (        0,        0 )
                  1 stepgen.make-pulses</pre>
</div>
</div>
<div class="paragraph">
<p>Now each thread is followed by the names of the functions, in the
order in which the functions will run.</p>
</div>
</div>
<div class="sect3">
<h4 id="setting-parameters">Setting parameters</h4>
<div class="paragraph">
<p>We are almost ready to start our HAL system. However we still need to
adjust a few parameters. By default, the siggen component generates
signals that swing from +1 to -1. For our example that is fine, we want
the table speed to vary from +1 to -1 inches per second. However the
scaling of the step pulse generator isn&#8217;t quite right. By default, it
generates an output frequency of 1 step per second with an input of
1.000. It is unlikely that one step per second will give us one inch
per second of table movement. Let&#8217;s assume instead that we have a 5
turn per inch leadscrew, connected to a 200 step per rev stepper with
10x microstepping. So it takes 2000 steps for one revolution of the
screw, and 5 revolutions to travel one inch. that means the overall
scaling is 10000 steps per inch. We need to multiply the velocity input
to the step pulse generator by 10000 to get the proper output. That is
exactly what the parameter 'stepgen.n.velocity-scale' is for. In this
case, both the X and Y axis have the same scaling, so
we set the scaling parameters for both to 10000.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: setp stepgen.0.position-scale 10000
halcmd: setp stepgen.1.position-scale 10000
halcmd: setp stepgen.0.enable 1
halcmd: setp stepgen.1.enable 1</pre>
</div>
</div>
<div class="paragraph">
<p>This velocity scaling means that when the pin 'stepgen.0.velocity-cmd'
is 1.000, the step generator will generate 10000 pulses per second
(10KHz). With the motor and leadscrew described above, that will result
in the axis moving at exactly 1.000 inches per second. This illustrates
a key HAL concept - things like scaling are done at the lowest possible
level, in this case in the step pulse generator. The internal signal
'X-vel' is the velocity of the table in inches per second, and other
components such as 'siggen' don&#8217;t know (or care) about the scaling at
all. If we changed the leadscrew, or motor, we would change only the
scaling parameter of the step pulse generator.</p>
</div>
</div>
<div class="sect3">
<h4 id="run-it">Run it!</h4>
<div class="paragraph">
<p>We now have everything configured and are ready to start it up. Just
like in the first example, we use the 'start' command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: start</pre>
</div>
</div>
<div class="paragraph">
<p>Although nothing appears to happen, inside the computer the step pulse
generator is cranking out step pulses, varying from 10KHz forward to
10KHz reverse and back again every second. Later in this tutorial we&#8217;ll
see how to bring those internal signals out to run motors in the real
world, but first we want to look at them and see what is happening.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="halscope-a-id-sec-tutorial-halscope-a">Halscope<a id="sec:Tutorial-Halscope"></a></h3>
<div class="paragraph">
<p>The previous example generates some very interesting signals. But much
of what happens is far too fast to see with halmeter. To take a closer
look at what is going on inside the HAL, we want an oscilloscope.
Fortunately HAL has one, called halscope.</p>
</div>
<div class="paragraph">
<p>Halscope has two parts - a realtime part that is loaded as a kernel
module, and a user part that supplies the GUI and display. However, you
don&#8217;t need to worry about this, because the userspace portion will
automatically request that the realtime part be loaded. Also notice
the first time you run halscope in a directory it gives a benign
message that the file 'autosave.halscope' could not be opened.</p>
</div>
<div class="listingblock">
<div class="title">Starting Halscope</div>
<div class="content">
<pre>halcmd: loadusr halscope
halcmd: halscope: config file 'autosave.halscope' could not be opened</pre>
</div>
</div>
<div class="paragraph">
<p>The scope GUI window will open, immediately followed by a
'Realtime function not linked' dialog that looks like the following
figure.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="http://preview.machinekit.io/docs/hal/images/halscope-01.png" alt="halscope 01">
</div>
<div class="title">Figure 5. Realtime function not linked dialog<a id="cap:Realtime-function-not-linked"></a></div>
</div>
<div class="paragraph">
<p>This dialog is where you set the sampling rate for the oscilloscope.
For now we want to sample once per millisecond, so click on the 989 us
thread 'slow' and leave the multiplier at 1. We will also leave the
record length at 4000 samples, so that we can use up to four channels
at one time. When you select a thread and then click 'OK', the dialog
disappears, and the scope window looks something like the following
figure.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="http://preview.machinekit.io/docs/hal/images/halscope-02.png" alt="halscope 02">
</div>
<div class="title">Figure 6. Initial scope window<a id="cap:Initial-scope-window"></a></div>
</div>
<div class="sect3">
<h4 id="hooking-up-the-scope-probes">Hooking up the scope probes</h4>
<div class="paragraph">
<p>At this point, Halscope is ready to use. We have already selected a
sample rate and record length, so the next step is to decide what to
look at. This is equivalent to hooking 'virtual scope probes' to the
HAL. Halscope has 16 channels, but the number you can use at any one
time depends on the record length - more channels means shorter
records, since the memory available for the record is fixed at
approximately 16,000 samples.</p>
</div>
<div class="paragraph">
<p>The channel buttons run across the bottom of the halscope screen.
Click button '1', and you will see the 'Select Channel Source' dialog
as shown in the following figure. This dialog is very similar to the
one used by Halmeter. We would like to look at the signals we defined
earlier, so we click on the 'Signals' tab, and the dialog displays all
of the signals in the HAL (only two for this example).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="http://preview.machinekit.io/docs/hal/images/halscope-03.png" alt="halscope 03">
</div>
<div class="title">Figure 7. Select Channel Source<a id="cap:Select-Channel-Source"></a></div>
</div>
<div class="paragraph">
<p>To choose a signal, just click on it. In this case, we want channel 1
to display the signal 'X-vel'. Click on the Signals tab then click on
'X-vel' and the dialog closes and the channel is now selected.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="http://preview.machinekit.io/docs/hal/images/halscope-04.png" alt="halscope 04">
</div>
<div class="title">Figure 8. Select Signal<a id="cap:Select-Signal"></a></div>
</div>
<div class="paragraph">
<p>The channel 1 button is pressed in, and channel number 1 and the name
'X-vel' appear below the row of buttons. That display always indicates
the selected channel - you can have many channels on the screen, but
the selected one is highlighted, and the various controls like vertical
position and scale always work on the selected one.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="http://preview.machinekit.io/docs/hal/images/halscope-05.png" alt="halscope 05">
</div>
<div class="title">Figure 9. Halscope<a id="cap:HALScope"></a></div>
</div>
<div class="paragraph">
<p>To add a signal to channel 2, click the '2' button. When the dialog
pops up, click the 'Signals' tab, then click on 'Y-vel'. We also want
to look at the square and triangle wave outputs. There are no signals
connected to those pins, so we use the 'Pins' tab instead. For channel
3, select 'siggen.0.triangle' and for channel 4, select
'siggen.0.square'.</p>
</div>
</div>
<div class="sect3">
<h4 id="capturing-our-first-waveforms">Capturing our first waveforms</h4>
<div class="paragraph">
<p>Now that we have several probes hooked to the HAL, it&#8217;s time to
capture some waveforms. To start the scope, click the 'Normal' button
in the 'Run Mode' section of the screen (upper right). Since we have a
4000 sample record length, and are acquiring 1000 samples per second,
it will take halscope about 2 seconds to fill half of its buffer.
During that time a progress bar just above the main screen will show
the buffer filling. Once the buffer is half full, the scope waits for a
trigger. Since we haven&#8217;t configured one yet, it will wait forever. To
manually trigger it, click the 'Force' button in the 'Trigger' section
at the top right. You should see the remainder of the buffer fill, then
the screen will display the captured waveforms. The result will look
something like the following figure.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="http://preview.machinekit.io/docs/hal/images/halscope-06.png" alt="halscope 06">
</div>
<div class="title">Figure 10. Captured Waveforms<a id="cap:Captured-Waveforms"></a></div>
</div>
<div class="paragraph">
<p>The 'Selected Channel' box at the bottom tells you that the purple
trace is the currently selected one, channel 4, which is displaying the
value of the pin 'siggen.0.square'. Try clicking channel buttons 1
through 3 to highlight the other three traces.</p>
</div>
</div>
<div class="sect3">
<h4 id="vertical-adjustments">Vertical Adjustments</h4>
<div class="paragraph">
<p>The traces are rather hard to distinguish since all four are on top of
each other. To fix this, we use the 'Vertical' controls in the box to
the right of the screen. These controls act on the currently selected
channel. When adjusting the gain, notice that it covers a huge range -
unlike a real scope, this one can display signals ranging from very
tiny (pico-units) to very large (Tera-units). The position control
moves the displayed trace up and down over the height of the screen
only. For larger adjustments the offset button should be used.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="http://preview.machinekit.io/docs/hal/images/halscope-07.png" alt="halscope 07">
</div>
<div class="title">Figure 11. Vertical Adjustment<a id="cap:Vertical-Adjustment"></a></div>
</div>
</div>
<div class="sect3">
<h4 id="triggering">Triggering</h4>
<div class="paragraph">
<p>Using the 'Force' button is a rather unsatisfying way to trigger the
scope. To set up real triggering, click on the 'Source' button at the
bottom right. It will pop up the 'Trigger Source' dialog, which is
simply a list of all the probes that are currently connected. Select a
probe to use for triggering by clicking on it. For this example we will
use channel 3, the triangle wave as shown in the following figure.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="http://preview.machinekit.io/docs/hal/images/halscope-08.png" alt="halscope 08">
</div>
<div class="title">Figure 12. Trigger Source Dialog<a id="cap:Trigger-Source-Dialog"></a></div>
</div>
<div class="paragraph">
<p>After setting the trigger source, you can adjust the trigger level and
trigger position using the sliders in the 'Trigger' box along the right
edge. The level can be adjusted from the top to the bottom of the
screen, and is displayed below the sliders. The position is the
location of the trigger point within the overall record. With the
slider all the way down, the trigger point is at the end of the record,
and halscope displays what happened before the trigger point. When the
slider is all the way up, the trigger point is at the beginning of the
record, displaying what happened after it was triggered. The trigger
point is visible as a vertical line in the progress box above the
screen. The trigger polarity can be changed by clicking the button just
below the trigger level display.</p>
</div>
<div class="paragraph">
<p>Now that we have adjusted the vertical controls and triggering, the
scope display looks something like the following figure.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="http://preview.machinekit.io/docs/hal/images/halscope-09.png" alt="halscope 09">
</div>
<div class="title">Figure 13. Waveforms with Triggering<a id="cap:Waveforms-with-Triggering"></a></div>
</div>
</div>
<div class="sect3">
<h4 id="horizontal-adjustments">Horizontal Adjustments</h4>
<div class="paragraph">
<p>To look closely at part of a waveform, you can use the zoom slider at
the top of the screen to expand the waveforms horizontally, and the
position slider to determine which part of the zoomed waveform is
visible. However, sometimes simply expanding the waveforms isn&#8217;t enough
and you need to increase the sampling rate. For example, we would like
to look at the actual step pulses that are being generated in our
example. Since the step pulses may be only 50 us long, sampling at 1KHz
isn&#8217;t fast enough. To change the sample rate, click on the button that
displays the number of samples and sample rate to bring up the 'Select
Sample Rate' dialog, figure . For this example, we will click on the
50 us thread, 'fast', which gives us a sample rate of about 20KHz. Now
instead of displaying about 4 seconds worth of data, one record is 4000
samples at 20KHz, or about 0.20 seconds.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="http://preview.machinekit.io/docs/hal/images/halscope-10.png" alt="halscope 10">
</div>
<div class="title">Figure 14. Sample Rate Dialog<a id="cap:Sample-Rate-Dialog"></a></div>
</div>
</div>
<div class="sect3">
<h4 id="more-channels">More Channels</h4>
<div class="paragraph">
<p>Now let&#8217;s look at the step pulses. Halscope has 16 channels, but for
this example we are using only 4 at a time. Before we select any more
channels, we need to turn off a couple. Click on the channel 2 button,
then click the 'Chan Off' button at the bottom of the 'Vertical' box.
Then click on channel 3, turn if off, and do the same for channel 4.
Even though the channels are turned off, they still remember what they
are connected to, and in fact we will continue to use channel 3 as the
trigger source. To add new channels, select channel 5, and choose pin
'stepgen.0.dir', then channel 6, and select 'stepgen.0.step'. Then
click run mode 'Normal' to start the scope, and adjust the horizontal
zoom to 5 ms per division. You should see the step pulses slow down as
the velocity command (channel 1) approaches zero, then the direction
pin changes state and the step pulses speed up again. You might want to
increase the gain on channel 1 to about 20 milli per division to better see
the change in the velocity command. The result should look like  the
following figure.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="http://preview.machinekit.io/docs/hal/images/halscope-11.png" alt="halscope 11">
</div>
<div class="title">Figure 15. Step Pulses<a id="cap:Step-Pulses"></a></div>
</div>
</div>
<div class="sect3">
<h4 id="more-samples">More samples</h4>
<div class="paragraph">
<p>If you want to record more samples at once, restart realtime and load
halscope with a numeric argument which indicates the number of samples
you want to capture.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: loadusr halscope 80000</pre>
</div>
</div>
<div class="paragraph">
<p>If the 'scope_rt' component was not already loaded, halscope will
load it and request 80000 total samples, so that when sampling
4 channels at a time there will be 20000 samples per channel.
(If 'scope_rt' was already loaded, the numeric argument to
halscope will have no effect).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hal-examples">HAL Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All of these examples assume you are starting with a stepconf based
configuration and have two threads base-thread and servo-thread. The
stepconf wizard will create an empty custom.hal and a
custom_postgui.hal file. The custom.hal file will be loaded after the
configuration HAL file and the custom_postgui.hal file is loaded after
the GUI has been loaded.</p>
</div>
<div class="sect2">
<h3 id="manual-toolchange">Manual Toolchange</h3>
<div class="paragraph">
<p>In this example it is assumed that you&#8217;re 'rolling your own'
configuration and wish to add the HAL Manual Toolchange window. The HAL
Manual Toolchange is primarily useful if you have presettable tools and
you store the offsets in the tool table. If you need to touch off for
each tool change then it is best just to split up your g code. To use
the HAL Manual Toolchange window you basically have to load the
hal_manualtoolchange component then send the iocontrol 'tool change' to
the hal_manualtoolchange 'change' and send the hal_manualtoolchange
'changed' back to the iocontrol 'tool changed'. A pin is provided for an
external input to indicate the tool change is complete.</p>
</div>
<div class="paragraph">
<p>This is an example of manual toolchange 'with'
the HAL Manual Toolchange component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadusr -W hal_manualtoolchange
net tool-change iocontrol.0.tool-change =&gt; hal_manualtoolchange.change
net tool-changed iocontrol.0.tool-changed &lt;= hal_manualtoolchange.changed
net external-tool-changed hal_manualtoolchange.change_button &lt;= parport.0.pin-12-in
net tool-number iocontrol.0.tool-prep-number =&gt; hal_manualtoolchange.number
net tool-prepare-loopback iocontrol.0.tool-prepare =&gt; iocontrol.0.tool-prepared</pre>
</div>
</div>
<div class="paragraph">
<p>This is an example of manual toolchange 'without'
the HAL Manual Toolchange component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>net tool-number &lt;= iocontrol.0.tool-prep-number
net tool-change-loopback iocontrol.0.tool.-change =&gt; iocontrol.0.tool-changed
net tool-prepare-loopback iocontrol.0.tool-prepare =&gt; iocontrol.0.tool-prepared</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="compute-velocity">Compute Velocity</h3>
<div class="paragraph">
<p>This example uses 'ddt', 'mult2' and 'abs' to compute the velocity of
a single axis. For more information on the real time components see the
man pages or the Realtime Components section (<a href="#sec:Realtime-Components">[sec:Realtime-Components]</a>).</p>
</div>
<div class="paragraph">
<p>The first thing is to check your configuration to make sure you are
not using any of the real time components all ready. You can do this by
opening up the HAL Configuration window and look for the components in
the pin section. If you are then find the .hal file that they are being
loaded in and increase the counts and adjust the instance to the
correct value. Add the following to your custom.hal file.</p>
</div>
<div class="paragraph">
<p>Load the realtime components.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt ddt count=1
loadrt mult2 count=1
loadrt abs count=1</pre>
</div>
</div>
<div class="paragraph">
<p>Add the functions to a thread so it will get updated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>addf ddt.0 servo-thread
addf mult2.0 servo-thread
addf abs.0 servo-thread</pre>
</div>
</div>
<div class="paragraph">
<p>Make the connections.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>setp mult2.in1 60
net xpos-cmd ddt.0.in
net X-IPS mult2.0.in0 &lt;= ddt.0.out
net X-ABS abs.0.in &lt;= mult2.0.out
net X-IPM abs.0.out</pre>
</div>
</div>
<div class="paragraph">
<p>In this last section we are setting the mult2.0.in1 to 60 to convert
the inch per second to inch per minute that we get from the ddt.0.out.</p>
</div>
<div class="paragraph">
<p>The xpos-cmd sends the commanded position to the ddt.0.in. The ddt
computes the derivative of the change of the input.</p>
</div>
<div class="paragraph">
<p>The ddt2.0.out is multiplied by 60 to give IPM.</p>
</div>
<div class="paragraph">
<p>The mult2.0.out is sent to the abs to get the absolute value.</p>
</div>
<div class="paragraph">
<p>The following figure shows the result when the X axis is moving at 15
IPM in the minus direction. Notice that we can get the absolute value
from either the abs.0.out pin or the X-IPM signal.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../hal/images/velocity-01.png" alt="velocity 01">
</div>
<div class="title">Figure 16. Velocity Example<a id="cap:Velocity-Example"></a></div>
</div>
</div>
<div class="sect2">
<h3 id="soft-start">Soft Start</h3>
<div class="paragraph">
<p>This example shows how the HAL components 'lowpass', 'limit2' or
'limit3' can be used to limit how fast a signal changes.</p>
</div>
<div class="paragraph">
<p>In this example we have a servo motor driving a lathe spindle. If we
just used the commanded spindle speeds on the servo it will try to go
from present speed to commanded speed as fast as it can. This could
cause a problem or damage the drive. To slow the rate of change we can
send the motion.spindle-speed-out through a limiter before the PID, so
that the PID command value changes to new settings more slowly.</p>
</div>
<div class="paragraph">
<p>Three built-in components that limit a signal are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'limit2' limits the range and first derivative of a signal.</p>
</li>
<li>
<p>'limit3' limits the range, first and second derivatives of a signal.</p>
</li>
<li>
<p>'lowpass' uses an exponentially-weighted moving average to track an input signal.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To find more information on these HAL components check the man pages.</p>
</div>
<div class="paragraph">
<p>Place the following in a text file called softstart.hal. If you&#8217;re not
familiar with Linux place the file in your home directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt threads period1=1000000 name1=thread
loadrt siggen
loadrt lowpass
loadrt limit2
loadrt limit3
net square siggen.0.square =&gt; lowpass.0.in limit2.0.in limit3.0.in
net lowpass &lt;= lowpass.0.out
net limit2 &lt;= limit2.0.out
net limit3 &lt;= limit3.0.out
setp siggen.0.frequency .1
setp lowpass.0.gain .01
setp limit2.0.maxv 2
setp limit3.0.maxv 2
setp limit3.0.maxa 10
addf siggen.0.update thread
addf lowpass.0 thread
addf limit2.0 thread
addf limit3.0 thread
start
loadusr halscope</pre>
</div>
</div>
<div class="paragraph">
<p>Open a terminal window and run the file with the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halrun -I softstart.hal</pre>
</div>
</div>
<div class="paragraph">
<p>When the HAL Oscilloscope first starts up click 'OK' to accept the
default thread.</p>
</div>
<div class="paragraph">
<p>Next you have to add the signals to the channels. Click on channel 1
then select 'square' from the Signals tab. Repeat for channels 2-4 and
add lowpass, limit2, and limit3.</p>
</div>
<div class="paragraph">
<p>Next to set up a trigger signal click on the Source None button and
select square. The button will change to Source Chan 1.</p>
</div>
<div class="paragraph">
<p>Next click on Single in the Run Mode radio buttons box. This will
start a run and when it finishes you will see your traces.</p>
</div>
<div class="paragraph">
<p>To separate the signals so you can see them better click on a channel
then use the Pos slider in the Vertical box to set the positions.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../hal/images/softstart-scope.png" alt="softstart scope">
</div>
<div class="title">Figure 17. Softstart<a id="cap:Softstart"></a></div>
</div>
<div class="paragraph">
<p>To see the effect of changing the set point values of any of the
components you can change them in the terminal window. To see what
different gain settings do for lowpass just type the following in the
terminal window and try different settings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>setp lowpass.0.gain *.01</pre>
</div>
</div>
<div class="paragraph">
<p>After changing a setting run the oscilloscope again to see the change.</p>
</div>
<div class="paragraph">
<p>When you&#8217;re finished type 'exit' in the terminal window to shut down
halrun and close the halscope. Don&#8217;t close the terminal window with
halrun running as it might leave some things in memory that could
prevent EMC from loading.</p>
</div>
<div class="paragraph">
<p>For more information on Halscope see the HAL manual.</p>
</div>
</div>
<div class="sect2">
<h3 id="stand-alone-hal">Stand Alone HAL</h3>
<div class="paragraph">
<p>In some cases you might want to run a GladeVCP screen with just HAL. For
example say you had a stepper driven device that all you need is to run a
stepper motor. A simple 'Start/Stop' interface is all you need for your
application so no need to load up and configure a full blown CNC application.</p>
</div>
<div class="paragraph">
<p>In the following example we have created a simple GladeVCP panel with one</p>
</div>
<div class="listingblock">
<div class="title">Basic Syntax</div>
<div class="content">
<pre># load the winder.glade GUI and name it winder
loadusr -Wn winder gladevcp -c winder -u handler.py winder.glade

# load realtime components
loadrt threads name1=fast period1=50000 fp1=0 name2=slow period2=1000000
loadrt stepgen step_type=0 ctrl_type=v
loadrt hal_parport cfg="0x378 out"

# add functions to threads
addf stepgen.make-pulses fast
addf stepgen.update-freq slow
addf stepgen.capture-position slow
addf parport.0.read fast
addf parport.0.write fast

# make hal connections
net winder-step parport.0.pin-02-out &lt;= stepgen.0.step
net winder-dir parport.0.pin-03-out &lt;= stepgen.0.dir
net run-stepgen stepgen.0.enable &lt;= winder.start_button



# start the threads
start

# comment out the following lines while testing and use the interactive
# option halrun -I -f start.hal to be able to show pins etc.

# wait until the gladevcp GUI named winder terminates
waitusr winder

# stop HAL threads
stop

# unload HAL all components before exiting
unloadrt all</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="general-reference">General Reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="cha:general-reference">General Naming Conventions<a id="sec:GR-Naming-Conventions"></a></h3>
<div class="paragraph">
<p>Consistent naming conventions would make HAL much easier to use. For
example, if every encoder driver provided the same set of pins and
named them the same way it would be easy to change from one type of
encoder driver to another. Unfortunately, like many open-source
projects, HAL is a combination of things that were designed, and things
that simply evolved. As a result, there are many inconsistencies. This
section attempts to address that problem by defining some conventions,
but it will probably be a while before all the modules are converted to
follow them.</p>
</div>
<div class="paragraph">
<p>Halcmd and other low-level HAL utilities treat HAL names as single
entities, with no internal structure. However, most modules do have
some implicit structure. For example, a board provides several
functional blocks, each block might have several channels, and each
channel has one or more pins. This results in a structure that
resembles a directory tree. Even though halcmd doesn&#8217;t recognize the
tree structure, proper choice of naming conventions will let it group
related items together (since it sorts the names). In addition, higher
level tools can be designed to recognize such structure, if the names
provide the necessary information. To do that, all HAL components should
follow these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dots (“.”) separate levels of the hirearchy.
This is analogous to the slash (“/”) in a filename.</p>
</li>
<li>
<p>Hyphens (“-”) separate words or fields in the same level of the hirearchy.</p>
</li>
<li>
<p>HAL components should not use underscores or “MixedCase”.</p>
</li>
<li>
<p>Use only lowercase letters and numbers in names.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sec:GR-Driver-Naming">Hardware Driver Naming Conventions</h3>
<div class="sect3">
<h4 id="pin-parameter-names">Pin/Parameter names</h4>
<div class="paragraph">
<p>Hardware drivers should use five fields (on three levels) to make up a
pin or parameter name, as follows:</p>
</div>
<div class="paragraph">
<p>*&lt;device-name&gt;.&lt;device-num&gt;.&lt;io-type&gt;.&lt;chan-num&gt;.&lt;specific-name&gt;*</p>
</div>
<div class="paragraph">
<p>The individual fields are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;device-name&gt;</dt>
<dd>
<p>  The device that the driver is intended to work with. This is most
often an interface board of some type, but there are other
possibilities.</p>
</dd>
<dt class="hdlist1">&lt;device-num&gt;</dt>
<dd>
<p>  It is possible to install more than one servo board, parallel port,
or other hardware device in a computer. The device number identifies a
specific device. Device numbers start at 0 and increment.</p>
</dd>
<dt class="hdlist1">&lt;io-type&gt;</dt>
<dd>
<p>  Most devices provide more than one type of I/O. Even the simple
parallel port has both digital inputs and digital outputs. More complex
boards can have digital inputs and outputs, encoder counters, pwm or
step pulse generators, analog-to-digital converters, digital-to-analog
converters, or other unique capabilities. The I/O type is used to
identify the kind of I/O that a pin or parameter is associated with.
Ideally, drivers that implement the same I/O type, even if for very
different devices, should provide a consistent set of pins and
parameters and identical behavior. For example, all digital inputs
should behave the same when seen from inside the HAL, regardless of the
device.</p>
</dd>
<dt class="hdlist1">&lt;chan-num&gt;</dt>
<dd>
<p>  Virtually every I/O device has multiple channels, and the channel
number identifies one of them. Like device numbers, channel numbers
start at zero and increment.<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</sup>
If more than one device is installed, the channel numbers on
additional devices start over at zero. If it is possible to have a
channel number greater than 9, then channel numbers should be two
digits, with a leading zero on numbers less than 10 to preserve sort
ordering. Some modules have pins and/or parameters that affect more
than one channel. For example a PWM generator might have four channels
with four independent “duty-cycle” inputs, but one “frequency”
parameter that controls all four channels (due to hardware
limitations). The frequency parameter should use “0-3” as the channel
number.</p>
</dd>
<dt class="hdlist1">&lt;specific-name&gt;</dt>
<dd>
<p>  An individual I/O channel might have just a single HAL pin associated
with it, but most have more than one. For example, a digital input has
two pins, one is the state of the physical pin, the other is the same
thing inverted. That allows the configurator to choose between active
high and active low inputs. For most io-types, there is a standard set
of pins and parameters, (referred to as the “canonical interface”) that
the driver should implement. The canonical interfaces are described in
the <a href="#cha:Canonical-Device-Interfaces">Canonical Device Interfaces</a>
chapter.</p>
</dd>
</dl>
</div>
<div class="dlist">
<div class="title">Examples</div>
<dl>
<dt class="hdlist1">motenc.0.encoder.2.position</dt>
<dd>
<p> &#8201;&#8212;&#8201;the position output of the third encoder channel on the first
Motenc board.</p>
</dd>
<dt class="hdlist1">stg.0.din.03.in</dt>
<dd>
<p> &#8201;&#8212;&#8201;the state of the fourth digital input on the first Servo-to-Go
board.</p>
</dd>
<dt class="hdlist1">ppmc.0.pwm.00-03.frequency</dt>
<dd>
<p>&#8201;&#8212;&#8201;the carrier frequency used for PWM channels 0 through 3 on the first Pico Systems ppmc board.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="function-names">Function Names</h4>
<div class="paragraph">
<p>Hardware drivers usually only have two kinds of HAL functions, ones
that read the hardware and update HAL pins, and ones that write to the
hardware using data from HAL pins. They should be named as follows:</p>
</div>
<div class="paragraph">
<p>*&lt;device-name&gt;-&lt;device-num&gt;.&lt;io-type&gt;-&lt;chan-num-range&gt;.read|write*</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;device-name&gt;</dt>
<dd>
<p>The same as used for pins and parameters.</p>
</dd>
<dt class="hdlist1">&lt;device-num&gt;</dt>
<dd>
<p>The specific device that the function will access.</p>
</dd>
<dt class="hdlist1">&lt;io-type&gt;</dt>
<dd>
<p>  Optional. A function may access all of the I/O on a board, or it may
access only a certain type. For example, there may be independent
functions for reading encoder counters and reading digital I/O. If such
independent functions exist, the &lt;io-type&gt; field identifies the type of
I/O they access. If a single function reads all I/O provided by the
board, &lt;io-type&gt; is not used.
<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnote_4" title="View footnote.">4</a>]</sup></p>
</dd>
<dt class="hdlist1">&lt;chan-num-range&gt;</dt>
<dd>
<p>Optional. Used only if the &lt;io-type&gt; I/O is broken into groups and
accessed by different functions.</p>
</dd>
<dt class="hdlist1">read|write</dt>
<dd>
<p>Indicates whether the function reads the hardware or writes to it.</p>
</dd>
</dl>
</div>
<div class="dlist">
<div class="title">Examples</div>
<dl>
<dt class="hdlist1">motenc.0.encoder.read</dt>
<dd>
<p>&#8201;&#8212;&#8201;reads all encoders on the first motenc board.</p>
</dd>
<dt class="hdlist1">generic8255.0.din.09-15.read</dt>
<dd>
<p> &#8201;&#8212;&#8201;reads the second 8 bit port on the first generic 8255 based
digital I/O board.</p>
</dd>
<dt class="hdlist1">ppmc.0.write</dt>
<dd>
<p> &#8201;&#8212;&#8201;writes all outputs (step generators, pwm, DACs, and digital) on
the first Pico Systems ppmc board.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="parallel-port-driver">Parallel Port Driver</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:Parport"></a> </p>
</div>
<div class="sect2">
<h3 id="parport">Parport</h3>
<div class="paragraph">
<p>Parport is a driver for the traditional PC parallel port. The port has
a total of 17 physical pins. The original parallel port divided those
pins into three groups: data, control, and status. The data group
consists of 8 output pins, the control group consists of 4 pins, and
the status group consists of 5 input pins.</p>
</div>
<div class="paragraph">
<p>In the early 1990&#8217;s, the bidirectional parallel port was introduced,
which allows the data group to be used for output or input. The HAL
driver supports the bidirectional port, and allows the user to set the
data group as either input or output. If configured as output, a port
provides a total of 12 outputs and 5 inputs. If configured as input, it
provides 4 outputs and 13 inputs.</p>
</div>
<div class="paragraph">
<p>In some parallel ports, the control group pins are open collectors,
which may also be driven low by an external gate. On a board with open
collector control pins, the 'x' mode allows a more flexible mode with 8
outputs, and 9 inputs. In other parallel ports, the control group has
push-pull drivers and cannot be used as an input.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">HAL and Open Collectors</div>
HAL cannot automatically determine if the 'x' mode bidirectional pins
are actually open collectors (OC). If they are not, they cannot be used
as inputs, and attempting to drive them LOW from an external source can
damage the hardware.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To determine whether your port has 'open collector' pins, load
hal_parport in 'x' mode.  With no device attached, HAL should read the
pin as TRUE. Next, insert a 470 ohm resistor from one of the
control pins to GND. If the resulting voltage on the control pin is
close to 0V, and HAL now reads the pin as FALSE, then you have an OC
port. If the resulting voltage is far from 0V, or HAL does not read the
pin as FALSE, then your port cannot be used in 'x' mode.</p>
</div>
<div class="paragraph">
<p>The external hardware that drives the control pins should also use
open collector gates (e.g., 74LS05).</p>
</div>
<div class="paragraph">
<p>On some machines, BIOS settings may affect whether 'x' mode can be
used. 'SPP' mode is most likely to work.</p>
</div>
<div class="paragraph">
<p>No other combinations are supported, and a port cannot be changed from
input to output once the driver is installed. The
<a href="#fig:Parport-block-diag">Parport Block Diagram</a> shows two block diagrams,
one showing the driver when the data group is configured for output, and one
showing it configured for input.  For 'x' mode, refer to the pin listing of
'halcmd show pin' for pin direction assignment.</p>
</div>
<div class="paragraph">
<p>The parport driver can control up to 8 ports (defined by MAX_PORTS in
hal_parport.c). The ports are numbered starting at zero.</p>
</div>
<div class="sect3">
<h4 id="installing">Installing</h4>
<div class="listingblock">
<div class="content">
<pre>loadrt hal_parport cfg="&lt;config-string&gt;"</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Using the Port Index</div>
<p>I/O addresses below 16 are treated as port indexes. This is the
simplest way to install the parport driver and cooperates with the
Linux parport_pc driver if it is loaded. This will use the address
Linux has detected for parport 0.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt hal_parport cfg="0"</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Using the Port Address</div>
<p>The configure string consists of a hex port address, followed by an
optional direction, repeated for each port. The direction is 'in',
'out', or 'x' and determines the direction of the physical pins 2
through 9, and whether to create input HAL pins for the physical
control pins. If the direction is not specified, the data group
defaults to output. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt hal_parport cfg="0x278 0x378 in 0x20A0 out"</pre>
</div>
</div>
<div class="paragraph">
<p>This example installs drivers for one port at 0x0278, with pins 2-9 as
outputs (by default, since neither 'in' nor 'out' was specified), one
at 0x0378, with pins 2-9 as inputs, and one at 0x20A0, with pins 2-9
explicitly specified as outputs. Note that you must know the base
address of the parallel port to properly configure the driver. For ISA
bus ports, this is usually not a problem, since the port is almost
always at a 'well known' address, like 0278 or 0378 which is typically
configured in the system BIOS. The address for a PCI card is usually
shown in 'lspci -v' in an 'I/O ports' line, or in the kernel message
log after executing 'sudo modprobe -a parport_pc'. There is no
default address; if '&lt;config-string&gt;' does not contain at least one
address, it is an error.</p>
</div>
<div id="fig:Parport-block-diag" class="imageblock" style="text-align: center">
<div class="content">
<img src="../hal/images/parport-block-diag.png" alt="parport block diag">
</div>
<div class="title">Figure 18. Parport Block Diagram</div>
</div>
</div>
<div class="sect3">
<h4 id="pins">Pins</h4>
<div class="ulist">
<ul>
<li>
<p>'parport.&lt;p&gt;.pin-&lt;n&gt;-out' (bit) Drives a physical output pin.</p>
</li>
<li>
<p>'parport.&lt;p&gt;.pin-&lt;n&gt;-in' (bit) Tracks a physical input pin.</p>
</li>
<li>
<p>'parport.&lt;p&gt;.pin-&lt;n&gt;-in-not' (bit) Tracks a physical input pin, but inverted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For each pin, '&lt;p&gt;' is the port number, and '&lt;n&gt;' is the
physical pin number in the 25 pin D-shell connector.</p>
</div>
<div class="paragraph">
<p>For each physical output pin, the driver creates a single HAL pin, for example:
'parport.0.pin-14-out'.</p>
</div>
<div class="paragraph">
<p>Pins 2 through 9 are part of the data group and are output pins if
the port is defined as an output port. (Output is the default.) Pins 1,
14, 16, and 17 are outputs in all modes. These HAL pins control the
state of the corresponding physical pins.</p>
</div>
<div class="paragraph">
<p>For each physical input pin, the driver creates two HAL pins, for example:
'parport.0.pin-12-in' and 'parport.0.pin-12-in-not'.</p>
</div>
<div class="paragraph">
<p>Pins 10, 11, 12, 13, and 15 are always input pins. Pins 2 through 9
are input pins only if the port is defined as an input port. The '-in'
HAL pin is TRUE if the physical pin is high, and FALSE if the
physical pin is low. The '-in-not' HAL pin is inverted&#8201;&#8212;&#8201;it is FALSE
if the physical pin is high. By
connecting a signal to one or the other, the user can determine the
state of the input. In 'x' mode, pins 1, 14, 16, and 17 are also input
pins.</p>
</div>
</div>
<div class="sect3">
<h4 id="parameters">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p>'parport.&lt;p&gt;.pin-&lt;n&gt;-out-invert' (bit) Inverts an output pin.</p>
</li>
<li>
<p>'parport.&lt;p&gt;.pin-&lt;n&gt;-out-reset' (bit) (only for 'out' pins) TRUE if this
pin should be reset when the '-reset' function is executed.</p>
</li>
<li>
<p>parport.&lt;p&gt;.reset-time' (U32) The time (in nanoseconds)
between a pin is set by 'write' and reset by the 'reset' function if it
is enabled.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The '-invert'  parameter determines whether an output pin is active
high or active
low. If '-invert' is FALSE, setting the HAL '-out' pin TRUE drives the
physical pin high, and FALSE drives it low. If '-invert' is TRUE, then
setting the HAL '-out' pin TRUE will drive the physical pin low.</p>
</div>
</div>
<div class="sect3">
<h4 id="functions-a-id-sub-parport-functions-a">Functions<a id="sub:parport-functions"></a></h4>
<div class="ulist">
<ul>
<li>
<p>'parport.&lt;p&gt;.read' (funct) Reads physical input pins of port
'&lt;portnum&gt;' and updates HAL '-in' and '-in-not' pins.</p>
</li>
<li>
<p>'parport.read-all' (funct) Reads physical input pins of all ports
and updates HAL '-in' and '-in-not' pins.</p>
</li>
<li>
<p>'parport.&lt;p&gt;.write' (funct) Reads HAL '-out' pins of port
'&lt;p&gt;' and updates that port&#8217;s physical output pins.</p>
</li>
<li>
<p>'parport.write-all' (funct) Reads HAL '-out' pins of all ports
and updates all physical output pins.</p>
</li>
<li>
<p>'parport.&lt;p&gt;.reset' (funct) Waits until 'reset-time' has
elapsed since the associated 'write', then resets pins to values
indicated by '-out-invert' and '-out-invert' settings. 'reset' must be
later in the same thread as 'write. 'If '-reset' is TRUE, then the
'reset' function will set the pin to the value of '-out-invert'. This
can be used in conjunction with stepgen&#8217;s 'doublefreq' to produce one
step per period. The <a href="#sub:stepgen-parameters">stepgen stepspace</a> for that pin
must be set to 0 to enable doublefreq.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The individual functions are provided for situations where one port
needs to be updated in a very fast thread, but other ports can be
updated in a slower thread to save CPU time. It is probably not a good
idea to use both an '-all' function and an individual function at the
same time.</p>
</div>
</div>
<div class="sect3">
<h4 id="common-problems">Common problems</h4>
<div class="paragraph">
<p>If loading the module reports</p>
</div>
<div class="listingblock">
<div class="content">
<pre>insmod: error inserting '/home/jepler/emc2/rtlib/hal_parport.ko':
-1 Device or resource busy</pre>
</div>
</div>
<div class="paragraph">
<p>then ensure that the standard kernel module 'parport_pc'  is not
loaded<sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnote_5" title="View footnote.">5</a>]</sup>
and that no other device in the system has claimed the I/O ports.</p>
</div>
<div class="paragraph">
<p>If the module loads but does not appear to function, then the port
address is incorrect or the 'probe_parport' module is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-doublestep">Using DoubleStep</h4>
<div class="paragraph">
<p>To setup DoubleStep on the parallel port you must add the function
parport.n.reset after parport.n.write and configure stepspace to 0 and
the reset time wanted. So that step can be asserted on every period in
HAL and then toggled off by parport after being asserted for time
specificed by parport.n.reset-time.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt hal_parport cfg="0x378 out"
setp parport.0.reset-time 5000
loadrt stepgen step_type=0,0,0
addf parport.0.read base-thread
addf stepgen.make-pulses base-thread
addf parport.0.write base-thread
addf parport.0.reset base-thread
addf stepgen.capture-position servo-thread
...
setp stepgen.0.steplen 1
setp stepgen.0.stepspace 0</pre>
</div>
</div>
<div class="paragraph">
<p>More information on DoubleStep can be found on the
<a href="http://wiki.machinekit.org/cgi-bin/wiki.pl?TweakingSoftwareStepGeneration">wiki</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec:probe_parport">probe_parport</h3>
<div class="paragraph">
<p>In modern PCs, the parallel port may require plug and play (PNP)
configuration before it can be used. The 'probe_parport'  module
performs configuration of any PNP ports present, and should be
loaded before 'hal_parport'. On machines without PNP ports, it may be
loaded but has no effect.</p>
</div>
<div class="sect3">
<h4 id="installing-2">Installing</h4>
<div class="listingblock">
<div class="content">
<pre>loadrt probe_parport

loadrt hal_parport ...</pre>
</div>
</div>
<div class="paragraph">
<p>If the Linux kernel prints a message similar to</p>
</div>
<div class="listingblock">
<div class="content">
<pre>parport: PnPBIOS parport detected.</pre>
</div>
</div>
<div class="paragraph">
<p>when the parport_pc module is loaded ('sudo modprobe -a parport_pc;
sudo rmmod parport_pc)' then use of this module is probably required.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hal-component-descriptions">HAL Component Descriptions</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:realtime-components"></a> </p>
</div>
<div class="sect2">
<h3 id="sec:Stepgen">Stepgen</h3>
<div class="paragraph">
<p>This component provides software based generation of step pulses in
response to position or velocity commands. In position mode, it has a
built in pre-tuned position loop, so PID tuning is not required. In
velocity mode, it drives a motor at the commanded speed, while obeying
velocity and acceleration limits. It is a realtime component only, and
depending on CPU speed, etc, is capable of maximum step rates of 10kHz
to perhaps 50kHz. Figure <a href="#fig:Stepgen-Block-Diag">Step Pulse Generator Block Diagram</a>
shows three block diagrams, each is a single step pulse generator.
The first diagram is for step type '0', (step and direction). The second is
for step type '1' (up/down, or pseudo-PWM), and the third is for step types 2
through 14 (various stepping patterns). The first two diagrams show position
mode control, and the third one shows velocity mode. Control mode and
step type are set independently, and any combination can be selected.</p>
</div>
<div id="fig:Stepgen-Block-Diag" class="paragraph">
<div class="title">Step Pulse Generator Block Diagram position mode</div>
<p></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../hal/images/stepgen-block-diag.png" alt="stepgen block diag">
</div>
</div>
<div class="listingblock">
<div class="title">Installing</div>
<div class="content">
<pre>halcmd: loadrt stepgen step_type=&lt;type-array&gt; [ctrl_type=&lt;ctrl_array&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>'&lt;type-array&gt;' is a series of comma separated decimal integers. Each
number causes a
single step pulse generator to be loaded, the value of the number
 determines the stepping type. '&lt;ctrl_array&gt;' is a comma separated
series of 'p' or 'v' characters, to specify position or velocity
mode. 'ctrl_type' is optional, if ommitted, all of the step generators
will be position
mode.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: loadrt stepgen step_type=0,0,2 ctrl_type=p,p,v</pre>
</div>
</div>
<div class="paragraph">
<p>will install three step generators. The first two use step type '0'
(step and direction) and run in position mode. The last one uses step
type '2' (quadrature) and runs in velocity mode. The default value for
'&lt;config-array&gt;' is '0,0,0' which will install three type '0'
(step/dir) generators. The maximum
number of step generators is 8 (as defined by MAX_CHAN in stepgen.c).
Each generator is independent, but all are updated by the same
 function(s) at the same time. In the following descriptions, '&lt;chan&gt;'
is the number of a specific generator. The first generator is number 0.

.Removing</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: unloadrt stepgen</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Pins</div>
<p>Each step pulse generator will have only some of these pins, depending
on the step type and control type selected.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(float) stepgen.&lt;chan&gt;.position-cmd' - Desired motor position, in
position units (position mode only).</p>
</li>
<li>
<p>'(float) stepgen.&lt;chan&gt;.velocity-cmd' - Desired motor velocity, in
position units per second (velocity mode only).</p>
</li>
<li>
<p>'(s32) stepgen.&lt;chan&gt;.counts' - Feedback position in counts,
updated by 'capture_position()'.</p>
</li>
<li>
<p>'(float) stepgen.&lt;chan&gt;.position-fb' - Feedback position in
position units, updated by 'capture_position()'.</p>
</li>
<li>
<p>'(bit) stepgen.&lt;chan&gt;.enable' - Enables output steps - when false,
no steps are generated.</p>
</li>
<li>
<p>'(bit) stepgen.&lt;chan&gt;.step' - Step pulse output (step type 0 only).</p>
</li>
<li>
<p>'(bit) stepgen.&lt;chan&gt;.dir' - Direction output (step type 0 only).</p>
</li>
<li>
<p>'(bit) stepgen.&lt;chan&gt;.up' - UP pseudo-PWM output (step type 1 only).</p>
</li>
<li>
<p>'(bit) stepgen.&lt;chan&gt;.down' - DOWN pseudo-PWM output (step type 1 only).</p>
</li>
<li>
<p>'(bit) stepgen.&lt;chan&gt;.phase-A' - Phase A output (step types 2-14 only).</p>
</li>
<li>
<p>'(bit) stepgen.&lt;chan&gt;.phase-B' - Phase B output (step types 2-14 only).</p>
</li>
<li>
<p>'(bit) stepgen.&lt;chan&gt;.phase-C' - Phase C output (step types 3-14 only).</p>
</li>
<li>
<p>'(bit) stepgen.&lt;chan&gt;.phase-D' - Phase D output (step types 5-14 only).</p>
</li>
<li>
<p>'(bit) stepgen.&lt;chan&gt;.phase-E' - Phase E output (step types 11-14 only).</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Parameters<a id="sub:stepgen-parameters"></a></div>
<ul>
<li>
<p>'(float) stepgen.&lt;chan&gt;.position-scale' - Steps per position unit.
This parameter is used for both output and feedback.</p>
</li>
<li>
<p>'(float) stepgen.&lt;chan&gt;.maxvel' - Maximum velocity, in position
units per second. If 0.0, has no effect.</p>
</li>
<li>
<p>'(float) stepgen.&lt;chan&gt;.maxaccel' - Maximum accel/decel rate, in
positions units per second squared.
If 0.0, has no effect.</p>
</li>
<li>
<p>'(float) stepgen.&lt;chan&gt;.frequency' - The current step rate, in
steps per second.</p>
</li>
<li>
<p>'(float) stepgen.&lt;chan&gt;.steplen' - Length of a step pulse (step
type 0 and 1) or minimum time in a
given state (step types 2-14), in nano-seconds.</p>
</li>
<li>
<p>'(float) stepgen.&lt;chan&gt;.stepspace' - Minimum spacing between two
step pulses (step types 0 and 1 only), in nano-seconds. Set to 0 to
enable the stepgen 'doublefreq' function. To use 'doublefreq' the
<a href="#sub:parport-functions">parport reset function</a> must be enabled.</p>
</li>
<li>
<p>'(float) stepgen.&lt;chan&gt;.dirsetup' - Minimum time from a direction
change to the beginning of the next
step pulse (step type 0 only), in nanoseconds.</p>
</li>
<li>
<p>'(float) stepgen.&lt;chan&gt;.dirhold' - Minmum time from the end of a
step pulse to a direction change
(step type 0 only), in nanoseconds.</p>
</li>
<li>
<p>'(float) stepgen.&lt;chan&gt;.dirdelay' - Minmum time any step to a step
in the opposite direction (step
types 1-14 only), in nano-seconds.</p>
</li>
<li>
<p>'(s32) stepgen.&lt;chan&gt;.rawcounts' - The raw feedback count, updated
by 'make_pulses()'.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In position mode, the values of maxvel and maxaccel are used by the
internal position loop to avoid generating step pulse trains that the
motor cannot follow. When set to values that are appropriate for the
motor, even a large instantaneous change in commanded position will
result in a smooth trapezoidal move to the new location. The algorithm
works by measuring both position error and velocity error, and
calculating an acceleration that attempts to reduce both to zero at the
same time. For more details, including the contents of the 'control
equation' box, consult the code.</p>
</div>
<div class="paragraph">
<p>In velocity mode, maxvel is a simple limit that is applied to the
commanded velocity, and maxaccel is used to ramp the actual frequency
if the commanded velocity changes abruptly. As in position mode, proper
values for these parameters ensure that the motor can follow the
generated pulse train.</p>
</div>
<div id="sub:Stepgen-Step-Types" class="paragraph">
<div class="title">Step Type 0</div>
<p>Step type 0 is the standard step and direction type. When configured for
step type 0, there are four extra parameters that determine the exact
timing of the step and direction signals. In the following figure
the meaning of these parameters is shown. The
parameters are in nanoseconds, but will be rounded up to an integer
multiple of the thread period for the threaed that calls
'make_pulses()'. For example, if 'make_pulses()' is called every 16 us,
and steplen is 20000, then the step pulses will
be 2 x 16 = 32 us long. The default value for all four of the parameters
is 1ns, but the automatic rounding takes effect the first time the code
 runs. Since one step requires 'steplen' ns high and 'stepspace' ns
low, the maximum frequency is 1,000,000,000 divided by
'(steplen+stepspace)'. If 'maxfreq' is set higher than that limit, it
will be lowered automatically. If
maxfreq is zero, it will remain zero, but the output frequency will
still be limited.</p>
</div>
<div class="paragraph">
<p>When using the parallel port driver the step frequency can be doubled using
the <a href="#sub:parport-functions">parport reset</a> function together with stepgen&#8217;s
'doublefreq' setting.</p>
</div>
<div id="fig:StepDir-timing" class="imageblock" style="text-align: center">
<div class="content">
<img src="../hal/images/stepgen-type0.png" alt="stepgen type0">
</div>
<div class="title">Figure 19. Step and Direction Timing</div>
</div>
<div class="paragraph">
<div class="title">Step Type 1</div>
<p>Step type 1 has two outputs, up and down. Pulses appear on one or the
other, depending on the direction of travel. Each pulse is 'steplen' ns
long, and the pulses are separated by at least 'stepspace' ns. The
maximum frequency is the same as for step type 0. If 'maxfreq' is set
higher than the limit it will be lowered. If 'maxfreq' is zero, it
will remain zero but the output frequency will still be
limited.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Do not use the parport reset function with step types 2 - 14. Unexpected
results can happen.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Step Type 2 - 14</div>
<p>Step types 2 through 14 are state based, and have from two to five
outputs. On each step, a state counter is incremented or decremented.
Figures <a href="#fig:Two-and-Three-Phase">Two-and-Three-Phase</a>, <a href="#fig:Four-Phase">Four-Phase</a>, and
<a href="#fig:Five-Phase">Five-Phase</a> show the output patterns as a function of the state
counter. The maximum frequency is 1,000,000,000 divided by 'steplen',
and as in the other modes, 'maxfreq' will be lowered if it is above the
limit.</p>
</div>
<div id="fig:Two-and-Three-Phase" class="paragraph">
<div class="title">Two-and-Three-Phase Step Types</div>
<p></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../hal/images/stepgen-type2-4.png" alt="stepgen type2 4">
</div>
</div>
<div id="fig:Four-Phase" class="paragraph">
<div class="title">Four-Phase Step Types</div>
<p></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../hal/images/stepgen-type5-10.png" alt="stepgen type5 10" width="800">
</div>
</div>
<div id="fig:Five-Phase" class="paragraph">
<div class="title">Five-Phase Step Types</div>
<p></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../hal/images/stepgen-type11-14.png" alt="stepgen type11 14">
</div>
</div>
<div class="paragraph">
<div class="title">Functions</div>
<p>The component exports three functions. Each function acts on all of
the step pulse generators - running different generators in different
threads is not supported.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(funct) stepgen.make-pulses' - High speed function to generate
and count pulses (no floating point).</p>
</li>
<li>
<p>'(funct) stepgen.update-freq' - Low speed function does position
to velocity conversion, scaling and limiting.</p>
</li>
<li>
<p>'(funct) stepgen.capture-position' - Low speed function for
feedback, updates latches and scales position.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The high speed function 'stepgen.make-pulses' should be run in a very
fast thread, from 10 to 50 us depending on the
capabilities of the computer. That thread&#8217;s period determines the
 maximum step frequency, since 'steplen', 'stepspace', 'dirsetup',
'dirhold', and 'dirdelay' are all rounded up to a integer multiple of
the thread periond in
nanoseconds. The other two functions can be called at a much lower
rate.</p>
</div>
</div>
<div class="sect2">
<h3 id="sec:PWMgen">PWMgen</h3>
<div class="paragraph">
<p>This component provides software based generation of PWM (Pulse Width
Modulation) and PDM (Pulse Density Modulation) waveforms. It is a
realtime component only, and depending on CPU speed, etc, is capable of
PWM frequencies from a few hundred Hertz at pretty good resolution, to
perhaps 10KHz with limited resolution.</p>
</div>
<div class="listingblock">
<div class="title">Installing</div>
<div class="content">
<pre>loadrt pwmgen output_type=&lt;config-array&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The '&lt;config-array&gt;' is a series of comma separated decimal integers. Each
number causes a single PWM generator to be loaded, the value of the number
determines the output type. The following example will install three PWM
generators. There is no default value, if '&lt;config-array&gt;' is not specified,
no PWM generators will be installed. The maximum number of frequency generators
is 8 (as defined by MAX_CHAN in pwmgen.c). Each generator is independent,
but all are updated by the same function(s) at the same time. In the following
descriptions, '&lt;chan&gt;' is the number of a specific generator. The first
generator is number 0.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre>loadrt pwmgen output_type=0,1,2</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Removing</div>
<div class="content">
<pre>unloadrt pwmgen</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Output Types</div>
<p>The PWM generator supports three different 'output types'.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'Output type 0' - PWM output pin only. Only positive commands are accepted,
negative values are treated as zero (and will be affected by the parameter
'min-dc' if it is non-zero).</p>
</li>
<li>
<p>'Output type 1' - PWM/PDM and direction pins. Positive and negative inputs
will be output as positive and negative PWM. The direction pin is false
for positive commands, and true for negative commands. If your control
needs positive PWM for both CW and CCW use the <a href="#sub:abs">abs</a> component
to convert your PWM signal to positive value when a negative input is input.</p>
</li>
<li>
<p>'Output type 2' - UP and DOWN pins. For positive commands, the PWM signal
appears on the up output, and the down output remains false. For negative
commands, the PWM signal appears on the down output, and the up output
remains false. Output type 2 is suitable for driving most H-bridges.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Pins</div>
<p>Each PWM generator will have the following pins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(float) pwmgen.&lt;chan&gt;.value' - Command value, in arbitrary units.
Will be scaled by the 'scale' parameter (see below).</p>
</li>
<li>
<p>'(bit) pwmgen.&lt;chan&gt;.enable' - Enables or disables the PWM
generator outputs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each PWM generator will also have some of these pins, depending on the
output type selected:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(bit) pwmgen.&lt;chan&gt;.pwm' - PWM (or PDM) output, (output types 0
and 1 only).</p>
</li>
<li>
<p>'(bit) pwmgen.&lt;chan&gt;.dir' - Direction output (output type 1 only).</p>
</li>
<li>
<p>'(bit) pwmgen.&lt;chan&gt;.up' - PWM/PDM output for positive input value
(output type 2 only).</p>
</li>
<li>
<p>'(bit) pwmgen.&lt;chan&gt;.down' - PWM/PDM output for negative input
value (output type 2 only).</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Parameters</div>
<ul>
<li>
<p>'(float) pwmgen.&lt;chan&gt;.scale' - Scaling factor to convert 'value'
from arbitrary units to duty cycle.</p>
</li>
<li>
<p>'(float) pwmgen.&lt;chan&gt;.pwm-freq' - Desired PWM frequency, in Hz.
If 0.0, generates PDM instead of
 PWM. If set higher than internal limits, next call of 'update_freq()'
will set it to the internal limit. If non-zero, and 'dither' is false,
next call of 'update_freq()' will set it to the nearest integer
multiple of the 'make_pulses()' function period.</p>
</li>
<li>
<p>'(bit) pwmgen.&lt;chan&gt;.dither-pwm' - If true, enables dithering to
achieve average PWM frequencies or
duty cycles that are unobtainable with pure PWM. If false, both the PWM
frequency and the duty cycle will be rounded to values that can be
achieved exactly.</p>
</li>
<li>
<p>'(float) pwmgen.&lt;chan&gt;.min-dc' - Minimum duty cycle, between 0.0
and 1.0 (duty cycle will go to
zero when disabled, regardless of this setting).</p>
</li>
<li>
<p>'(float) pwmgen.&lt;chan&gt;.max-dc' - Maximum duty cycle, between 0.0
and 1.0.</p>
</li>
<li>
<p>'(float) pwmgen.&lt;chan&gt;.curr-dc' - Current duty cycle - after all
limiting and rounding (read only).</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Functions</div>
<p>The component exports two functions. Each function acts on all of the
PWM generators - running different generators in different threads is
not supported.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(funct) pwmgen.make-pulses' - High speed function to generate PWM
waveforms (no floating point).</p>
</li>
<li>
<p>'(funct) pwmgen.update' - Low speed function to scale and limit
value and handle other parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The high speed function 'pwmgen.make-pulses' should be run in a very
fast thread, from 10 to 50 us depending on the
capabilities of the computer. That thread&#8217;s period determines the
maximum PWM carrier frequency, as well as the resolution of the PWM or
PDM signals. The other function can be called at a much lower rate.</p>
</div>
</div>
<div class="sect2">
<h3 id="sec:Encoder">Encoder</h3>
<div class="paragraph">
<p>This component provides software based counting of signals from
quadrature encoders. It is a realtime component only, and depending on
CPU speed, latency, etc, is capable of maximum count rates of 10kHz to
perhaps up to 50kHz.</p>
</div>
<div class="paragraph">
<p>The base thread should be 1/2 count speed to allow for noise and timing
variation. For example if you have a 100 pulse per revolution encoder on the
spindle and your maximnum RPM is 3000 the maximum base thread should be 25 us.
A 100 pulse per revolution encoder will have 400 counts. The spindle speed
of 3000 RPM = 50 RPS (revolutions per second). 400 * 50 = 20,000 counts per
second or 50 us between counts.</p>
</div>
<div class="paragraph">
<p>Figure <a href="#fig:Encoder-Block-Diag">Encoder Counter Block Diagram</a> is a block
diagram of one channel of encoder counter.</p>
</div>
<div id="fig:Encoder-Block-Diag" class="paragraph">
<div class="title">Encoder Counter Block Diagram</div>
<p></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../hal/images/encoder-block-diag.png" alt="encoder block diag">
</div>
</div>
<div class="listingblock">
<div class="title">Installing</div>
<div class="content">
<pre>halcmd: loadrt encoder [num_chan=&lt;counters&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>'&lt;counters&gt;' is the number of encoder counters that you want to
install. If 'numchan' is not specified, three counters will be
installed. The maximum
number of counters is 8 (as defined by MAX_CHAN in encoder.c). Each
counter is independent, but all are updated by the same function(s) at
 the same time. In the following descriptions, '&lt;chan&gt;' is the number
of a specific counter. The first counter is number 0.</p>
</div>
<div class="listingblock">
<div class="title">Removing</div>
<div class="content">
<pre>halcmd: unloadrt encoder</pre>
</div>
</div>
<div class="ulist">
<div class="title">Pins</div>
<ul>
<li>
<p>'encoder.&lt;chan&gt;.counter-mode' (bit, I/O) (default: FALSE) - Enables
counter mode. When true, the
counter counts each rising edge of the phase-A input, ignoring the
value on phase-B. This is useful for counting the output of a single
channel (non-quadrature) sensor. When false, it counts in quadrature
mode.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.counts' (s32, Out) - Position in encoder counts.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.counts-latched' (s32, Out) - Not used at this time.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.index-enable' (bit, I/O) - When True, 'counts' and
'position are' reset to zero on next rising edge of Phase Z. At the
same time, 'index-enable' is reset to zero to indicate that the rising
edge has occoured. The 'index-enable' pin is bi-directional. If
'index-enable' is False, the Phase Z channel of the encoder will be
ignored, and the
 counter will count normally. The encoder driver will never set
'index-enable' True. However, some other component may do so.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.latch-falling' (bit, In) (default: TRUE) - Not used
at this time.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.latch-input' (bit, In) (default: TRUE) - Not used at
this time.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.latch-rising' (bit, In) - Not used at this time.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.min-speed-estimate' (float, in) - Determine the
minimum true velocity magnitude at which
velocity will be estimated as nonzero and postition-interpolated will
be interpolated. The units of 'min-speed-estimate' are the same as the
units of 'velocity' . Scale factor, in counts per length unit. Setting
this parameter too
low will cause it to take a long time for velocity to go to 0 after
encoder pulses have stopped arriving.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.phase-A' (bit, In) - Phase A of the quadrature encoder signal.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.phase-B' (bit, In) - Phase B of the quadrature encoder signal.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.phase-Z' (bit, In) - Phase Z (index pulse) of the quadrature encoder signal.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.position' (float, Out) - Position in scaled units (see 'position-scale').</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.position-interpolated' (float, Out) - Position in
scaled units, interpolated between
encoder counts. The 'position-interpolated' attempts to interpolate
between encoder counts, based on the most
recently measured velocity. Only valid when velocity is approximately
constant and above 'min-speed-estimate'. Do not use for position
control, since its value is incorrect at
low speeds, during direction reversals, and during speed changes.
However, it allows a low ppr encoder (including a one pulse per
revolution 'encoder') to be used for lathe threading, and may have
other uses as well.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.position-latched (float, Out)' - Not used at this time.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.position-scale (float, I/O)' - Scale factor, in
counts per length unit. For example, if
position-scale is 500, then 1000 counts of the encoder will be reported
as a position of 2.0 units.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.rawcounts (s32, In)' - The raw count, as determined
by update-counters. This value is
updated more frequently than counts and position. It is also unaffected
by reset or the index pulse.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.reset' (bit, In) - When True, force 'counts' and
'position' to zero immediately.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.velocity' (float, Out) - Velocity in scaled units per
second. 'encoder' uses an algorithm that greatly reduces quantization
noise as compared
to simply differentiating the 'position' output. When the magnitude
of the true velocity is below
min-velocity-estimate, the velocity output is 0.</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.x4-mode (bit, I/O) (default: TRUE)' - Enables
times-4 mode. When true, the counter counts each edge of
the quadrature waveform (four counts per full cycle). When false, it
only counts once per full cycle. In counter-mode, this parameter is
ignored. The 1x mode is useful for some jogwheels.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Parameters</div>
<ul>
<li>
<p>'encoder.&lt;chan&gt;.capture-position.time (s32, RO)'</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.capture-position.tmax (s32, RW)'</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.update-counters.time (s32, RO)'</p>
</li>
<li>
<p>'encoder.&lt;chan&gt;.update-counter.tmax (s32, RW)'</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Functions</div>
<p>The component exports two functions. Each function acts on all of the
encoder counters - running different counters in different threads is
not supported.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(funct) encoder.update-counters' - High speed function to count
pulses (no floating point).</p>
</li>
<li>
<p>'(funct) encoder.capture-position' - Low speed function to update
latches and scale position.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sec:PID">PID</h3>
<div class="paragraph">
<p>This component provides Proportional/Integral/Derivative control
loops. It is a realtime component only. For simplicity, this discussion
assumes that we are talking about position loops, however this
component can be used to implement other feedback loops such as speed,
torch height, temperature, etc. Figure <a href="#fig:PID-block-diag">PID Loop Block Diagram</a> is a
block diagram of a single PID loop.</p>
</div>
<div id="fig:PID-block-diag" class="paragraph">
<div class="title">PID Loop Block Diagram</div>
<p></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../hal/images/pid-block-diag.png" alt="pid block diag">
</div>
</div>
<div class="listingblock">
<div class="title">Installing</div>
<div class="content">
<pre>halcmd: loadrt pid [num_chan=&lt;loops&gt;] [debug=1]</pre>
</div>
</div>
<div class="paragraph">
<p>'&lt;loops&gt;' is the number of PID loops that you want to install. If
'numchan' is not specified, one loop will be installed. The maximum
number of
loops is 16 (as defined by MAX_CHAN in pid.c). Each loop is completely
 independent. In the following descriptions, '&lt;loopnum&gt;' is the loop
number of a specific loop. The first loop is number 0.</p>
</div>
<div class="paragraph">
<p>If 'debug=1' is specified, the component will export a few extra
parameters that
may be useful during debugging and tuning. By default, the extra
parameters are not exported, to save shared memory space and avoid
cluttering the parameter list.</p>
</div>
<div class="listingblock">
<div class="title">Removing</div>
<div class="content">
<pre>halcmd: unloadrt pid</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Pins</div>
<p>The three most important pins are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(float) pid.&lt;loopnum&gt;.command' - The desired position, as
commanded by another system component.</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.feedback' - The present position, as
measured by a feedback device such as an encoder.</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.output' - A velocity command that attempts
to move from the present position to the desired position.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a position loop, 'command' and 'feedback' are in position units.
For a linear axis, this could be inches, mm, meters, or whatever is
relevant. Likewise, for an angular axis, it could be degrees, radians,
etc. The units of the 'output' pin represent the change needed to make
the feedback match the command. As such, for a position loop 'Output'
is a velocity, in inches/sec, mm/sec, degrees/sec, etc. Time units are
always seconds, and the velocity units match the position units. If
command and feedback are in meters, then output is in meters per
second.</p>
</div>
<div class="paragraph">
<p>Each loop has two pins which are used to monitor or control the
general operation of the component.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(float) pid.&lt;loopnum&gt;.error' - Equals '.command' minus '.feedback'.</p>
</li>
<li>
<p>'(bit) pid.&lt;loopnum&gt;.enable' - A bit that enables the loop. If
'.enable' is false, all integrators are reset, and the output is
forced to zero. If '.enable' is true, the loop operates normally.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pins used to report saturation. Saturation occurs when the output of
the PID block is at its maximum or minimum limit.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(bit) pid.&lt;loopnum&gt;.saturated' - True when output is saturated.</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.saturated_s' - The time the output has been saturated.</p>
</li>
<li>
<p>'(s32) pid.&lt;loopnum&gt;.saturated_count' - The time the output has been saturated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Parameters</div>
<p>The PID gains, limits, and other 'tunable' features of the loop are
implemented as parameters.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(float) pid.&lt;loopnum&gt;.Pgain' - Proportional gain</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.Igain' - Integral gain</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.Dgain' - Derivative gain</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.bias' - Constant offset on output</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.FF0' - Zeroth order feedforward - output
proportional to command (position).</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.FF1' - First order feedforward - output
proportional to derivative of command (velocity).</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.FF2' - Second order feedforward - output
proportional to 2nd derivative
of command (acceleration)<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnote_6" title="View footnote.">6</a>]</sup>.</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.deadband' - Amount of error that will be ignored</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.maxerror' - Limit on error</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.maxerrorI' - Limit on error integrator</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.maxerrorD' - Limit on error derivative</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.maxcmdD' - Limit on command derivative</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.maxcmdDD' - Limit on command 2nd derivative</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.maxoutput' - Limit on output value</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of the 'max' limits are implemented such that if the parameter
value is zero, there is no limit.</p>
</div>
<div class="paragraph">
<p>If 'debug=1' was specified when the component was installed, four
additional parameters will be exported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(float) pid.&lt;loopnum&gt;.errorI' - Integral of error.</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.errorD' - Derivative of error.</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.commandD' - Derivative of the command.</p>
</li>
<li>
<p>'(float) pid.&lt;loopnum&gt;.commandDD' - 2nd derivative of the command.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Functions</div>
<p>The component exports one function for each PID loop. This function
performs all the calculations needed for the loop. Since each loop has
its own function, individual loops can be included in different threads
and execute at different rates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(funct) pid.&lt;loopnum&gt;.do_pid_calcs' - Performs all calculations
for a single PID loop.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want to understand the exact algorithm used to compute the
output of the PID loop, refer to figure <a href="#fig:PID-block-diag">PID Loop Block Diagram</a>, the
comments at the beginning of 'emc2/src/hal/components/pid.c' , and of
course to the code itself. The loop calculations are in the C
function 'calc_pid()'.</p>
</div>
</div>
<div class="sect2">
<h3 id="simulated-encoder-a-id-sec-simulated-encoder-a">Simulated Encoder<a id="sec:Simulated-Encoder"></a></h3>
<div class="paragraph">
<p>The simulated encoder is exactly that. It produces quadrature pulses
with an index pulse, at a speed controlled by a HAL pin. Mostly useful
for testing.</p>
</div>
<div class="listingblock">
<div class="title">Installing</div>
<div class="content">
<pre>halcmd: loadrt sim-encoder num_chan=&lt;number&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>'&lt;number&gt;' is the number of encoders that you want to simulate. If not
specified, one encoder will be installed. The maximum number is 8 (as
defined by MAX_CHAN in sim_encoder.c).</p>
</div>
<div class="listingblock">
<div class="title">Removing</div>
<div class="content">
<pre>halcmd: unloadrt sim-encoder</pre>
</div>
</div>
<div class="ulist">
<div class="title">Pins</div>
<ul>
<li>
<p>'(float) sim-encoder.&lt;chan-num&gt;.speed' - The speed command for the
simulated shaft.</p>
</li>
<li>
<p>'(bit) sim-encoder.&lt;chan-num&gt;.phase-A' - Quadrature output.</p>
</li>
<li>
<p>'(bit) sim-encoder.&lt;chan-num&gt;.phase-B' - Quadrature output.</p>
</li>
<li>
<p>'(bit) sim-encoder.&lt;chan-num&gt;.phase-Z' - Index pulse output.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When '.speed' is positive, '.phase-A' leads '.phase-B'.</p>
</div>
<div class="ulist">
<div class="title">Parameters</div>
<ul>
<li>
<p>'(u32) sim-encoder.&lt;chan-num&gt;.ppr' - Pulses Per Revolution.</p>
</li>
<li>
<p>'(float) sim-encoder.&lt;chan-num&gt;.scale' - Scale Factor for 'speed'.
The default is 1.0, which means that 'speed' is in revolutions per
second. Change to 60 for RPM, to 360 for
degrees per second, 6.283185 for radians per seconed, etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that pulses per revolution is not the same as counts per
revolution. A pulse is a complete quadrature cycle. Most encoder
counters will count four times during one complete cycle.</p>
</div>
<div class="paragraph">
<div class="title">Functions</div>
<p>The component exports two functions. Each function affects all
simulated encoders.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(funct) sim-encoder.make-pulses' - High speed function to
generate quadrature pulses (no floating point).</p>
</li>
<li>
<p>'(funct) sim-encoder.update-speed' - Low speed function to read
'speed', do scaling, and set up 'make-pulses'.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sec:Debounce">Debounce</h3>
<div class="paragraph">
<p>Debounce is a realtime component that can filter the glitches created
by mechanical switch contacts. It may also be useful in other
applications where short pulses are to be rejected.</p>
</div>
<div class="listingblock">
<div class="title">Installing</div>
<div class="content">
<pre>halcmd: loadrt debounce cfg=&lt;config-string&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>'&lt;config-string&gt;' is a series of comma separated decimal integers.
Each number installs
a group of identical debounce filters, the number determines how many
filters are in the group.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halcmd: loadrt debounce cfg=1,4,2</pre>
</div>
</div>
<div class="paragraph">
<p>will install three groups of filters. Group 0 contains one filter,
group 1 contains four, and group 2 contains two filters. The default
value for '&lt;config-string&gt;' is '"1"' which will install a single group
containing a single filter. The
maximum number of groups 8 (as defined by MAX_GROUPS in debounce.c).
The maximum number of filters in a group is limited only by shared
memory space. Each group is completely independent. All filters in a
single group are identical, and they are all updated by the same
function at the same time. In the following descriptions, '&lt;G&gt;' is the
group number and '&lt;F&gt;' is the filter number within the group. The
first filter is group 0,
filter 0.</p>
</div>
<div class="listingblock">
<div class="title">Removing</div>
<div class="content">
<pre>halcmd: unloadrt debounce</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Pins</div>
<p>Each individual filter has two pins.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(bit) debounce.&lt;G&gt;.&lt;F&gt;.in' - Input of filter '&lt;F&gt;' in group '&lt;G&gt;'.</p>
</li>
<li>
<p>'(bit) debounce.&lt;G&gt;.&lt;F&gt;.out' - Output of filter '&lt;F&gt;' in group '&lt;G&gt;'.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Parameters</div>
<p>Each group of filters has one parameter<sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnote_7" title="View footnote.">7</a>]</sup>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(s32) debounce.&lt;G&gt;.delay' - Filter delay for all filters in group '&lt;G&gt;'.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The filter delay is in units of thread periods. The minimum delay is
zero. The output of a zero delay filter exactly follows its input - it
doesn&#8217;t filter anything. As 'delay' increases, longer and longer
glitches are rejected. If 'delay' is 4, all glitches less than or
equal to four thread periods will be rejected.</p>
</div>
<div class="paragraph">
<div class="title">Functions</div>
<p>Each group of filters has one function, which updates all the filters
in that group 'simultaneously'. Different groups of filters can be
updated from different threads at different periods.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(funct) debounce.&lt;G&gt;' - Updates all filters in group '&lt;G&gt;'.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="siggen-a-id-sec-siggen-a">Siggen<a id="sec:Siggen"></a></h3>
<div class="paragraph">
<p>Siggen is a realtime component that generates square, triangle, and
sine waves. It is primarily used for testing.</p>
</div>
<div class="listingblock">
<div class="title">Installing</div>
<div class="content">
<pre>halcmd: loadrt siggen [num_chan=&lt;chans&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>'&lt;chans&gt;' is the number of signal generators that you want to install.
If 'numchan' is not specified, one signal generator will be installed.
The maximum
number of generators is 16 (as defined by MAX_CHAN in siggen.c). Each
 generator is completely independent. In the following descriptions,
'&lt;chan&gt;' is the number of a specific signal generator (the numbers
start at 0).</p>
</div>
<div class="listingblock">
<div class="title">Removing</div>
<div class="content">
<pre>halcmd: unloadrt siggen</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Pins</div>
<p>Each generator has five output pins.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(float) siggen.&lt;chan&gt;.sine' - Sine wave output.</p>
</li>
<li>
<p>'(float) siggen.&lt;chan&gt;.cosine' - Cosine output.</p>
</li>
<li>
<p>'(float) siggen.&lt;chan&gt;.sawtooth' - Sawtooth output.</p>
</li>
<li>
<p>'(float) siggen.&lt;chan&gt;.triangle' - Triangle wave output.</p>
</li>
<li>
<p>'(float) siggen.&lt;chan&gt;.square' - Square wave output.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All five outputs have the same frequency, amplitude, and offset.</p>
</div>
<div class="paragraph">
<p>In addition to the output pins, there are three control pins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(float) siggen.&lt;chan&gt;.frequency' - Sets the frequency in Hertz,
default value is 1 Hz.</p>
</li>
<li>
<p>'(float) siggen.&lt;chan&gt;.amplitude' - Sets the peak amplitude of the
output waveforms, default is 1.</p>
</li>
<li>
<p>'(float) siggen.&lt;chan&gt;.offset' - Sets DC offset of the output
waveforms, default is 0.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if 'siggen.0.amplitude' is 1.0 and 'siggen.0.offset' is
0.0, the outputs will swing from -1.0 to +1.0. If 'siggen.0.amplitude'
is 2.5 and 'siggen.0.offset' is 10.0, then the outputs will swing from
7.5 to 12.5.</p>
</div>
<div class="paragraph">
<div class="title">Parameters</div>
<p>None. <sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnote_8" title="View footnote.">8</a>]</sup></p>
</div>
<div class="ulist">
<div class="title">Functions</div>
<ul>
<li>
<p>'(funct) siggen.&lt;chan&gt;.update' - Calculates new values for all five outputs.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sec:lut5">lut5</h3>
<div class="paragraph">
<p>The lut5 component is a 5 input logic component based on a look up table.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'lut5' does not require a floating point thread.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Installing</div>
<div class="content">
<pre>loadrt lut5 [count=N|names=name1[,name2...]]
addf lut5.N servo-thread | base-thread
setp lut5.N.function 0xN</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Computing Function</div>
<p>To compute the hexadecimal number for the function starting from the top put
a 1 or 0 to indicate if that row would be true or false. Next write down every
number in the output column starting from the top and writing them from right
to left. This will be the binary number. Using a calculator with a program
view like the one in Debian enter the binary number and then convert it to
hexadecimal and that will be the value for function.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 1. Look Up Table</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit 4</th>
<th class="tableblock halign-center valign-top">Bit 3</th>
<th class="tableblock halign-center valign-top">Bit 2</th>
<th class="tableblock halign-center valign-top">Bit 1</th>
<th class="tableblock halign-center valign-top">Bit 0</th>
<th class="tableblock halign-center valign-top">Output</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Two Input Example</div>
<p>In the following table we have selected the output state for each line
that we wish to be true.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 2. Look Up Table</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit 4</th>
<th class="tableblock halign-center valign-top">Bit 3</th>
<th class="tableblock halign-center valign-top">Bit 2</th>
<th class="tableblock halign-center valign-top">Bit 1</th>
<th class="tableblock halign-center valign-top">Bit 0</th>
<th class="tableblock halign-center valign-top">Output</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Looking at the output column of our example we want the output to be on
when Bit 0 or Bit 0 and Bit1 is on and nothing else. The binary number is
'b1010' (rotate the output 90 degrees CW). Enter this number into the
calculator then change the display to hexadecimal and the number needed for
function is '0xa'. The hexadecimal prefix is '0x'.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-userspace-python-components">Creating Userspace Python Components</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="basic-usage">Basic usage</h3>
<div class="paragraph">
<p>A userspace component begins by creating its pins and parameters, then
enters a loop which will periodically drive all the outputs from the
inputs. The following component copies the value seen on its input pin
('passthrough.in') to its output pin ('passthrough.out') approximately
once per second.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#!/usr/bin/python
import hal, time
h = hal.component("passthrough")
h.newpin("in", hal.HAL_FLOAT, hal.HAL_IN)
h.newpin("out", hal.HAL_FLOAT, hal.HAL_OUT)
h.ready()
try:
    while 1:
        time.sleep(1)
        h['out'] = h['in']
except KeyboardInterrupt:
    raise SystemExit</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the above listing into a file named "passthrough", make it
executable ('chmod +x'), and place it on your '$PATH'. Then try it out:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>halrun

halcmd: loadusr passthrough

halcmd: show pin

    Component Pins:
    Owner Type  Dir     Value  Name
     03   float IN          0  passthrough.in
     03   float OUT         0  passthrough.out

halcmd: setp passthrough.in 3.14

halcmd: show pin

    Component Pins:
    Owner Type  Dir     Value  Name
     03   float IN       3.14  passthrough.in
     03   float OUT      3.14  passthrough.out</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="userspace-components-and-delays">Userspace components and delays</h3>
<div class="paragraph">
<p>If you typed “show pin” quickly, you may see that 'passthrough.out'
still had its old value of 0. This is because of the call to
'time.sleep(1)', which makes the assignment to the output pin occur at
most once per second. Because this is a userspace component, the actual
delay between assignments can be much longer if the
memory used by the passthrough component is swapped to disk, the
assignment could be delayed until that memory is swapped back in.</p>
</div>
<div class="paragraph">
<p>Thus, userspace components are suitable for user-interactive elements
such as control panels (delays in the range of milliseconds are not
noticed, and longer delays are acceptable), but not for sending step
pulses to a stepper driver board (delays must always be in the range of
microseconds, no matter what).</p>
</div>
</div>
<div class="sect2">
<h3 id="create-pins-and-parameters">Create pins and parameters</h3>
<div class="listingblock">
<div class="content">
<pre>h = hal.component("passthrough")</pre>
</div>
</div>
<div class="paragraph">
<p>The component itself is created by a call to the constructor
'hal.component'. The arguments are the HAL component name and
(optionally) the
prefix used for pin and parameter names. If the prefix is not
specified, the component name is used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>h.newpin("in", hal.HAL_FLOAT, hal.HAL_IN)</pre>
</div>
</div>
<div class="paragraph">
<p>Then pins are created by calls to methods on the component object. The
arguments are: pin name suffix, pin type, and pin direction. For
parameters, the arguments are: parameter name suffix, parameter type,
and parameter direction.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. HAL Option Names<a id="cap:HAL-Option-Names"></a></caption>
<colgroup>
<col style="width: 42.8571%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Pin and Parameter Types:</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HAL_BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HAL_FLOAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HAL_S32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HAL_U32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Pin Directions:</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HAL_IN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HAL_OUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HAL_IO</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Parameter Directions:</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HAL_RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HAL_RW</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The full pin or parameter name is formed by joining the prefix and the
suffix with a ".", so in the example the pin created is called
'passthrough.in'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>h.ready()</pre>
</div>
</div>
<div class="paragraph">
<p>Once all the pins and parameters have been created, call the
'.ready()' method.</p>
</div>
<div class="sect3">
<h4 id="changing-the-prefix">Changing the prefix</h4>
<div class="paragraph">
<p>The prefix can be changed by calling the '.setprefix()' method. The
current prefix can be retrieved by calling the '.getprefix()' method.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reading-and-writing-pins-and-parameters">Reading and writing pins and parameters</h3>
<div class="paragraph">
<p>For pins and parameters which are also proper Python identifiers, the
value may be accessed or set using the attribute syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>h.out = h.in</pre>
</div>
</div>
<div class="paragraph">
<p>For all pins, whether or not they are also proper Python identifiers,
the value may be accessed or set using the subscript syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>h['out'] = h['in']</pre>
</div>
</div>
<div class="sect3">
<h4 id="driving-output-hal_out-pins">Driving output (HAL_OUT) pins</h4>
<div class="paragraph">
<p>Periodically, usually in response to a timer, all HAL_OUT pins should
be "driven" by assigning them a new value. This should be done whether
or not the value is different than the last one assigned. When a pin is
connected to a signal, its old output value is not copied into the
signal, so the proper value will only appear on the signal once the
component assigns a new value.</p>
</div>
</div>
<div class="sect3">
<h4 id="driving-bidirectional-hal_io-pins">Driving bidirectional (HAL_IO) pins</h4>
<div class="paragraph">
<p>The above rule does not apply to bidirectional pins. Instead, a
bidirectional pin should only be driven by the component when the
component wishes to change the value. For instance, in the canonical
encoder interface, the encoder component only sets the 'index-enable'
pin to <strong>FALSE</strong> (when an index pulse is seen and the old value is
<strong>TRUE</strong>), but never sets it to <strong>TRUE</strong>. Repeatedly driving the pin
<strong>FALSE</strong>  might cause the other connected component to act as though
another index pulse had been seen.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="exiting">Exiting</h3>
<div class="paragraph">
<p>A 'halcmd unload' request for the component is delivered as a
'KeyboardInterrupt' exception. When an unload request arrives, the
process should either
exit in a short time, or call the '.exit()' method on the component
if substantial work (such as reading or
writing files) must be done to complete the shutdown process.</p>
</div>
</div>
<div class="sect2">
<h3 id="project-ideas">Project ideas</h3>
<div class="ulist">
<ul>
<li>
<p>Create an external control panel with buttons, switches, and
indicators. Connect everything to a microcontroller, and connect the
microcontroller to the PC using a serial interface. Python has a very
capable serial interface module called
<a href="http://pyserial.sourceforge.net/">pyserial</a>
(Debian package name “python-serial”, in the universe repository)</p>
</li>
<li>
<p>Attach a <a href="http://lcdproc.omnipotent.net/">LCDProc</a>-compatible LCD module
and use it to display a digital readout with information of your choice
(Debian package name “lcdproc”, in the universe repository)</p>
</li>
<li>
<p>Create a virtual control panel using any GUI library supported by
Python (gtk, qt, wxwindows, etc)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="canonical-device-interfaces">Canonical Device Interfaces</h2>
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>By version 2.1, the HAL drivers should have all been updated to
match these specs. Send an email if you spot any problems.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cha:Canonical-Device-Interfaces">Introduction</h3>
<div class="paragraph">
<p>The following sections show the pins, parameters, and functions that
are supplied by “canonical devices”. All HAL device drivers should
supply the same pins and parameters, and implement the same behavior.</p>
</div>
<div class="paragraph">
<p>Note that the only the <code>&lt;io-type&gt;</code> and <code>&lt;specific-name&gt;</code> fields are
defined for a canonical device. The <code>&lt;device-name&gt;</code>, <code>&lt;device-num&gt;</code>,
and <code>&lt;chan-num&gt;</code> fields are set based on the characteristics of the
real device.</p>
</div>
</div>
<div class="sect2">
<h3 id="digital-input-a-id-sec-canondigin-a">Digital Input<a id="sec:CanonDigIn"></a></h3>
<div class="paragraph">
<p>The canonical digital input (I/O type field: <code>digin</code>) is quite simple.</p>
</div>
<div class="sect3">
<h4 id="pins-2">Pins</h4>
<div class="ulist">
<ul>
<li>
<p>(bit) <strong>in</strong>&#8201;&#8212;&#8201;State of the hardware input.</p>
</li>
<li>
<p>(bit) <strong>in-not</strong>&#8201;&#8212;&#8201;Inverted state of the input.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="parameters-2">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="functions">Functions</h4>
<div class="ulist">
<ul>
<li>
<p>(funct) <strong>read</strong>&#8201;&#8212;&#8201;Read hardware and set <code>in</code> and <code>in-not</code> HAL pins.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="digital-output-a-id-sec-canondigout-a">Digital Output<a id="sec:CanonDigOut"></a></h3>
<div class="paragraph">
<p>The canonical digital output (I/O type field: <code>digout</code>) is also very
simple.</p>
</div>
<div class="sect3">
<h4 id="pins-3">Pins</h4>
<div class="ulist">
<ul>
<li>
<p>(bit) <strong>out</strong>&#8201;&#8212;&#8201;Value to be written (possibly inverted) to the hardware
output.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="parameters-3">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p>(bit) <strong>invert</strong>&#8201;&#8212;&#8201;If TRUE, <strong>out</strong> is inverted before writing to the
hardware.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="functions-2">Functions</h4>
<div class="ulist">
<ul>
<li>
<p>(funct) <strong>write</strong>&#8201;&#8212;&#8201;Read <strong>out</strong> and <strong>invert</strong>, and set hardware output
accordingly.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="analog-input">Analog Input</h3>
<div class="paragraph">
<p>The canonical analog input (I/O type: <code>adcin</code> ). This is expected to
be used for analog to digital converters, which
convert e.g. voltage to a continuous range of values.</p>
</div>
<div class="sect3">
<h4 id="pins-4">Pins</h4>
<div class="ulist">
<ul>
<li>
<p>(float) <strong>value</strong>&#8201;&#8212;&#8201;The hardware reading, scaled according to the
<strong>scale</strong> and <strong>offset</strong> parameters. <strong>Value</strong> = ((input reading, in
hardware-dependent units) * <strong>scale</strong>) - <strong>offset</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="parameters-4">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p>(float) <strong>scale</strong>&#8201;&#8212;&#8201;The input voltage (or current) will be multiplied
by <strong>scale</strong> before being output to <strong>value</strong>.</p>
</li>
<li>
<p>(float) <strong>offset</strong>&#8201;&#8212;&#8201;This will be subtracted from the hardware input
voltage (or current) after the scale multiplier has been applied.</p>
</li>
<li>
<p>(float) <strong>bit_weight</strong>&#8201;&#8212;&#8201;The value of one least significant bit (LSB).
This is effectively the granularity of the input reading.</p>
</li>
<li>
<p>(float) <strong>hw_offset</strong>&#8201;&#8212;&#8201;The value present on the input when 0 volts is
applied to the input pin(s).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="functions-3">Functions</h4>
<div class="ulist">
<ul>
<li>
<p>(funct) <strong>read</strong>&#8201;&#8212;&#8201;Read the values of this analog input channel. This
may be used for
individual channel reads, or it may cause all channels to be read</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="analog-output">Analog Output</h3>
<div class="paragraph">
<p>The canonical analog output (I/O Type: <strong>adcout</strong>). This is intended
for any kind of hardware that can output a
more-or-less continuous range of values. Examples are digital to analog
converters or PWM generators.</p>
</div>
<div class="sect3">
<h4 id="pins-5">Pins</h4>
<div class="ulist">
<ul>
<li>
<p>(float) <strong>value</strong>&#8201;&#8212;&#8201;The value to be written. The actual value output
to the hardware will depend on the scale and offset parameters.</p>
</li>
<li>
<p>(bit) <strong>enable</strong>&#8201;&#8212;&#8201;If false, then output 0 to the hardware, regardless
of the <strong>value</strong> pin.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="parameters-5">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p>(float) <strong>offset</strong>&#8201;&#8212;&#8201;This will be added to the <strong>value</strong> before the
hardware is updated</p>
</li>
<li>
<p>(float) <strong>scale</strong>&#8201;&#8212;&#8201;This should be set so that an input of 1 on the
<strong>value</strong> pin will cause the analog output pin to read 1 volt.</p>
</li>
<li>
<p>(float) <strong>high_limit</strong> (optional)&#8201;&#8212;&#8201;When calculating the value to
output to the hardware, if <strong>value</strong> + <strong>offset</strong> is greater than
<strong>high_limit</strong>, then <strong>high_limit</strong> will be used instead.</p>
</li>
<li>
<p>(float) <strong>low_limit</strong> (optional)&#8201;&#8212;&#8201;When calculating the value to output
to the hardware, if <strong>value</strong> + <strong>offset</strong> is less than <strong>low_limit</strong>, then
<strong>low_limit</strong> will be used instead.</p>
</li>
<li>
<p>(float) <strong>bit_weight</strong> (optional)&#8201;&#8212;&#8201;The value of one least significant
bit (LSB), in volts (or mA, for current outputs)</p>
</li>
<li>
<p>(float) <strong>hw_offset</strong>  (optional)&#8201;&#8212;&#8201;The actual voltage (or current)
that will be output if 0 is written to the hardware.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="functions-4">Functions</h4>
<div class="paragraph">
<p>(funct) <strong>write</strong> &#8201;&#8212;&#8201;This causes the calculated value to be output to
the hardware. If enable is false, then the output will be 0,
regardless of <strong>value</strong>, <strong>scale</strong>, and <strong>offset</strong>.
The meaning of “0” is dependent on the hardware. For example, a
bipolar 12-bit A/D may need to write 0x1FF (mid scale) to the D/A get 0
volts from the hardware pin. If enable is true, read scale, offset and
value and output to the adc (<strong>scale</strong> * <strong>value</strong>) + <strong>offset</strong>. If enable
is false, then output 0.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hal-tools">HAL Tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:hal-tools"></a> </p>
</div>
<div class="sect2">
<h3 id="halcmd-a-id-sec-halcmd-a">Halcmd<a id="sec:Halcmd"></a></h3>
<div class="paragraph">
<p>Halcmd is a command line tool for manipulating the HAL. There is a
rather complete man page for halcmd, which will be installed if you
have installed Machinekit from either source or a package. If you have
compiled Machinekit for “run-in-place”, the man page is not installed, but it
is accessible. From the main Machinekit directory, do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>man -M docs/man halcmd</pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="#cha:HAL-tutorial">HAL Tutorial</a> has a number of examples of halcmd
usage, and is a good tutorial for halcmd.</p>
</div>
</div>
<div class="sect2">
<h3 id="halmeter-a-id-sec-halmeter-a">Halmeter<a id="sec:Halmeter"></a></h3>
<div class="paragraph">
<p>Halmeter is a 'voltmeter' for the HAL. It lets you look at a pin,
signal, or parameter, and displays the current value of that item. It
is pretty simple to use. Start it by typing <strong>halmeter</strong> in an X
windows shell. Halmeter is a GUI application. It will pop up
a small window, with two buttons labeled 'Select' and 'Exit'. Exit is
easy - it shuts down the program. Select pops up a larger window, with
three tabs. One tab lists all the pins currently defined in the HAL.
The next lists all the signals, and the last tab lists all the
parameters. Click on a tab, then click on a pin/signal/parameter. Then
click on 'OK'. The lists will disappear, and the small window will
display the name and value of the selected item. The display is updated
approximately 10 times per second. If you click 'Accept' instead of
'OK', the small window will display the name and value of the selected
item, but the large window will remain on the screen. This is
convenient if you want to look at a number of different items quickly.</p>
</div>
<div class="paragraph">
<p>You can have many halmeters running at the same time, if you want to
monitor several items. If you want to launch a halmeter without tying
up a shell window, type 'halmeter &amp;' to run it in the background.
You can also make halmeter start
displaying a specific item immediately, by adding 'pin|sig|par[am]
&lt;name&gt;' to the command line. It will display the pin, signal, or
parameter
&lt;name&gt; as soon as it starts. (If there is no such item, it will simply
start normally.) And finally, if you specify an item to display, you
can add '-s' before the pin|sig|param to tell halmeter to use a small
window. The item name will be displayed in the title bar instead of
under the value, and there will be no buttons. Useful when you want a
lot of meters in a small amount of screen space.</p>
</div>
<div class="paragraph">
<p>Refer to <a href="#sec:Tutorial-Halmeter">Halmeter Tutorial</a> section for more
information.</p>
</div>
<div class="paragraph">
<p>Halmeter can be loaded from a terminal or from Axis. Halmeter is
faster than Halshow at displaying values. Halmeter has two windows, one
to pick the pin, signal, or parameter to monitor and one that displays
the value. Multiple Halmeters can be open at the same time. If you use
a script to open multiple Halmeters you can set the position of each
one with -g X Y relative to the upper left corner of your screen.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadusr halmeter pin hm2.0.stepgen.00.velocity-fb -g 0 500</pre>
</div>
</div>
<div class="paragraph">
<p>See the man page for more options. See section <a href="#sec:Halmeter">Halmeter</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../hal/images/hal-meter01.png" alt="hal meter01">
</div>
<div class="title">Figure 20. Halmeter</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../hal/images/hal-meter02.png" alt="hal meter02">
</div>
</div>
</div>
<div class="sect2">
<h3 id="halscope-a-id-sec-halscope-a">Halscope<a id="sec:Halscope"></a></h3>
<div class="paragraph">
<p>Halscope is an 'oscilloscope' for the HAL. It lets you capture the
value of pins, signals, and parameters as a function of time. Complete
operating instructions should be located here eventually. For now,
refer to section  <a href="#sec:Tutorial-Halscope">[sec:Tutorial-Halscope]</a> in the tutorial chapter,
which explains the basics.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="halshow">Halshow</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:halshow"></a> </p>
</div>
<div class="paragraph">
<p>The script halshow can help you find your way around a running HAL.
This is a very specialized system and it must connect to a working HAL.
It cannot run standalone because it relies on the ability of HAL to
report what it knows of itself through the halcmd interface library. It
is discovery based. Each time halshow runs with a different Machinekit
configuration it will be different.</p>
</div>
<div class="paragraph">
<p>As we will soon see, this ability of HAL to document itself is one key
to making an effective CNC system.</p>
</div>
<div class="sect2">
<h3 id="starting-halshow">Starting Halshow</h3>
<div class="paragraph">
<p>Halshow is in the AXIS menu under Machine/Show HAL Configuration.</p>
</div>
<div class="paragraph">
<p>Halshow is in the TkMachinekit menu under Scripts/HAL Show.</p>
</div>
</div>
<div class="sect2">
<h3 id="hal-tree-area">HAL Tree Area</h3>
<div class="paragraph">
<p>At the left of its display as shown in figure  <a href="#cap:Halshow-Layout">[cap:Halshow-Layout]</a>
is a tree view, somewhat like you might see with some file browsers. At
the right is a tabbed notebook with tabs for show and watch.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../hal/images/halshow-1.png" alt="halshow 1">
</div>
<div class="title">Figure 21. Halshow Layout<a id="cap:Halshow-Layout"></a></div>
</div>
<div class="paragraph">
<p>The tree shows all of the major parts of a HAL. In front of each is a
small plus (+) or minus (-) sign in a box. Clicking the plus will
expand that tree node to display what is under it. If that box shows a
minus sign, clicking it will collapse that section of the tree.</p>
</div>
<div class="paragraph">
<p>You can also expand or collapse the tree display using the Tree View
menu at the upper left edge of the display. Under Tree View you will
find: Expand Tree, Collapse Tree; Expand Pins, Expand Parameters,
Expand Signals; and Erase Watch. (Note that Erase Watch erases 'all'
previously set watches, you cannot erase just one watch.)</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../hal/images/halshow-3.png" alt="halshow 3">
</div>
<div class="title">Figure 22. Show Menu<a id="cap:Show-Menu"></a></div>
</div>
</div>
<div class="sect2">
<h3 id="hal-show-area">HAL Show Area</h3>
<div class="paragraph">
<p>Clicking on the node name, the word "Components" for example, will
show you (under the "Show" tab) all that HAL knows about the contents
of that node. Figure  <a href="#cap:Halshow-Layout">[cap:Halshow-Layout]</a> shows a list exactly like
you will see if you click the "Components" name while you are running a
standard m5i20 servo card. The information display is exactly like
those shown in traditional text based HAL analysis tools. The advantage
here is that we have mouse click access, access that can be as broad or
as focused as you need.</p>
</div>
<div class="paragraph">
<p>If we take a closer look at the tree display we can see that the six
major parts of a HAL can all be expanded at least one level. As these
levels are expanded you can get more focused with the reply when you
click on the rightmost tree node. You will find that there are some HAL
pins and parameters that show more than one reply. This is due to the
nature of the search routines in halcmd itself. If you search one pin
you may get two, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Component Pins:
Owner  Type  Dir  Value  Name
06     bit    -W   TRUE  parport.0.pin-10-in
06     bit    -W  FALSE  parport.0.pin-10-in-not</pre>
</div>
</div>
<div class="paragraph">
<p>The second pin&#8217;s name contains the complete name of the first.</p>
</div>
<div class="paragraph">
<p>Below the show area on the right is a set of widgets that will allow
you to play with the running HAL. The commands you enter here and the
effect that they have on the running HAL are not saved. They will
persist as long as Machinekit remains up but are gone as soon as Machinekit is.</p>
</div>
<div class="paragraph">
<p>The entry box labeled "Test HAL Command:" will accept any of the
commands listed for halcmd. These include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>loadrt, unloadrt (load/unload real-time module)</p>
</li>
<li>
<p>loadusr, unloadusr (load/unload user-space component)</p>
</li>
<li>
<p>addf, delf (add/delete a function to/from a real-time thread)</p>
</li>
<li>
<p>net (create a connection between two or more items)</p>
</li>
<li>
<p>setp (set parameter (or pin) to a value)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This little editor will enter a command any time you press &lt;enter&gt; or
push the execute button. An error message from halcmd will show below
this entry widget when these commands are not properly formed. If you
are not certain how to set up a proper command you&#8217;ll need to read
again the documentation on halcmd and the specific modules that you are
working with.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s use this editor to add a differential module to a HAL and
connect it to axis position so that we could see the rate of change in
position, i.e., acceleration. We first need to load a HAL component named
blocks, add it to the servo thread, then connect it to the position pin
of an axis. Once that is done we can find the output of the
differentiator in halscope. So let&#8217;s go. (Yes, I looked this one up.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt blocks ddt=1</pre>
</div>
</div>
<div class="paragraph">
<p>Now look at the components node and you should see blocks in there
someplace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Loaded HAL Components:
ID Type        Name
10 User halcmd29800
09 User halcmd29374
08   RT      blocks
06   RT hal_parport
05   RT    scope_rt
04   RT     stepgen
03   RT      motmod
02 User   iocontrol</pre>
</div>
</div>
<div class="paragraph">
<p>Sure enough there it is. Notice that its ID is 08. Next we need to
find out what functions are available with it so we look at functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Exported Functions:
Owner  CodeAddr      Arg  FP Users Name
  08   E0B97630 E0DC7674 YES     0 ddt.0
  03   E0DEF83C 00000000 YES     1 motion-command-handler
  03   E0DF0BF3 00000000 YES     1 motion-controller
  06   E0B541FE E0DC75B8  NO     1 parport.0.read
  06   E0B54270 E0DC75B8  NO     1 parport.0.write
  06   E0B54309 E0DC75B8  NO     0 parport.read-all
  06   E0B5433A E0DC75B8  NO     0 parport.write-all
  05   E0AD712D 00000000  NO     0 scope.sample
  04   E0B618C1 E0DC7448 YES     1 stepgen.capture-position
  04   E0B612F5 E0DC7448  NO     1 stepgen.make-pulses
  04   E0B614AD E0DC7448 YES     1 stepgen.update-freq</pre>
</div>
</div>
<div class="paragraph">
<p>Here we look for owner #08 and see that blocks has exported a function
named ddt.0. We should be able to add ddt.0 to the servo thread and it
will do its math each time the servo thread is updated. Once again we
look up the addf command and find that it uses three arguments like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>addf &lt;functname&gt; &lt;threadname&gt; [&lt;position&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>We already know the functname=ddt.0 so let&#8217;s get the thread name right
by expanding the thread node in the tree. Here we see two threads,
servo-thread and base-thread. The position of ddt.0 in the thread is
not critical. So we add the function ddt.0 to the servo-thread:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>addf ddt.0 servo-thread</pre>
</div>
</div>
<div class="paragraph">
<p>This is just for viewing, so we leave position blank and get the last
position in the thread. Figure  <a href="#cap:Addf-Command">[cap:Addf-Command]</a> shows the state of
halshow after this command has been issued.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../hal/images/halshow-2.png" alt="halshow 2">
</div>
<div class="title">Figure 23. Addf Command<a id="cap:Addf-Command"></a></div>
</div>
<div class="paragraph">
<p>Next we need to connect this block to something. But how do we know
what pins are available? The answer is to look under pins. There we
find ddt and see this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Component Pins:
Owner Type  Dir Value       Name
08    float R-  0.00000e+00 ddt.0.in
08    float -W  0.00000e+00 ddt.0.out</pre>
</div>
</div>
<div class="paragraph">
<p>That looks easy enough to understand, but what signal or pin do we
want to connect to it? It could be an axis pin, a stepgen pin, or a
signal. We see this when we look at axis.0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Component Pins:
Owner Type  Dir Value       Name
03    float -W  0.00000e+00 axis.0.motor-pos-cmd ==&gt; Xpos-cmd</pre>
</div>
</div>
<div class="paragraph">
<p>So it looks like Xpos-cmd should be a good signal to use. Back to the
editor where we enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>linksp Xpos-cmd ddt.0.in</pre>
</div>
</div>
<div class="paragraph">
<p>Now if we look at the Xpos-cmd signal using the tree node we&#8217;ll see
what we&#8217;ve done:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Signals:
Type Value Name
float 0.00000e+00 Xpos-cmd
&lt;== axis.0.motor-pos-cmd
==&gt; ddt.0.in
==&gt; stepgen.0.position-cmd</pre>
</div>
</div>
<div class="paragraph">
<p>We see that this signal comes from axis.o.motor-pos-cmd and goes to
both ddt.0.in and stepgen.0.position-cmd. By connecting our block to
the signal we have avoided any complications with the normal flow of
this motion command.</p>
</div>
<div class="paragraph">
<p>The HAL Show Area uses halcmd to discover what is happening in a
running HAL. It gives you complete information about what it has
discovered. It also updates as you issue commands from the little
editor panel to modify that HAL. There are times when you want a
different set of things displayed without all of the information
available in this area. That is where the HAL Watch Area is of value.</p>
</div>
</div>
<div class="sect2">
<h3 id="hal-watch-area">HAL Watch Area</h3>
<div class="paragraph">
<p>Clicking the watch tab produces a blank canvas. You can add signals
and pins to this canvas and watch their values.<sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnote_9" title="View footnote.">9</a>]</sup>
You can add signals or pins when the watch tab is displayed by
clicking on the name of it. Figure  <a href="#cap:Watch-Display">[cap:Watch-Display]</a> shows this
canvas with several "bit" type signals. These signals include
enable-out for the first three axes and two of the three iocontrol
"estop" signals. Notice that the axes are not enabled even though the
estop signals say that Machinekit is not in estop. A quick look at TkMachinekit shows
that the condition of Machinekit is ESTOP RESET. The amp enables do not turn
true until the machine has been turned on.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../hal/images/halshow-4.png" alt="halshow 4">
</div>
<div class="title">Figure 24. <a id="cap:Watch-Display"></a>Watch Display</div>
</div>
<div class="paragraph">
<p>Watch displays bit type (binary) values using colored circles
representing LEDs. They show as dark brown when a bit signal or pin is
false, and as light yellow whenever that signal is true. If you select
a pin or signal that is not a bit type (binary) signal, watch will show
it as a numerical value.</p>
</div>
<div class="paragraph">
<p>Watch will quickly allow you to test switches or see the effect of
changes that you make to Machinekit while using the graphical interface.
Watch&#8217;s refresh rate is a bit slow to see stepper pulses, but you can
use it for these if you move an axis very slowly or in very small
increments of distance. If you&#8217;ve used IO_Show in Machinekit, the watch page
in halshow can be set up to watch a parport much as IO_Show did.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="developing">Developing</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="../developing/writing-components">Writing HAL Components</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="instcomp-hal-component-generator">instcomp HAL Component Generator</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:instcomp-hal-component-generator"></a> </p>
</div>
<div class="sect2">
<h3 id="introduction">Introduction</h3>
<div class="paragraph">
<p>instcomp is the Machinekit component pre-processor and compiler for instantiable components (.icomp)</p>
</div>
<div class="paragraph">
<p>This manual describes its operation in respect to how it differs from comp,
the default inherited Machinekit component compiler.</p>
</div>
<div class="paragraph">
<p>A familiarity with comp is therefore necessary and assumed.</p>
</div>
<div class="paragraph">
<p>The essential difference between normal realtime components and instantiable components,
is that 'normal components' are loaded once only and have to create as many copies of the
component as they need, all at once, there and then.</p>
</div>
<div class="paragraph">
<p>Instantiable components load the 'base component' and from that can create instances
of the component whenever they are required.
So instances can be created in separate hal files, on-the-fly or whatever.</p>
</div>
<div class="paragraph">
<p>Amoungst many advantages, it opens up huge flexibility in configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="naming-conventions">Naming Conventions</h3>
<div class="paragraph">
<p>All instantiable components are named to differentiate them from 'normal components'</p>
</div>
<div class="paragraph">
<p>The component files have the extension <strong>'.icomp'</strong></p>
</div>
<div class="paragraph">
<p>eg</p>
</div>
<div class="paragraph">
<p><strong>'ddt.icomp'</strong>  is the component file</p>
</div>
<div class="paragraph">
<p>produces a component called</p>
</div>
<div class="paragraph">
<p><strong>'ddt'</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="definitions">Definitions</h3>
<div class="sect3">
<h4 id="component">component -</h4>
<div class="paragraph">
<p>A component is a single real-time base module, which is loaded with 'halcmd loadrt'.</p>
</div>
<div class="paragraph">
<p>There are two parameters to <strong>loadrt</strong></p>
</div>
<div class="paragraph">
<p><strong>count=N</strong>  where N is the number of numbered instances to create</p>
</div>
<div class="paragraph">
<p><strong>names=name1,name2,name3</strong>  where the instances are named instead of numbered</p>
</div>
<div class="paragraph">
<p>By default <strong>loadrt component</strong> with no params or args, will create a single instance named <strong>component.0</strong></p>
</div>
<div class="paragraph">
<p>One '.icomp' file specifies one component.</p>
</div>
</div>
<div class="sect3">
<h4 id="newinstance">newinstance -</h4>
<div class="paragraph">
<p>Each instance of a component created with a call to <strong>'newinst'</strong></p>
</div>
<div class="paragraph">
<p>It is created roughly equal (they all have the same functions, and data)</p>
</div>
<div class="paragraph">
<p>in basic configuration, but with greater or lesser numbers of pins or parameters, different names etc</p>
</div>
<div class="paragraph">
<p>New instances can be created ad hoc, one for the use at this time and another differing instance created at a later stage.</p>
</div>
</div>
<div class="sect3">
<h4 id="function">function -</h4>
<div class="paragraph">
<p>The function is the part of the code that is attached to a thread and called at every thread period</p>
</div>
<div class="paragraph">
<p>You MUST declare at least one function in the declaration part of the icomp file above the <strong>';;'</strong> delimiters</p>
</div>
<div class="paragraph">
<p>In this instcomp differs from comp</p>
</div>
<div class="paragraph">
<p>eg.</p>
</div>
<div class="paragraph">
<p><strong>'function _;'</strong></p>
</div>
<div class="paragraph">
<p><strong>';;'</strong></p>
</div>
<div class="paragraph">
<p>This is perfectly sufficient where there is just one function</p>
</div>
<div class="paragraph">
<p>If there are more than one function, they must all be declared and uniquely named</p>
</div>
<div class="paragraph">
<p>eg.</p>
</div>
<div class="paragraph">
<p><strong>'function read nofp;'</strong>    ( specifying not a floating point thread - the default)</p>
</div>
<div class="paragraph">
<p><strong>'function write;'</strong></p>
</div>
<div class="paragraph">
<p><strong>';;'</strong></p>
</div>
<div class="paragraph">
<p>If unnamed the function will be called, <strong>component-name.0.funct</strong></p>
</div>
<div class="paragraph">
<p>halcmd allows just the base component name to be added to a thread, to keep existing configs working</p>
</div>
<div class="paragraph">
<p>So <strong>addf component-name servo-thread</strong> will work</p>
</div>
<div class="paragraph">
<p>What it actually does however is add the <strong>.funct</strong> bit on the end.</p>
</div>
<div class="paragraph">
<p>This is necessary to have unique naming of all pins, components and functions to assist in identifying when debugging.
Otherwise the actual component and the function would have the same name.</p>
</div>
<div class="paragraph">
<p>The function is exported as a xthread function.</p>
</div>
<div class="paragraph">
<p>The following accessors are available within the function:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>fa_period(fa) - formerly 'long period'"</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>fa_thread_start_time(fa): _actual_ start time of thread invocation"</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>fa_start_time(fa): _actual_ start time of function invocation"</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>fa_thread_name(fa): name of the calling thread (char *)"</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>fa_funct_name(fa): name of the this called function (char *)"</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="instance-creation">Instance creation</h3>
<div class="paragraph">
<p><strong>'newinst somecomponent somenewname &lt; pincount=0 &gt; &lt; other_instanceparam=xxx &gt; --- extra_arg1 extra_arg2 &#8230;&#8203;&#8230;&#8203;'</strong></p>
</div>
<div class="paragraph">
<p>Loads somecomponent and creates a new instance of somecomponent called somenewname</p>
</div>
<div class="paragraph">
<p>eg</p>
</div>
<div class="paragraph">
<p><strong>'newinst somecomponent somenewcomp8 pincount=8'</strong></p>
</div>
<div class="paragraph">
<p>then</p>
</div>
<div class="paragraph">
<p><strong>'addf somecomp8 servo-thread'</strong></p>
</div>
<div class="paragraph">
<p>adds the function to a thread</p>
</div>
<div class="paragraph">
<p>If you just want a component with the default number of pins, you can just use</p>
</div>
<div class="paragraph">
<p><strong>newinst componentname newcomponentname</strong></p>
</div>
<div class="paragraph">
<p>for a single named component instance with default pin numbers (if applicable)</p>
</div>
</div>
<div class="sect2">
<h3 id="instanceparams">Instanceparams</h3>
<div class="paragraph">
<p>These are a type of RTAPI_IP_xxx kernel module parameter used for passing values to the instance</p>
</div>
<div class="paragraph">
<p>Only types of RTAPI_IP_INT and RTAPI_IP_UINT are supported in instcomp.</p>
</div>
<div class="paragraph">
<p>These are declared in the .icomp file as for example</p>
</div>
<div class="paragraph">
<p><strong>instanceparam int pincount = 2;</strong></p>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="paragraph">
<p><strong>instanceparam u32 functn = 255;</strong></p>
</div>
<div class="paragraph">
<p>Any instanceparam used for counting index or scaling should normally be of type RTAPI_IP_INT  (signed int)</p>
</div>
<div class="paragraph">
<p>The UINT variant is provided for situations where conversion between hex and dec values and bit shifting for instance, can result
in incorrect returns using a signed integer</p>
</div>
<div class="paragraph">
<p>Strings are not supported as instanceparams.  Unlimited strings accessed by argc / argv mechanism can be passed using the extra_arg parameters.</p>
</div>
<div class="paragraph">
<p>The reason for this is that kernel module parameters were never envisaged to be used repeatedly by new instances.  Therefore they persist for the life of the
'base component' and are volatile, meaning the next instance will overwrite the values used by the previous one.</p>
</div>
<div class="paragraph">
<p>Saving a numerical value for use is quite simple, but saving a string which could be any length would involve allocating memory to duplicate it,
making it a wasteful process and requiring the explicit freeing of that memory when the instance exits.</p>
</div>
<div class="paragraph">
<p>For this reason, do not use the instanceparam value directly, access it through a copy in the inst_data struct which is named <strong>local_[instanceparamname]</strong></p>
</div>
<div class="paragraph">
<p>The most common example is in those components which create variable pin numbers through the 'pincount=NN' parameter.</p>
</div>
<div class="paragraph">
<p>The 'pincount' value is accessed via <strong>local_pincount</strong> in your component function body</p>
</div>
<div class="paragraph">
<p>See multiswitch and lutn examples below</p>
</div>
</div>
<div class="sect2">
<h3 id="backwards-compatability">Backwards compatability</h3>
<div class="paragraph">
<p>halcmd has been modified so that loadrt will work as previously, but with the new instantiated components.</p>
</div>
<div class="paragraph">
<p>Thus existing configs will still work for the most part using loadrt (see Notes below)</p>
</div>
<div class="paragraph">
<p>This includes the sim configs included with machinekit</p>
</div>
<div class="paragraph">
<p>The singleton component is supported by changes to halcmd, which will prevent more than one instance being loaded</p>
</div>
<div class="paragraph">
<p><strong>Notes:</strong></p>
</div>
<div class="sect3">
<h4 id="1">1</h4>
<div class="paragraph">
<p>Components with underscore separated names ( C style ) are created with the names as per the name of the component -</p>
</div>
<div class="paragraph">
<p>eg. <strong>loadrt charge_pump</strong> will create a module called <strong>charge_pump.0</strong></p>
</div>
<div class="paragraph">
<p>comp used to produce one called <strong>charge-pump.0</strong></p>
</div>
<div class="paragraph">
<p>The new naming is more logical, but may break a few configs</p>
</div>
<div class="paragraph">
<p>To keep an existing config working, simply load with <strong>newinst charge_pump charge-pump.0</strong> and you get a module the same name as the rest of your hal file expects.</p>
</div>
</div>
<div class="sect3">
<h4 id="2">2</h4>
<div class="paragraph">
<p>The parameters 'cfg=' or 'personality=' are deprecated and have no meaning with instantiated components</p>
</div>
<div class="paragraph">
<p>Those parameters will still work with the few legacy components that use them so heavily or in such a convoluted / obfuscated fashion, that they have not been converted to instantiable components</p>
</div>
<div class="paragraph">
<p>At present those components are:</p>
</div>
<div class="paragraph">
<p>bldc.comp</p>
</div>
<div class="paragraph">
<p>logic.comp</p>
</div>
</div>
<div class="sect3">
<h4 id="3">3</h4>
<div class="paragraph">
<p>Other components not converted, are those from C sources and those integral to the system and only ever intended to be loaded once per session</p>
</div>
<div class="paragraph">
<p>examples are:</p>
</div>
<div class="paragraph">
<p>stepgen</p>
</div>
<div class="paragraph">
<p>threads</p>
</div>
<div class="paragraph">
<p>See the src/hal/components directory for the remaining legacy components</p>
</div>
<div class="paragraph">
<p>It is likely that these remaining components will be converted in the future, when the next stage of SMP_SAFE components is introduced, which will allow components
running in different threads, on different CPU&#8217;s, to communicate and access each others data - but that is in the future right now :)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reserved-declarations-etc">Reserved declarations etc.</h3>
<div class="sect3">
<h4 id="pincount">'pincount'</h4>
<div class="paragraph">
<p>is the reserved instance parameter name, which can be used as a numerator and index for arrays</p>
</div>
<div class="paragraph">
<p>If it is set the option MAXCOUNT may be set too, as below</p>
</div>
<div class="paragraph">
<p><strong>'instanceparam int pincount = 8;'</strong></p>
</div>
<div class="paragraph">
<p><strong>option MAXCOUNT 16;</strong></p>
</div>
<div class="paragraph">
<p>(The pincount value will be used in the #define DEFAULTCOUNT as the default where no size is specified)</p>
</div>
<div class="paragraph">
<p>It can be used directly in the icomp file header as an array index size specifier</p>
</div>
<div class="paragraph">
<p>eg</p>
</div>
<div class="paragraph">
<p>pin in float in-##[pincount];</p>
</div>
<div class="paragraph">
<p>Within your code, in the function body, a local copy within the instance struct is used to get this value</p>
</div>
<div class="paragraph">
<p>for( x = 0; x &lt; localpincount; x++)
    {
    // do stuff
    }</p>
</div>
</div>
<div class="sect3">
<h4 id="maxcount">MAXCOUNT</h4>
<div class="paragraph">
<p>this option sets the maximum pins allowed to be created</p>
</div>
<div class="paragraph">
<p><strong>If any arrays of pins are used, MAXCOUNT will define the upper limit of pins set by instcomp</strong></p>
</div>
<div class="paragraph">
<p>It can only be set in the icomp header itself and cannot be altered</p>
</div>
<div class="paragraph">
<p>If not defined it is set to the value in pincount</p>
</div>
<div class="paragraph">
<p>Example 1.</p>
</div>
<div class="paragraph">
<p><strong>pin bit inval-##[pincount];</strong></p>
</div>
<div class="paragraph">
<p><strong>'instanceparam int pincount = 8;'</strong></p>
</div>
<div class="paragraph">
<p><strong>option MAXCOUNT 16;</strong></p>
</div>
<div class="paragraph">
<p>Thereafter a default creation of an instance will have 8 pins &lt;component&gt;.inval-00 to inval-07</p>
</div>
<div class="paragraph">
<p>Example 1a.</p>
</div>
<div class="paragraph">
<p>In the same component, if pincount is supplied as an argument to the newinst call,</p>
</div>
<div class="paragraph">
<p>it overrules the preset number of pins in arrays using 'pincount' as an index,</p>
</div>
<div class="paragraph">
<p>up to a maximum (MAXCOUNT) which was set in the .comp file and fixed when the component base was compiled</p>
</div>
<div class="paragraph">
<p><strong>newinst &lt;component&gt; newname pincount=16</strong></p>
</div>
<div class="paragraph">
<p>will result in a new instance of the component called newname, with 16 pins .inval-00 to .inval-15</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="extra-args">Extra args</h3>
<div class="paragraph">
<p>Any additional args which do not match the RTAPI_IP_PARAM parameters expected, are passed through the argc / argv mechanism to the new component</p>
</div>
<div class="paragraph">
<p>These should be separated from the instanceparam args with <strong>---</strong></p>
</div>
<div class="paragraph">
<p>eg:  <strong>'newinst somecomponent somenewname &lt; pincount=0 &gt; &lt; other_instanceparam=xxx &gt; --- extra_arg1 extra_arg2 &#8230;&#8203;&#8230;&#8203;'</strong></p>
</div>
<div class="paragraph">
<p>This allows the use of 'arg=value' type arguments without newinst believing it should be an instanceparam argument</p>
</div>
<div class="paragraph">
<p>Using in the comp file:-</p>
</div>
<div class="paragraph">
<p>'<strong>option extra_inst_setup; '</strong></p>
</div>
<div class="paragraph">
<p>allows you to create a function in your component, EXTRA_INST_SETUP(), which will receive the argc / argv data.
You can the parse and act upon extra arguments passed before the component is set 'ready'</p>
</div>
<div class="paragraph">
<p>See the message.icomp file for an example of passing strings via this mechanism and printing them when triggered.</p>
</div>
<div class="paragraph">
<p>A return value other than zero from this function will abort instance creation.</p>
</div>
<div class="paragraph">
<p>See also the lutn example</p>
</div>
</div>
<div class="sect2">
<h3 id="syntax-and-options-differences">Syntax and Options differences</h3>
<div class="paragraph">
<p>Some syntax and options are deprecated.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>'personality'</strong> has no meaning in these components, since instances are created singly and externally rather than within the component</p>
</li>
<li>
<p><strong>'cfg'</strong>         A parameter used with personality, no longer used</p>
</li>
<li>
<p><strong>'count'</strong>       Preserved for backward compability with simple loadrt commands, see Backward Compatability section above, but not used by the component itself or with newinst commands</p>
</li>
<li>
<p><strong>'names'</strong>       Just a synonym for count really, same comments apply</p>
</li>
<li>
<p><strong>'userspace'</strong>  No support for userspace at this time, use the comp / halcompile compiler</p>
</li>
<li>
<p><strong>'data'</strong>       Any data to be preserved between polls to the component can be stored in variables in the declaration section of the icomp (below the pin declarations).
Use of typedefed structs accessed via a void *_data pointer are no longer supported</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="options">Options</h3>
<div class="paragraph">
<p>The differing options are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>'option extra_inst_setup yes'</strong> - (default: no)
If specified, call the function defined by 'EXTRA_INST_SETUP' for each
instance.
argc and argv are passed to this function, so it is a good place to parse
additional arguments passed to the component in the newinst call</p>
</li>
<li>
<p><strong>'option extra_inst_cleanup yes'</strong> - (default: no)
If specified, call the function defined by 'EXTRA_INST_CLEANUP' from the
automatically defined 'rtapi_app_exit', or if an error is detected
in the automatically defined 'rtapi_app_main'.</p>
</li>
<li>
<p><strong>'instanceparam [int ] param_name = &lt;value&gt;'</strong>
Instanceparams that may be passed to the component at newinst
If value not set, will be set to 0</p>
</li>
<li>
<p><strong>'singleton'</strong>   will only allow one instance to be loaded anywhere within a single session
This is contrary to the basic premise of instantiated components, but implemented for compatibility</p>
</li>
<li>
<p><strong>'option MAXCOUNT'</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>New options:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>NEW - instcomp now produces documentation manual pages in both groff and asciidoc format.
asciidoc format is selected by building Machinekit with the configure option
*--enable-build-documentation=asciidoc*</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>'option special_format_doc' (default: none)
The option will always be used in combination with the 'special_format_man' option below.
This option is to allow a piece of asciidoc text to be inserted in a formatted form immediately
after the main description in the asciidoc rendering of the manual page.
An example of when you might want to do this, is when wanting to display a table, the formatting of
which is completely different in groff and asciidoc, so you would have 2 different table formats
and the appropriate one is selected to render the required document.
An example is the <strong>lutn5.icomp</strong> component.</p>
</li>
<li>
<p>'option special_format_man' (default: none)
As previous, except contains formatting peculiar to groff man pages.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="restrictions">Restrictions</h3>
<div class="paragraph">
<p>Though HAL permits a pin, a parameter, and a function to have the same
name, instcomp does not.</p>
</div>
<div class="paragraph">
<p>Variable and function names that can not be used or are likely to cause
problems include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Anything beginning with 'inst'</p>
</li>
<li>
<p>'comp_id'</p>
</li>
<li>
<p>'fperiod'</p>
</li>
<li>
<p>'rtapi_app_main'</p>
</li>
<li>
<p>'rtapi_app_exit'</p>
</li>
<li>
<p>'extra_inst_setup'</p>
</li>
<li>
<p>'extra_inst_cleanup'</p>
</li>
<li>
<p>'function'</p>
</li>
<li>
<p>'pincount'</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="compiling">Compiling</h3>
<div class="paragraph">
<p>Same syntax and options as comp, just use instcomp instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples">Examples</h3>
<div class="paragraph">
<p>Best form of explanation, below are 3 components demonstrating the
differing option usages etc.</p>
</div>
<div class="sect3">
<h4 id="constant">constant</h4>
<div class="paragraph">
<p>Note this component is no different to the standard component.
The C code that is created is different and allows instantiation
but at comp file level, because arrays are not used and no need to
preset an pincount for the default pin numbers, it all looks the same</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">component constant "Use a parameter to set the value of a pin";
pin out float out;
param rw float value;

function _;
license "GPL";
;;
FUNCTION(_) {
    out = value;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="multiswitch">multiswitch</h4>
<div class="paragraph">
<p>This component uses an array of bit pins indexed with pincount
Maximum number of pins are 16 and the default is 6,</p>
</div>
<div class="paragraph">
<p>extra_inst_setup is used, but just for initialisation of values
before entering the main loop</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">component multiswitch           """This component toggles between a specified number of output bits""";

pin in bit up = false           "Receives signal to toggle up";
pin in bit down = false         "Receives signal to toggle down";

param rw unsigned top-position  "Number of positions";
param rw signed position      "Current state (may be set in the HAL)";

pin out bit bit-##[pincount] = false       "Output bits";

instanceparam int pincount = 6;

option MAXCOUNT 16;

function _ ;
option extra_inst_setup yes;

variable int old_up = 0;
variable int old_down = 0;

author "ArcEye arceye@mgware.co.uk / Andy Pugh andy@bodgesoc.org";
license "GPL2";
;;


FUNCTION(_)
{
    int i;

    // debounce
    if (up &amp;&amp; !old_up) { position++; }
    if (down &amp;&amp; !old_down) { position--;}
    old_up = up;
    old_down = down;

    if (position &lt; 0) position = top_position;
    if (position &gt; top_position) position = 0;

    for (i = 0 ; i &lt; localpincount; i++){
        bit(i) = (i == position);
    }

}

EXTRA_INST_SETUP(){
    top_position = localpincount - 1;
    return 0;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="lutn">lutn</h4>
<div class="paragraph">
<p>This component has the same instanceparam features as before,
with an extra instanceparam defined - a unsigned int functn which takes a hex value</p>
</div>
<div class="paragraph">
<p>It shows how to take further args not defined as instanceparams, which are passed
through the argc / argv mechanism and printed in extra_inst_setup()</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// instantiable lookup table component with configurable number of pins
// usage:
//
// halcmd newinst lutn and2 pincount=2 functn=0x8 arg1 arg2
// halcmd newinst lutn or2  pincount=2 functn=0xe arg1 arg2



component lutn "instantiable lookup table component with configurable number of pins";

    // Input Pins
pin in bit in-##[pincount];
pin out bit out;

instanceparam int pincount = 2;

option MAXCOUNT 5;

instanceparam uint functn = 0;

option extra_inst_setup;

license "GPL";
author "Michael Haberler";

function _;
;;


FUNCTION(_)
{
int i;
int shift = 0;

    for (i = 0; i &lt; localpincount; i++)
    if (in(i))
        shift += (1 &lt;&lt; i);

    out = (functn &amp; (1 &lt;&lt; shift)) != 0;
}

// extra args not related to instanceparams can be parsed and dealt with here

EXTRA_INST_SETUP()
{
int x;

    for(x = 0; x &lt; argc; x++)
        hal_print_msg(RTAPI_MSG_ERR,"argv[%d] = %s", x, argv[x]);

    return 0;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="comp-hal-component-generator">Comp HAL Component Generator</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:comp-hal-component-generator"></a> </p>
</div>
<div class="sect2">
<h3 id="introduction-2">Introduction</h3>
<div class="paragraph">
<p>Writing a HAL component can be a tedious process, most of it in setup
calls to 'rtapi_' and 'hal_' functions and associated error checking.
'comp' will write all this code for you, automatically.</p>
</div>
<div class="paragraph">
<p>Compiling a HAL component is also much easier when using 'comp',
whether the component is part of the Machinekit source tree, or outside it.</p>
</div>
<div class="paragraph">
<p>For instance, when coded in C, a simple component such as "ddt" is around 80
lines of code. The equivalent component is very short when written using the
'comp' preprocessor:</p>
</div>
<div class="listingblock">
<div class="title">Simple Comp Example <a id="code:simple-comp-example"></a></div>
<div class="content">
<pre>component ddt "Compute the derivative of the input function";
pin in float in;
pin out float out;
variable float old;
function _;
license "GPL"; // indicates GPL v2 or later
;;
float tmp = in;
out = (tmp - old) / fperiod;
old = tmp;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="installing-3">Installing</h3>
<div class="paragraph">
<p>If you&#8217;re working with an installed version of Machinekit you will need to install
the development packages.</p>
</div>
<div class="paragraph">
<p>One method is to say following line in a terminal.</p>
</div>
<div class="listingblock">
<div class="title">Installing Dev</div>
<div class="content">
<pre>sudo apt-get install machinekit-dev</pre>
</div>
</div>
<div class="paragraph">
<p>Another method is to use the Synaptic Package Manager from the main Debian menu
to install machinekit-dev.</p>
</div>
</div>
<div class="sect2">
<h3 id="definitions-2">Definitions</h3>
<div class="ulist">
<ul>
<li>
<p>'component' - A component is a single real-time module, which is loaded with 'halcmd
loadrt'. One '.comp' file specifies one component.</p>
</li>
<li>
<p>'instance' - A component can have zero or more instances. Each instance of a
component is created equal (they all have the same pins, parameters,
functions, and data) but behave independently when their pins,
parameters, and data have different values.</p>
</li>
<li>
<p>'singleton' - It is possible for a component to be a "singleton", in which case
exactly one instance is created. It seldom makes sense to write a
'singleton'  component, unless there can literally only be a single
object of that
kind in the system (for instance, a component whose purpose is to
provide a pin with the current UNIX time, or a hardware driver for the
internal PC speaker)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="instance-creation-2">Instance creation</h3>
<div class="paragraph">
<p>For a singleton, the one instance is created when the component is
loaded.</p>
</div>
<div class="paragraph">
<p>For a non-singleton, the 'count' module parameter determines how many numbered
instances are created.  If not specified, the 'name' module parameter
determines how many named instances are created.  Otherwise, a single numbered
instance is created.</p>
</div>
</div>
<div class="sect2">
<h3 id="implicit-parameters">Implicit Parameters</h3>
<div class="paragraph">
<p>Functions are implicitly passed the 'period' parameter which is the time in
nanoseconds of the last period to execute the comp.  Functions which use
floating-point can also refer to 'fperiod' which is the floating-point time in
seconds, or (period*1e-9).  This can be useful in comps that need the timing
information.</p>
</div>
</div>
<div class="sect2">
<h3 id="syntax">Syntax</h3>
<div class="paragraph">
<p>A '.comp' file consists of a number of declarations, followed by ';;'
on a line of its own, followed by C code implementing the module&#8217;s
functions.</p>
</div>
<div class="paragraph">
<p>Declarations include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'component HALNAME (DOC);'</p>
</li>
<li>
<p>'pin PINDIRECTION TYPE HALNAME ([SIZE]|[MAXSIZE: CONDSIZE]) (if CONDITION) (= STARTVALUE) (DOC) ;'</p>
</li>
<li>
<p>'param PARAMDIRECTION TYPE HALNAME ([SIZE]|[MAXSIZE: CONDSIZE]) (if CONDITION) (= STARTVALUE) (DOC) ;'</p>
</li>
<li>
<p>'function HALNAME (fp | nofp) (DOC);'</p>
</li>
<li>
<p>'option OPT (VALUE);'</p>
</li>
<li>
<p>'variable CTYPE STARREDNAME ([SIZE]);'</p>
</li>
<li>
<p>'description DOC;'</p>
</li>
<li>
<p>'see_also DOC;'</p>
</li>
<li>
<p>'license LICENSE;'</p>
</li>
<li>
<p>'author AUTHOR;'</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Parentheses indicate optional items. A vertical bar indicates
alternatives. Words in 'CAPITALS' indicate variable text, as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'NAME' - A standard C identifier</p>
</li>
<li>
<p>'STARREDNAME' - A C identifier with zero or more * before it.  This syntax can be used
to declare instance variables that are pointers.  Note that because of the
grammar, there may not be whitespace between the * and the variable name.</p>
</li>
<li>
<p>'HALNAME' - An extended identifier.
When used to create a HAL identifier, any underscores are replaced
with dashes, and any trailing dash or period is removed, so that
"this_name_" will be turned into "this-name", and if the name is "_",
then a trailing period is removed as well, so that "function _" gives
a HAL function name like "component.&lt;num&gt;" instead of "component.&lt;num&gt;."</p>
<div class="paragraph">
<p>If present, the prefix 'hal_'  is removed from the beginning of the
component name when creating pins, parameters and functions.</p>
</div>
<div class="paragraph">
<p>In the HAL identifier for a pin or parameter, # denotes an array item,
and must be used in conjunction with a '[SIZE]'  declaration. The hash
marks are replaced with a 0-padded number with
the same length as the number of # characters.</p>
</div>
<div class="paragraph">
<p>When used to create a C identifier, the following changes are applied
to the HALNAME:</p>
</div>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Any "#" characters, and any ".", "_" or "-" characters immediately
before them, are removed.</p>
</li>
<li>
<p>Any remaining "." and "-" characters are replaced with "_".</p>
</li>
<li>
<p>Repeated "_" characters are changed to a single "\_" character.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A trailing "_" is retained, so that HAL identifiers which would otherwise
collide with reserved names or keywords (e.g., 'min') can be used.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">HALNAME</th>
<th class="tableblock halign-left valign-top">C Identifier</th>
<th class="tableblock halign-left valign-top">HAL Identifier</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x_y_z</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x_y_z</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x-y-z</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x-y.z</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x_y_z</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x-y.z</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x_y_z_</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x_y_z_</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x-y-z</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x.##.y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x_y(MM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x.MM.z</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x.##</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x(MM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x.MM</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
<li>
<p>'if CONDITION' - An expression involving the variable 'personality' which is nonzero
when the pin or parameter should be created</p>
</li>
<li>
<p>'SIZE' - A number that gives the size of an array. The array items are numbered
from 0 to 'SIZE'-1.</p>
</li>
<li>
<p>'MAXSIZE : CONDSIZE' - A number that gives the maximum size of the array followed by an
expression involving the variable 'personality' and which always
evaluates to less than 'MAXSIZE'. When the array is created its size
will be 'CONDSIZE'.</p>
</li>
<li>
<p>'DOC' - A string that documents the item.</p>
<div class="literalblock">
<div class="content">
<pre>NEW - comp now produces documentation manual pages in both groff and asciidoc format
asciidoc format is selected by building Machinekit with the configure option
*--enable-build-documentation=asciidoc*</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The string can be a C-style "double quoted" string, like:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre>"Selects the desired edge: TRUE means falling, FALSE means rising"</pre>
</div>
</div>
<div class="paragraph">
<p>+
or a Python-style "triple quoted" string, which
may include embedded newlines and quote characters, such as:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre>"""The effect of this parameter, also known as "the orb of zot",
will require at least two paragraphs to explain.

Hopefully these paragraphs have allowed you to understand "zot"
better."""</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>The documentation string is in plain text. Any groff formatting or asciidoc format
is applied by comp during the document generation phase.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Do NOT use any formatting within this string or your documentation will not
render correctly</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>'TYPE' - One of the HAL types: 'bit', 'signed', 'unsigned', or 'float'. The old
names 's32' and 'u32' may also be used, but 'signed' and 'unsigned' are
preferred.</p>
</li>
<li>
<p>'PINDIRECTION' - One of the following: 'in', 'out', or 'io'. A component sets a value
for an 'out' pin, it reads a value from an 'in' pin, and it may read or
set the value of an 'io' pin.</p>
</li>
<li>
<p>'PARAMDIRECTION' - One of the following: 'r' or 'rw'. A component sets a value for a 'r'
parameter, and it may read or set the value of a 'rw' parameter.</p>
</li>
<li>
<p>'STARTVALUE' - Specifies the initial value of a pin or parameter. If it is not
specified, then the default is '0' or 'FALSE', depending on the type of
the item.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="hal-functions">HAL functions</h4>
<div class="ulist">
<ul>
<li>
<p>'fp' - Indicates that the function performs floating-point calculations.</p>
</li>
<li>
<p>'nofp' - Indicates that it only performs integer calculations. If neither is
specified, 'fp' is assumed. Neither comp nor gcc can detect the use of
floating-point calculations in functions that are tagged 'nofp', but use of
such operations results in undefined behavior.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="options-2">Options</h4>
<div class="paragraph">
<p>The currently defined options are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'option singleton yes' - (default: no)
Do not create a 'count' module parameter, and always create a single
instance. With 'singleton', items are named 'component-name.item-name'
and without 'singleton', items for numbered instances are named
'component-name.&lt;num&gt;.item-name'.</p>
</li>
<li>
<p>'option default_count number' - (default: 1)
Normally, the module parameter 'count' defaults to 1. If specified,
the 'count' will default to this value instead.</p>
</li>
<li>
<p>'option count_function yes' - (default: no)
Normally, the number of instances to create is specified in the
module parameter 'count'; if 'count_function' is specified, the value
returned by the function 'int get_count(void)' is used instead,
and the 'count' module parameter is not defined.</p>
</li>
<li>
<p>'option rtapi_app no' - (default: yes)
Normally, the functions 'rtapi_app_main' and 'rtapi_app_exit' are
automatically defined. With 'option rtapi_app no', they are not, and
must be provided in the C code.
When implementing your own 'rtapi_app_main', call the function 'int
export(char *prefix, long extra_arg)' to register the pins,
parameters, and functions for 'prefix'.</p>
</li>
<li>
<p>'option data TYPE' - (default: none) <strong>deprecated</strong>
If specified, each instance of the component will have an associated
data block of type 'TYPE' (which can be a simple type like 'float' or the
name of a type created with 'typedef').
In new components, 'variable' should be used instead.</p>
</li>
<li>
<p>'option extra_setup yes' - (default: no)
If specified, call the function defined by 'EXTRA_SETUP' for each
instance. If using the automatically defined 'rtapi_app_main',
'extra_arg' is the number of this instance.</p>
</li>
<li>
<p>'option extra_cleanup yes' - (default: no)
If specified, call the function defined by 'EXTRA_CLEANUP' from the
automatically defined 'rtapi_app_exit', or if an error is detected
in the automatically defined 'rtapi_app_main'.</p>
</li>
<li>
<p>'option userspace yes' - (default: no)
If specified, this file describes a userspace component, rather
than a real one. A userspace component may not have functions
defined by the 'function'  directive. Instead, after all the
instances are constructed, the C function 'user_mainloop()'
is called. When this function returns, the component exits.
Typically, 'user_mainloop()' will use 'FOR_ALL_INSTS()' to
perform the update action for each instance, then sleep for
a short time. Another common action in 'user_mainloop()' may
be to call the event handler loop of a GUI toolkit.</p>
</li>
<li>
<p>'option userinit yes' - (default: no)
This option is ignored if the option 'userspace' (see above) is set to
'no'.  If 'userinit' is specified, the function 'userinit(argc,argv)'
is called before 'rtapi_app_main()' (and thus before the call to
'hal_init()' ). This function may process the commandline arguments or
take other actions. Its return type is 'void'; it may call 'exit()'
if it wishes to terminate rather than create a HAL component (for
instance, because the commandline arguments were invalid).</p>
</li>
<li>
<p>'option special_format_doc' (default: none)
The option will always be used in combination with the 'special_format_man' option below.
This option is to allow a piece of asciidoc text to be inserted in a formatted form immediately
after the main description in the asciidoc rendering of the manual page.
An example of when you might want to do this, is when wanting to display a table, the formatting of
which is completely different in groff and asciidoc, so you would have 2 different table formats
and the appropriate one is selected to render the required document.
An example is the <strong>lutn5.icomp</strong> component.</p>
</li>
<li>
<p>'option special_format_man' (default: none)
As previous, except contains formatting peculiar to groff man pages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an option&#8217;s VALUE is not specified, then it is equivalent to
specifying 'option … yes'.
The result of assigning an inappropriate value to an option is undefined.
The result of using any other option is undefined.</p>
</div>
</div>
<div class="sect3">
<h4 id="license-and-authorship">License and Authorship</h4>
<div class="ulist">
<ul>
<li>
<p>'LICENSE' - Specify the license of the module for the documentation and for the
MODULE_LICENSE() module declaration. For example, to specify that the
module&#8217;s license is GPL v2 or later,</p>
<div class="literalblock">
<div class="content">
<pre>license "GPL"; // indicates GPL v2 or later</pre>
</div>
</div>
<div class="paragraph">
<p>For additional information on the meaning of MODULE_LICENSE() and
additional license identifiers, see '&lt;linux/module.h&gt;'. or the manual page
'rtapi_module_param(3)'</p>
</div>
<div class="paragraph">
<p>This declaration is required.</p>
</div>
</li>
<li>
<p>'AUTHOR' - Specify the author of the module for the documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="per-instance-data-storage">Per-instance data storage</h4>
<div class="ulist">
<ul>
<li>
<p>'variable CTYPE STARREDNAME;'</p>
</li>
<li>
<p>'variable CTYPE STARREDNAME[SIZE];'</p>
</li>
<li>
<p>'variable CTYPE STARREDNAME = DEFAULT;'</p>
</li>
<li>
<p>'variable CTYPE STARREDNAME[SIZE] = DEFAULT;'</p>
<div class="paragraph">
<p>Declare a per-instance variable 'STARREDNAME' of type 'CTYPE', optionally as
an array of 'SIZE' items, and optionally with a default value
'DEFAULT'. Items with no 'DEFAULT' are initialized to all-bits-zero.
'CTYPE' is a simple one-word C type, such as 'float', 'u32', 's32',
int, etc. Access to array variables uses square brackets.</p>
</div>
<div class="paragraph">
<p>If a variable is to be of a pointer type, there may not be any space
between the "*" and the variable name.
Therefore, the following is acceptable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>variable int *example;</pre>
</div>
</div>
<div class="paragraph">
<p>but the following are not:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>variable int* badexample;
variable int * badexample;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="comments">Comments</h4>
<div class="paragraph">
<p>C++-style one-line comments (//&#8230;&#8203; ) and</p>
</div>
<div class="paragraph">
<p>C-style multi-line comments (/* &#8230;&#8203; */) are both supported in the declaration section.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="restrictions-2">Restrictions</h3>
<div class="paragraph">
<p>Though HAL permits a pin, a parameter, and a function to have the same
name, comp does not.</p>
</div>
<div class="paragraph">
<p>Variable and function names that can not be used or are likely to cause
problems include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Anything beginning with '<em>_comp</em>'.</p>
</li>
<li>
<p>'comp_id'</p>
</li>
<li>
<p>'fperiod'</p>
</li>
<li>
<p>'rtapi_app_main'</p>
</li>
<li>
<p>'rtapi_app_exit'</p>
</li>
<li>
<p>'extra_setup'</p>
</li>
<li>
<p>'extra_cleanup'</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="convenience-macros">Convenience Macros</h3>
<div class="paragraph">
<p>Based on the items in the declaration section, 'comp' creates a C
structure called 'struct state'. However, instead of referring to the
members of this structure (e.g., '*(inst&#8594;name)' ), they will generally
be referred to using the macros below. The
details of 'struct state' and these macros may change from one version
of 'comp' to the next.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'FUNCTION(name)' - Use this macro to begin the definition of a realtime function which
was previously declared with 'function NAME'. The function includes a
parameter 'period' which is the integer number of nanoseconds
between calls to the
function.</p>
</li>
<li>
<p>'EXTRA_SETUP()' - Use this macro to begin the definition of the function called to
perform extra setup of this instance. Return a negative Unix 'errno'
value to indicate failure (e.g., 'return -EBUSY' on failure to reserve
an I/O port), or 0 to indicate success.</p>
</li>
<li>
<p>'EXTRA_CLEANUP()' - Use this macro to begin the definition of the function called to
perform extra cleanup of the component. Note that this function must
clean up all instances of the component, not just one. The "pin_name",
"parameter_name", and "data" macros may not be used here.</p>
</li>
<li>
<p>'pin_name' or 'parameter_name' - For each pin 'pin_name' or param 'parameter_name'
there is a macro which allows the name to be used on its own to refer
to the pin or parameter.
When 'pin_name' or 'parameter_name' is an array, the macro is of the
form 'pin_name(idx)' or 'param_name(idx)' where 'idx'  is the index
into the pin array. When the array is a variable-sized
array, it is only legal to refer to items up to its 'condsize'.</p>
<div class="paragraph">
<p>When the item is a conditional item, it is only legal to refer to it
    when its 'condition' evaluated to a nonzero value.</p>
</div>
</li>
<li>
<p>'variable_name' - For each variable 'variable_name'  there is a macro which allows the
name to be used on its own to refer
 to the variable. When 'variable_name' is an array, the normal C-style
subscript is used: 'variable_name[idx]'</p>
</li>
<li>
<p>'data' - If "option data" is specified, this macro allows access to the
instance data.</p>
</li>
<li>
<p>'fperiod' - The floating-point number of seconds between calls to this realtime
function.</p>
</li>
<li>
<p>'FOR_ALL_INSTS() {&#8230;&#8203;}' - For userspace components. This macro uses the variable 'struct
state 'inst' to iterate over all the defined instances. Inside the
body of the
 loop, the 'pin_name', 'parameter_name', and 'data' macros work as they
do in realtime functions.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="components-with-one-function">Components with one function</h3>
<div class="paragraph">
<p>If a component has only one function and the string "FUNCTION" does
not appear anywhere after ';;', then the portion after ';;' is all
taken to be the body of the component&#8217;s single function. See the
<a href="#code:simple-comp-example">Simple Comp</a> for and example of this.</p>
</div>
</div>
<div class="sect2">
<h3 id="component-personality">Component Personality</h3>
<div class="paragraph">
<p>If a component has any pins or parameters with an "if condition" or
"[maxsize : condsize]", it is called a component with 'personality'.
The 'personality' of each instance is specified when the module is
loaded. 'Personality' can be used to create pins only when needed.
For instance, personality is used in the 'logic' component, to allow
for a variable number of input pins to each logic gate and to allow
for a selection of any of the basic boolean logic functions 'and',
'or', and 'xor'.</p>
</div>
</div>
<div class="sect2">
<h3 id="compiling-2">Compiling</h3>
<div class="paragraph">
<p>Place the '.comp' file in the source directory
'machinekit/src/hal/components' and re-run 'make'.
'Comp' files are automatically detected by the build system.</p>
</div>
<div class="paragraph">
<p>If a '.comp' file is a driver for hardware, it may be placed in
'machinekit/src/hal/components' and will be built unless Machinekit is
configured as a userspace simulator.</p>
</div>
</div>
<div class="sect2">
<h3 id="sec:Compiling-realtime-components">Compiling realtime components outside the source tree</h3>
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>'comp' can process, compile, and install a realtime component
in a single step, placing 'rtexample.ko' in the Machinekit realtime
module directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>comp --install rtexample.comp</pre>
</div>
</div>
<div class="paragraph">
<p>Or, it can process and compile in one step, leaving 'example.ko' (or
'example.so' for the simulator) in the current directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>comp --compile rtexample.comp</pre>
</div>
</div>
<div class="paragraph">
<p>Or it can simply process, leaving 'example.c' in the current directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>comp rtexample.comp</pre>
</div>
</div>
<div class="paragraph">
<p>'comp' can also compile and install a component written in C, using
the '--install' and '--compile' options shown above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>comp --install rtexample2.c</pre>
</div>
</div>
<div class="paragraph">
<p>man-format documentation can also be created from the information in
the declaration section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>comp --document rtexample.comp</pre>
</div>
</div>
<div class="paragraph">
<p>The resulting manpage, 'example.9' can be viewed with</p>
</div>
<div class="listingblock">
<div class="content">
<pre>man ./example.9</pre>
</div>
</div>
<div class="paragraph">
<p>or copied to a standard location for manual pages.</p>
</div>
</div>
<div class="sect2">
<h3 id="compiling-userspace-components-outside-the-source-tree">Compiling userspace components outside the source tree</h3>
<div class="paragraph">
<p>'comp' can process, compile, install, and document userspace components:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>comp usrexample.comp
comp --compile usrexample.comp
comp --install usrexample.comp
comp --document usrexample.comp</pre>
</div>
</div>
<div class="paragraph">
<p>This only works for '.comp' files, not for '.c' files.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-2">Examples</h3>
<div class="sect3">
<h4 id="constant-2">constant</h4>
<div class="paragraph">
<p>Note that the declaration "function _" creates functions
named "constant.0", etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">component constant;
pin out float out;
param r float value = 1.0;
function _;
license "GPL"; // indicates GPL v2 or later
;;
FUNCTION(_) { out = value; }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sincos">sincos</h4>
<div class="paragraph">
<p>This component computes the sine and cosine of an input angle in
radians. It has different capabilities than the "sine" and "cosine"
outputs of siggen, because the input is an angle, rather than running
freely based on a "frequency" parameter.</p>
</div>
<div class="paragraph">
<p>The pins are declared with the names 'sin_' and 'cos_' in the source
code so that they do not interfere with the functions 'sin()' and
'cos()'. The HAL pins are still called 'sincos.&lt;num&gt;.sin'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">component sincos;
pin out float sin_;
pin out float cos_;
pin in float theta;
function _;
license "GPL"; // indicates GPL v2 or later
;;
#include &lt;rtapi_math.h&gt;
FUNCTION(_) { sin_ = sin(theta); cos_ = cos(theta); }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="out8">out8</h4>
<div class="paragraph">
<p>This component is a driver for a 'fictional' card called "out8",
which has 8 pins of digital output which are
treated as a single 8-bit value. There can be a varying number of such
cards in the system, and they can be at various addresses. The pin is
called 'out_' because 'out' is an identifier used in '&lt;asm/io.h&gt;'. It
illustrates the use of 'EXTRA_SETUP' and 'EXTRA_CLEANUP' to request an
I/O region and then free it in case of error or when
the module is unloaded.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">component out8;
pin out unsigned out_ "Output value; only low 8 bits are used";
param r unsigned ioaddr;

function _;

option count_function;
option extra_setup;
option extra_cleanup;
option constructable no;

license "GPL"; // indicates GPL v2 or later
;;
#include &lt;asm/io.h&gt;

#define MAX 8
int io[MAX] = {0,};
RTAPI_MP_ARRAY_INT(io, MAX, "I/O addresses of out8 boards");

int get_count(void) {
    int i = 0;
    for(i=0; i&lt;MAX &amp;&amp; io[i]; i++) { /* Nothing */ }
    return i;
}

EXTRA_SETUP() {
    if(!rtapi_request_region(io[extra_arg], 1, "out8")) {
        // set this I/O port to 0 so that EXTRA_CLEANUP does not release the IO
        // ports that were never requested.
        io[extra_arg] = 0;
        return -EBUSY;
    }
    ioaddr = io[extra_arg];
    return 0; }

EXTRA_CLEANUP() {
    int i;
    for(i=0; i &lt; MAX &amp;&amp; io[i]; i++) {
        rtapi_release_region(io[i], 1);
    }
}

FUNCTION(_) { outb(out_, ioaddr); }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hal_loop">hal_loop</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">component hal_loop;
pin out float example;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This fragment of a component illustrates the use of the 'hal_' prefix
in a component name. 'loop' is the name of a standard Linux kernel
module, so a 'loop' component might not successfully load if the Linux
'loop' module was also present on the system.</p>
</div>
<div class="paragraph">
<p>When loaded, 'halcmd show comp' will show a component called
'hal_loop'. However, the pin shown by 'halcmd show pin' will be
'loop.0.example', not 'hal-loop.0.example'.</p>
</div>
</div>
<div class="sect3">
<h4 id="arraydemo">arraydemo</h4>
<div class="paragraph">
<p>This realtime component illustrates use of fixed-size arrays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">component arraydemo "4-bit Shift register";
pin in bit in;
pin out bit out-# [4];
function _ nofp;
license "GPL"; // indicates GPL v2 or later
;;
int i;
for(i=3; i&gt;0; i--) out(i) = out(i-1);
out(0) = in;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rand">rand</h4>
<div class="paragraph">
<p>This userspace component changes the value on its output pin to a new
random value in the range (0,1) about once every 1ms.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">component rand;
option userspace;

pin out float out;
license "GPL"; // indicates GPL v2 or later
;;
#include &lt;unistd.h&gt;

void user_mainloop(void) {
    while(1) {
        usleep(1000);
        FOR_ALL_INSTS() out = drand48();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="logic">logic</h4>
<div class="paragraph">
<p>This realtime component shows how to use "personality" to create
variable-size arrays and optional pins.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">component logic "Machinekit HAL component providing experimental logic functions";
pin in bit in-##[16 : personality &amp; 0xff];
pin out bit and if personality &amp; 0x100;
pin out bit or if personality &amp; 0x200;
pin out bit xor if personality &amp; 0x400;
function _ nofp;
description """
Experimental general 'logic function' component.  Can perform 'and', 'or'
and 'xor' of up to 16 inputs.  Determine the proper value for 'personality'
by adding:
.IP \\(bu 4
The number of input pins, usually from 2 to 16
.IP \\(bu
256 (0x100)  if the 'and' output is desired
.IP \\(bu
512 (0x200)  if the 'or' output is desired
.IP \\(bu
1024 (0x400)  if the 'xor' (exclusive or) output is desired""";
license "GPL"; // indicates GPL v2 or later
;;
FUNCTION(_) {
    int i, a=1, o=0, x=0;
    for(i=0; i &lt; (personality &amp; 0xff); i++) {
        if(in(i)) { o = 1; x = !x; }
        else { a = 0; }
    }
    if(personality &amp; 0x100) and = a;
    if(personality &amp; 0x200) or = o;
    if(personality &amp; 0x400) xor = x;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A typical load line for this component might be</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt logic count=3 personality=0x102,0x305,0x503</pre>
</div>
</div>
<div class="paragraph">
<p>which creates the following pins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A 2-input AND gate: logic.0.and, logic.0.in-00, logic.0.in-01</p>
</li>
<li>
<p>5-input AND and OR gates: logic.1.and, logic.1.or, logic.1.in-00,
logic.1.in-01, logic.1.in-02, logic.1.in-03, logic.1.in-04,</p>
</li>
<li>
<p>3-input AND and XOR gates: logic.2.and, logic.2.xor, logic.2.in-00,
logic.2.in-01, logic.2.in-02</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<h1 id="hardware-drivers" class="sect0">Hardware Drivers</h1>
<div class="sect1">
<h2 id="ax5214h-driver">AX5214H Driver</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:ax5214-driver"></a> </p>
</div>
<div class="paragraph">
<p>The Axiom Measurement &amp; Control AX5214H is a 48 channel digital I/O
board. It plugs into an ISA bus, and resembles a pair of 8255 chips. In
fact it may be a pair of 8255 chips, but I&#8217;m not sure. If/when someone
starts a driver for an 8255 they should look at the ax5214 code, much
of the work is already done.</p>
</div>
<div class="sect2">
<h3 id="installing-4">Installing</h3>
<div class="listingblock">
<div class="content">
<pre>loadrt hal_ax5214h cfg="&lt;config-string&gt;"</pre>
</div>
</div>
<div class="paragraph">
<p>The config string consists of a hex port address, followed by an 8
character string of "I" and "O" which sets groups of pins as inputs and
outputs. The first two character set the direction of the first two 8
bit blocks of pins (0-7 and 8-15). The next two set blocks of 4 pins
(16-19 and 20-23). The pattern then repeats, two more blocks of 8 bits
(24-31 and 32-39) and two blocks of 4 bits (40-43 and 44-47). If more
than one board is installed, the data for the second board follows the
first. As an example, the string '"0x220 IIIOIIOO 0x300 OIOOIOIO"'
installs drivers for two boards. The first board is at address 0x220,
and has 36 inputs (0-19 and 24-39) and 12 outputs (20-23 and 40-47).
The second board is at address 0x300, and has 20 inputs (8-15, 24-31,
and 40-43) and 28 outputs (0-7. 16-23, 32-39, and 44-47). Up to 8
boards may be used in one system.</p>
</div>
</div>
<div class="sect2">
<h3 id="pins-6">Pins</h3>
<div class="ulist">
<ul>
<li>
<p>'(bit) ax5214.&lt;boardnum&gt;.out-&lt;pinnum&gt;'&#8201;&#8212;&#8201;Drives a physical output pin.</p>
</li>
<li>
<p>'(bit) ax5214.&lt;boardnum&gt;.in-&lt;pinnum&gt;'&#8201;&#8212;&#8201;Tracks a physical input pin.</p>
</li>
<li>
<p>'(bit) ax5214.&lt;boardnum&gt;.in-&lt;pinnum&gt;-not'&#8201;&#8212;&#8201;Tracks a physical input pin, inverted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For each pin, &lt;boardnum&gt; is the board number (starts at zero), and
&lt;pinnum&gt; is the I/O channel number (0 to 47).</p>
</div>
<div class="paragraph">
<p>Note that the driver assumes active LOW signals. This is so that
modules such as OPTO-22 will work correctly (TRUE means output ON, or
input energized). If the signals are being used directly without
buffering or isolation the inversion needs to be accounted for. The in-
HAL pin is TRUE if the physical pin is low (OPTO-22 module energized),
and FALSE if the physical pin is high (OPTO-22 module off). The
in-&lt;pinnum&gt;-not HAL pin is inverted&#8201;&#8212;&#8201;it is FALSE if the physical pin
is low (OPTO-22 module energized). By connecting a signal to one or the
other, the user can determine the state of the input.</p>
</div>
</div>
<div class="sect2">
<h3 id="parameters-6">Parameters</h3>
<div class="ulist">
<ul>
<li>
<p>'(bit) ax5214.&lt;boardnum&gt;.out-&lt;pinnum&gt;-invert'&#8201;&#8212;&#8201;Inverts an output pin.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The -invert parameter determines whether an output pin is active high
or active low. If -invert is FALSE, setting the HAL out- pin TRUE
drives the physical pin low, turning ON an attached OPTO-22 module, and
FALSE drives it high, turning OFF the OPTO-22 module. If -invert is
TRUE, then setting the HAL out- pin TRUE will drive the physical pin
high and turn the module OFF.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions-5">Functions</h3>
<div class="ulist">
<ul>
<li>
<p>'(funct) ax5214.&lt;boardnum&gt;.read'&#8201;&#8212;&#8201;Reads all digital inputs on one board.</p>
</li>
<li>
<p>'(funct) ax5214.&lt;boardnum&gt;.write'&#8201;&#8212;&#8201;Writes all digital outputs on one board.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gs2-vfd-driver">GS2 VFD Driver</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:gs2-vfd-driver"></a> </p>
</div>
<div class="paragraph">
<p>This is a userspace HAL program for the GS2 series of VFD&#8217;s at
Automation Direct.</p>
</div>
<div class="paragraph">
<p>This component is loaded using the halcmd "loadusr" command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadusr -Wn spindle-vfd gs2_vfd -n spindle-vfd</pre>
</div>
</div>
<div class="paragraph">
<p>The above command says: loadusr, wait for named to load,
component gs2_vfd, named spindle-vfd</p>
</div>
<div class="sect2">
<h3 id="command-line-options">Command Line Options</h3>
<div class="ulist">
<ul>
<li>
<p>'-b or --bits &lt;n&gt;' (default 8) Set number of data bits to &lt;n&gt;, where n
must be from 5 to 8 inclusive</p>
</li>
<li>
<p>'-d or --device &lt;path&gt;' (default /dev/ttyS0) Set the name of the serial
device node to use</p>
</li>
<li>
<p>'-g or --debug' Turn on debugging messages. This will also set the
verbose flag. Debug mode will cause all modbus messages to be printed
in hex on the terminal.</p>
</li>
<li>
<p>'-n or --name &lt;string&gt;' (default gs2_vfd) Set the name of the HAL
module. The HAL comp name will be set to &lt;string&gt;, and all pin and
parameter names will begin with &lt;string&gt;.</p>
</li>
<li>
<p>'-p or --parity {even,odd,none}' (default odd) Set serial parity to
even, odd, or none.</p>
</li>
<li>
<p>'-r or --rate &lt;n&gt;' (default 38400) Set baud rate to &lt;n&gt;. It is an error
if the rate is not one of the following: 110, 300, 600, 1200, 2400,
4800, 9600, 19200, 38400, 57600, 115200</p>
</li>
<li>
<p>'-s or --stopbits {1,2}' (default 1) Set serial stop bits to 1 or 2</p>
</li>
<li>
<p>'-t or --target &lt;n&gt;' (default 1) Set MODBUS target (slave) number. This
must match the device number you set on the GS2.</p>
</li>
<li>
<p>'-v or --verbose' Turn on debug messages.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
That if there are serial configuration errors, turning on verbose
may result in a flood of timeout errors.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pins-7">Pins</h3>
<div class="paragraph">
<p>Where &lt;n&gt; is gs2_vfd or the name given during loading with the -n option.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'&lt;n&gt;.DC-bus-volts' (float, out) The DC bus voltage of the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.at-speed' (bit, out) when drive is at commanded speed</p>
</li>
<li>
<p>'&lt;n&gt;.err-reset' (bit, in) reset errors sent to VFD</p>
</li>
<li>
<p>'&lt;n&gt;.firmware-revision' (s32, out) from the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.frequency-command' (float, out) from the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.frequency-out' (float, out) from the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.is-stopped' (bit, out) when the VFD reports 0 Hz output</p>
</li>
<li>
<p>'&lt;n&gt;.load-percentage' (float, out) from the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.motor-RPM' (float, out) from the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.output-current' (float, out) from the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.output-voltage' (float, out) from the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.power-factor' (float, out) from the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.scale-frequency' (float, out) from the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.speed-command' (float, in) speed sent to VFD in RPM
 It is an error to send a speed faster than the Motor Max RPM as set in
the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.spindle-fwd' (bit, in) 1 for FWD and 0 for REV sent to VFD</p>
</li>
<li>
<p>'&lt;n&gt;.spindle-rev' (bit, in) 1 for REV and 0 if off</p>
</li>
<li>
<p>'&lt;n&gt;.spindle-on' (bit, in) 1 for ON and 0 for OFF sent to VFD</p>
</li>
<li>
<p>'&lt;n&gt;.status-1' (s32, out) Drive Status of the VFD (see the GS2 manual)</p>
</li>
<li>
<p>'&lt;n&gt;.status-2' (s32, out) Drive Status of the VFD (see the GS2
manual)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The status value is a sum of all the bits that are on. So a 163
which means the drive is in the run mode is the sum of 3 (run) + 32
(freq set by serial) + 128 (operation set by serial).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="parameters-7">Parameters</h3>
<div class="paragraph">
<p>Where &lt;n&gt; is gs2_vfd or the name given during loading with the -n option.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'&lt;n&gt;.error-count' (s32, RW)</p>
</li>
<li>
<p>'&lt;n&gt;.loop-time' (float, RW) how often the modbus is polled (default 0.1)</p>
</li>
<li>
<p>'&lt;n&gt;.nameplate-HZ' (float, RW) Nameplate Hz of motor (default 60)</p>
</li>
<li>
<p>'&lt;n&gt;.nameplate-RPM' (float, RW) Nameplate RPM of motor (default 1730)</p>
</li>
<li>
<p>'&lt;n&gt;.retval' (s32, RW) the return value of an error in HAL</p>
</li>
<li>
<p>'&lt;n&gt;.tolerance' (s32, RW) speed tolerance (default 0.01)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For an example of using this component to drive a spindle see the
<a href="#cha:gs2-spindle">GS2 Spindle</a> example.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vfs11-vfd-driver">VFS11 VFD Driver</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:vfs11-vfd-driver"></a> </p>
</div>
<div class="paragraph">
<p>This is a userspace HAL program to control the S11 series of VFD&#8217;s from
Toshiba.</p>
</div>
<div class="paragraph">
<p>vfs11_vfd supports serial and TCP connections. Serial connections may
be RS232 or RS485. RS485 is supported in full- and half-duplex
mode. TCP connections may be passive (wait for incoming connection),
or active outgoing connections, which may be useful to connect to
TCP-based devices or through a terminal server.</p>
</div>
<div class="paragraph">
<p>Regardless of the connection type, vfs11_vfd operates as a Modbus master.</p>
</div>
<div class="paragraph">
<p>This component is loaded using the halcmd "loadusr" command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadusr -Wn spindle-vfd vfs11_vfd -n spindle-vfd</pre>
</div>
</div>
<div class="paragraph">
<p>The above command says: loadusr, wait for named to load,
component vfs11_vfd, named spindle-vfd</p>
</div>
<div class="sect2">
<h3 id="command-line-options-2">Command Line Options</h3>
<div class="paragraph">
<p>'vfs11_vfd' is mostly configured through inifile options. The command
line options are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'-n or --name &lt;halname&gt;' : set the HAL component name</p>
</li>
<li>
<p>'-I or --ini &lt;inifilename&gt;' : take configuration from this ini
file. Defaults to environment variable INI_FILE_NAME.</p>
</li>
<li>
<p>'-S or --section &lt;section name&gt;' : take configuration from this
section in the ini file. Defaults to 'VFS11'.</p>
</li>
<li>
<p>'-d or --debug' enable debug messages on console output.</p>
</li>
<li>
<p>'-m or --modbus-debug' enable modbus messages on console output</p>
</li>
<li>
<p>'-r or --report-device' report device properties on console at startup</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Debugging can be toggled by sending a USR1 signal to the vfs11_vfd process. Modbus
debugging can be toggled by sending a USR2 signal to vfs11_vfd process
(example: kill -USR1 \`pidof vfs11_vfd`).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
That if there are serial configuration errors, turning on verbose
may result in a flood of timeout errors.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pins-8">Pins</h3>
<div class="paragraph">
<p>Where &lt;n&gt; is vfs11_vfd or the name given during loading with the -n  option.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'&lt;n&gt;.acceleration-pattern' (bit, in) when true, set acceleration and
deceleration times as defined in registers F500 and F501
respecitvely.  Used in PID loops to choose shorter ramp
times to avoid oscillation.</p>
</li>
<li>
<p>'&lt;n&gt;.alarm-code' (s32, out) non-zero if drive is in alarmed
state. Bitmap describing alarm information (see register
FC91 description).  Use err-reset (see below) to clear the
alarm.</p>
</li>
<li>
<p>'&lt;n&gt;.at-speed' (bit, out)
when drive is at commanded speed (see speed-tolerance below)</p>
</li>
<li>
<p>'&lt;n&gt;.current-load-percentage' (float, out)
reported from the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.dc-brake' (bit, in)
engage the DC brake. Also turns off spindle-on.</p>
</li>
<li>
<p>'&lt;n&gt;.enable' (bit, in)
enable the VFD. If false, all operating parameters are still read but control is released and  panel  control
is enabled (subject to VFD setup).</p>
</li>
<li>
<p>'&lt;n&gt;.err-reset' (bit, in)
reset  errors  (alarms a.k.a Trip and e-stop status). Resetting the VFD may cause a 2-second delay until it&#8217;s
rebooted and Modbus is up again.</p>
</li>
<li>
<p>'&lt;n&gt;.estop' (bit, in)
put the VFD into emergency-stopped status. No operation possible until cleared  with  err-reset  or  powercycling.</p>
</li>
<li>
<p>'&lt;n&gt;.frequency-command' (float, out)
current target frequency in HZ as set through speed-command (which is in RPM), from the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.frequency-out' (float, out)
current output frequency of the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.inverter-load-percentage' (float, out)
current load report from VFD</p>
</li>
<li>
<p>'&lt;n&gt;.is-e-stopped' (bit, out)
the VFD is in emergency stop status (blinking "E" on panel). Use err-reset to reboot the VFD and clear the e-
stop status.</p>
</li>
<li>
<p>'&lt;n&gt;.is-stopped' (bit, out)
true when the VFD reports 0 Hz output</p>
</li>
<li>
<p>'&lt;n&gt;.max-rpm' (float, R)
actual RPM limit based on maximum frequency the VFD may  generate,  and  the  motors  nameplate  values.  For
instance,  if  nameplate-HZ is 50, and nameplate-RPM_ is 1410, but the VFD may generate up to 80Hz, then max-
rpm would read as 2256 (80*1410/50). The frequency limit is read from the VFD at startup.   To  increase  the
upper  frequency  limit,  the  UL  and FH parameters must be changed on the panel.  See the VF-S11 manual for
instructions how to set the maximum frequency.</p>
</li>
<li>
<p>'&lt;n&gt;.modbus-ok' (bit, out)
true when the Modbus session is successfully established and the last 10 transactions returned without error.</p>
</li>
<li>
<p>'&lt;n&gt;.motor-RPM' (float, out)
estimated current RPM value, from the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.output-current-percentage' (float, out)
from the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.output-voltage-percentage' (float, out)
from the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.output-voltage' (float, out)
from the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.speed-command' (float, in)
speed sent to VFD in RPM. It is an error to send a speed faster than the Motor Max RPM as set in the VFD</p>
</li>
<li>
<p>'&lt;n&gt;.spindle-fwd' (bit, in)
1 for FWD and 0 for REV, sent to VFD</p>
</li>
<li>
<p>'&lt;n&gt;.spindle-on' (bit, in)
1 for ON and 0 for OFF sent to VFD, only on when running</p>
</li>
<li>
<p>'&lt;n&gt;.spindle-rev' (bit, in)
1 for ON and 0 for OFF, only on when running</p>
</li>
<li>
<p>'&lt;n&gt;.jog-mode' (bit, in)
1 for ON and 0 for OFF, enables the VF-S11 'jog mode'. Speed control is disabled, and the output frequency is
determined by register F262 (preset to 5Hz). This might
be useful for spindle orientation. In normal mode, the
VFD shuts off if the frequency drops below 12Hz.</p>
</li>
<li>
<p>'&lt;n&gt;.status' (s32, out)
Drive Status of the VFD (see the TOSVERT VF-S11 Communications Function Instruction Manual, register FD01). A
bitmap.</p>
</li>
<li>
<p>'&lt;n&gt;.trip-code' (s32, out)
trip code if VF-S11 is in tripped state.</p>
</li>
<li>
<p>'&lt;n&gt;.error-count' (s32, out)
number of Modbus transactions which returned an error</p>
</li>
<li>
<p>'&lt;n&gt;.max-speed' (bit, in)
ignore the loop-time paramater and run Modbus at maximum
speed, at the expense of higher CPU usage. Suggested use
during spindle positioning.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="parameters-8">Parameters</h3>
<div class="paragraph">
<p>Where &lt;n&gt; is vfs11_vfd or the name given during loading with the -n  option.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'&lt;n&gt;.frequency-limit' (float, RO)
upper limit read from VFD setup.</p>
</li>
<li>
<p>'&lt;n&gt;.loop-time' (float, RW)
how often the Modbus is polled (default interval 0.1 seconds)</p>
</li>
<li>
<p>'&lt;n&gt;.nameplate-HZ' (float, RW)
Nameplate Hz of motor (default 50). Used to calculate target frequency (together with nameplate-RPM )  for  a
target RPM value as given by speed-command.</p>
</li>
<li>
<p>'&lt;n&gt;.nameplate-RPM' (float, RW)
Nameplate RPM of motor (default 1410)</p>
</li>
<li>
<p>'&lt;n&gt;.rpm-limit' (float, RW)
do-not-exceed soft limit for motor RPM (defaults to nameplate-RPM ).</p>
</li>
<li>
<p>'&lt;n&gt;.tolerance' (float, RW)
 speed tolerance (default 0.01) for determining wether spindle is at speed (0.01 meaning: output frequency is
within 1% of target frequency)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ini-file-configuration">INI file configuration</h3>
<div class="paragraph">
<p>This lists all options understood by vfs11_vfd. Typical setups for
RS232, RS485 and TCP can be found in 'src/hal/user_comps/vfs11_vfd/*.ini'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-{basebackend@docbook:'':ini}" data-lang="{basebackend@docbook:'':ini}">[VFS11]
# serial connection
TYPE=rtu

# serial port
DEVICE=/dev/ttyS0

# TCP server - wait for incoming connection
TYPE=tcpserver

# tcp portnumber for TYPE=tcpserver or tcpclient
PORT=1502

# TCP client - active outgoing connection
TYPE=tcpclient

# destination to connect to if TYPE=tcpclient
TCPDEST=192.168.1.1

#---------- meaningful only if TYPE=rtu -------
# serial device detail
# 5 6 7 8
BITS= 5

# even odd none
PARITY=none

# 110, 300, 600, 1200, 2400, 4800, 9600, 19200, 38400, 57600, 115200
BAUD=19200

# 1 2
STOPBITS=1

#rs232 rs485
SERIAL_MODE=rs485

# up down none
# this feature might not work with a stock Debian
# libmodbus5/libmodbus-dev package, and generate a warning
# execution will continue as if RTS_MODE=up were given.
RTS_MODE=up
#---------------------

# modbus timers in seconds
# inter-character timer
BYTE_TIMEOUT=0.5
# packet timer
RESPONSE_TIMEOUT=0.5

# target modbus ID
TARGET=1

# on I/O failure, try to reconnect after sleeping
# for RECONNECT_DELAY seconds
RECONNECT_DELAY=1

# misc flags
DEBUG=10
MODBUS_DEBUG=0
POLLCYCLES=10</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hal-example">HAL example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-{basebackend@docbook:'':hal}" data-lang="{basebackend@docbook:'':hal}">#
# example usage of the VF-S11 VFD driver
#
#
loadusr -Wn spindle-vfd vfs11_vfd -n spindle-vfd

# connect the spindle direction pins to the VFD
net vfs11-fwd spindle-vfd.spindle-fwd &lt;= motion.spindle-forward
net vfs11-rev spindle-vfd.spindle-rev &lt;= motion.spindle-reverse

# connect the spindle on pin to the VF-S11
net vfs11-run spindle-vfd.spindle-on &lt;= motion.spindle-on

# connect the VF-S11 at speed to the motion at speed
net vfs11-at-speed motion.spindle-at-speed &lt;= spindle-vfd.at-speed

# connect the spindle RPM to the VF-S11
net vfs11-RPM spindle-vfd.speed-command &lt;= motion.spindle-speed-out

# connect the VF-S11 DC brake
# since this draws power during spindle off, the dc-brake pin would
# better be driven by a monoflop which triggers on spindle-on falling edge
#net vfs11-spindle-brake motion.spindle-brake =&gt; spindle-vfd.dc-brake

# to use the VFS11 jog mode for spindle orient
# see orient.9 and motion.9
net spindle-orient motion.spindle-orient spindle-vfd.max-speed spindle-vfd.jog-mode

# take precedence over control panel
setp spindle-vfd.enable 1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="panel-operation">Panel operation</h3>
<div class="paragraph">
<p>The vfs11_vfd driver takes precedence over panel control while it is
enabled (see 'enable' pin), effectively disabling the panel. Clearing
the 'enable' pin re-enables the panel. Pins and parameters can still
be set, but will not be written to the VFD untile the 'enable' pin is
set. Operating parameters are still read while bus control is
disabled. Exiting the vfs11_vfd driver in a controlled way will release
the VFD from the bus and restore panel control.</p>
</div>
<div class="paragraph">
<p>See the EMC2 Integrators Manual for more information. For a detailed
register description of the Toshiba VFD&#8217;s, see the "TOSVERT VF-S11
Communications Function Instruction Manual" (Toshiba document number
E6581222) and the "TOSVERT VF-S11 Instruction manual" (Toshiba
document number E6581158).</p>
</div>
</div>
<div class="sect2">
<h3 id="error-recovery">Error Recovery</h3>
<div class="paragraph">
<p>vfs11_vfd recovers from I/O errors as follows: First, all HAL pins
are set to default values, and the driver will sleep for
RECONNECT_DELAY seconds (default 1 second).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Serial (TYPE=rtu) mode: on error, close and reopen the serial port.</p>
</li>
<li>
<p>TCP server (TYPE=tcpserver) mode: on losing the TCP connection, the
driver will go back to listen for incoming connections.</p>
</li>
<li>
<p>TCP client (TYPE=tcpclient) mode: on losing the TCP connection, the
driver will reconnect to 'TCPDEST:PORTNO'.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-vfs11-vfd-for-modbus-usage">Configuring the VFS11 VFD for Modbus usage</h3>
<div class="sect3">
<h4 id="connecting-the-serial-port">Connecting the Serial Port</h4>
<div class="paragraph">
<p>The VF-S11 has an RJ-45 jack for serial communication. Unfortunately,
it does not have a standard RS-232 plug and logic levels.  The
Toshiba-recommended way is: connect the USB001Z USB-to-serial
conversion unit to the drive, and plug the USB port into the PC. A
cheaper alternative is a homebrew interface (
<a href="http://git.mah.priv.at/gitweb/vfs11-vfd.git/blob_plain/refs/heads/f12-prod:/VFS11-RJ45_e.pdf">hints
from Toshiba support</a>,
<a href="http://git.mah.priv.at/gitweb/vfs11-vfd.git/blob_plain/refs/heads/f12-prod:/vfs11-rs232.pdf">circuit diagram</a>).</p>
</div>
<div class="paragraph">
<p>Note: the 24V output from the VFD has no short-circuit protection.</p>
</div>
<div class="paragraph">
<p>Serial port factory defaults are 9600/8/1/even, the protocol defaults
to the proprietary "Toshiba Inverter Protocol".</p>
</div>
</div>
<div class="sect3">
<h4 id="modbus-setup">Modbus setup</h4>
<div class="paragraph">
<p>Several parameters need setting before the VF-S11 will talk to
this module. This can either be done manually with the control panel,
or over the serial link - Toshiba supplies a Windows application
called 'PCM001Z' which can read/set parameters in the VFD.  Note -
PCM001Z only talks the Toshiba inverter protocol. So the last
parameter which you&#8217;d want to change is the protocol - set from
Toshiba Inverter Protocol to Modbus; thereafter, the Windows app is
useless.</p>
</div>
<div class="paragraph">
<p>To increase the upper frequency limit, the UL and FH parameters must
be changed on the panel. I increased them from 50 to 80.</p>
</div>
<div class="paragraph">
<p>See dump-params.mio for a description of non-standard VF-S11
parameters of my setup. This file is for the
<a href="http://git.mah.priv.at/gitweb/modio.git">modio Modbus interactive utility</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="programming-note">Programming Note</h3>
<div class="paragraph">
<p>The vfs11_vfd driver uses the <a href="http://www.libmodbus.org">libmodbus
version 3</a> library which is more recent than the version 2 code used
in gs2_vfd.</p>
</div>
<div class="paragraph">
<p>The Debian libmodbus5 and libmodbus-dev packages are
only available starting from Debian 12 ('Precise Pengolin'). Moreover,
these packages lack support for the MODBUS_RTS_MODE_*
flags. Therefore, building vfs11_vfd using this library might generate
a warning if RTS_MODE= is specified in the ini file.</p>
</div>
<div class="paragraph">
<p>To use the full functionality on lucid and precise:
* remove the libmodbus packages: <code>sudo apt-get remove libmodbus5
libmodbus-dev</code>
* build and install libmodbus version 3 from source as outlined
<a href="https://github.com/stephane/libmodbus/blob/master/README.rst">here</a>.</p>
</div>
<div class="paragraph">
<p>Libmodbus does not build on Debian Hardy, hence vfs11_vfd is not
available on hardy.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mesa-hostmot2-driver">Mesa HostMot2 Driver</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:mesa-hostmot2-driver"></a> </p>
</div>
<div class="sect2">
<h3 id="introduction-3">Introduction</h3>
<div class="paragraph">
<p>HostMot2 is an FPGA configuration developed by Mesa Electronics for
their line of 'Anything I/O' motion control cards. The firmware is open
source, portable and flexible. It can be configured (at compile-time)
with zero or more instances (an object created at runtime) of each of
several Modules: encoders (quadrature counters), PWM generators, and
step/dir generators. The firmware can be configured (at run-time) to
connect each of these instances to pins on the I/O headers. I/O pins
not driven by a Module instance revert to general-purpose
bi-directional digital I/O.</p>
</div>
</div>
<div class="sect2">
<h3 id="firmware-binaries">Firmware Binaries</h3>
<div class="paragraph">
<div class="title">50 Pin Header FPGA cards</div>
<p>Several pre-compiled HostMot2 firmware binaries are available for the
different Anything I/O boards. (This list is incomplete, check the
hostmot2-firmware distribution for up-to-date firmware lists.)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>3x20 (144 I/O pins): using hm2_pci module</p>
<div class="ulist">
<ul>
<li>
<p>24-channel servo</p>
</li>
<li>
<p>16-channel servo plus 24 step/dir generators</p>
</li>
</ul>
</div>
</li>
<li>
<p>5i22 (96 I/O pins): using hm2_pci module</p>
<div class="ulist">
<ul>
<li>
<p>16-channel servo</p>
</li>
<li>
<p>8-channel servo plus 24 step/dir generators</p>
</li>
</ul>
</div>
</li>
<li>
<p>5i20, 5i23, 4i65, 4i68 (72 I/O pins): using hm2_pci module</p>
<div class="ulist">
<ul>
<li>
<p>12-channel servo</p>
</li>
<li>
<p>8-channel servo plus 4 step/dir generators</p>
</li>
<li>
<p>4-channel servo plus 8 step/dir generators</p>
</li>
</ul>
</div>
</li>
<li>
<p>7i43 (48 I/O pins): using hm2_7i43 module</p>
<div class="ulist">
<ul>
<li>
<p>8-channel servo (8 PWM generators &amp; 8 encoders)</p>
</li>
<li>
<p>4-channel servo plus 4 step/dir generators</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">DB25 FPGA cards</div>
<p>The 5i25 Superport FPGA card is preprogrammed when purchased and does not
need a firmware binary.</p>
</div>
</div>
<div class="sect2">
<h3 id="installing-firmware">Installing Firmware</h3>
<div class="paragraph">
<p>Depending on how you installed Machinekit you may have to open the Synaptic
Package Manager from the System menu and install the package for your
Mesa card. The quickest way to find them is to do a search for
'hostmot2' in the Synaptic Package Manager. Mark the firmware for
installation, then apply.</p>
</div>
</div>
<div class="sect2">
<h3 id="loading-hostmot2">Loading HostMot2</h3>
<div class="paragraph">
<p>The Machinekit support for the HostMot2 firmware is split into a generic
driver called 'hostmot2' and two low-level I/O drivers for the Anything
I/O boards. The low-level I/O drivers are 'hm2_7i43' and 'hm2_pci' (for
all the PCI- and PC-104/Plus-based Anything I/O boards). The hostmot2 driver
must be loaded first, using a HAL command like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt hostmot2</pre>
</div>
</div>
<div class="paragraph">
<p>See the hostmot2(9) man page for details.</p>
</div>
<div class="paragraph">
<p>The hostmot2 driver by itself does nothing, it needs access to actual
boards running the HostMot2 firmware. The low-level I/O drivers provide
this access. The low-level I/O drivers are loaded with commands like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt hm2_pci config="firmware=hm2/5i20/SVST8_4.BIT
       num_encoders=3 num_pwmgens=3 num_stepgens=1"</pre>
</div>
</div>
<div class="paragraph">
<p>The config parameters are described in the hostmot2 man page.</p>
</div>
</div>
<div class="sect2">
<h3 id="watchdog">Watchdog</h3>
<div class="paragraph">
<p>The HostMot2 firmware may include a watchdog Module; if it does, the
hostmot2 driver will use it.</p>
</div>
<div class="paragraph">
<p>The watchdog must be petted by Machinekit periodically or it will bite.</p>
</div>
<div class="paragraph">
<p>When the watchdog bites, all the board&#8217;s I/O pins are disconnected
from their Module instances and become high-impedance inputs (pulled
high), and all communication with the board stops. The state of the
HostMot2 firmware modules is not disturbed (except for the
configuration of the I/O Pins). Encoder instances keep counting
quadrature pulses, and pwm- and step-generators keep generating signals
(which are not relayed to the motors, because the I/O Pins have become
inputs).</p>
</div>
<div class="paragraph">
<p>Resetting the watchdog resumes communication and resets the I/O pins
to the configuration chosen at load-time.</p>
</div>
<div class="paragraph">
<p>If the firmware includes a watchdog, the following HAL objects will be
exported:</p>
</div>
<div class="sect3">
<h4 id="pins-9">Pins:</h4>
<div class="ulist">
<ul>
<li>
<p>'has_bit' -
 (bit i/o) True if the watchdog has bit, False if the watchdog has not
bit. If the watchdog has bit and the has_bit bit is True, the user can
reset it to False to resume operation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="parameters-9">Parameters:</h4>
<div class="ulist">
<ul>
<li>
<p>'timeout_ns' -
 (u32 read/write) Watchdog timeout, in nanoseconds. This is initialized
to 1,000,000,000 (1 second) at module load time. If more than this
amount of time passes between calls to the pet_watchdog() function, the
watchdog will bite.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="functions-6">Functions:</h4>
<div class="ulist">
<ul>
<li>
<p>'pet_watchdog()' -
 Calling this function resets the watchdog timer and postpones the
watchdog biting until timeout_ns nanoseconds later. This function
should be added to the servo thread.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hostmot2-functions">HostMot2 Functions</h3>
<div class="ulist">
<ul>
<li>
<p>'hm2_&lt;BoardType&gt;.&lt;BoardNum&gt;.read' -
Read all inputs, update input HAL pins.</p>
</li>
<li>
<p>'hm2_&lt;BoardType&gt;.&lt;BoardNum&gt;.write' -
Write all outputs.</p>
</li>
<li>
<p>'hm2_&lt;BoardType&gt;.&lt;BoardNum&gt;.pet-watchdog' -
Pet the watchdog to keep it from biting us for a while.</p>
</li>
<li>
<p>'hm2_&lt;BoardType&gt;.&lt;BoardNum&gt;.read_gpio' -
 Read the GPIO input pins only. (This function
is not available on the 7i43 due to limitations of the EPP bus.)</p>
</li>
<li>
<p>'hm2_&lt;BoardType&gt;.&lt;BoardNum&gt;.write_gpio' -
 Write the GPIO control registers and output pins only. (This function
is not available on the 7i43 due to limitations of the EPP bus.)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The above 'read_gpio' and 'write_gpio' functions should not
normally be needed, since the GPIO bits are read and written along
with everything else in the standard 'read' and 'write'
functions above, which are normally run in the servo thread.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The 'read_gpio' and 'write_gpio' functions were provided in
case some very fast (frequently updated) I/O is needed. These
functions should be run in the base thread. If you have need for
this, please send an email and tell us about it, and what your
application is.</p>
</div>
</div>
<div class="sect2">
<h3 id="pinouts">Pinouts</h3>
<div class="paragraph">
<p>The hostmot2 driver does not have a particular pinout. The pinout
comes from the firmware that the hostmot2 driver sends to the Anything I/O
board. Each firmware has different pinout, and the pinout depends on
how many of the available encoders, pwmgens, and stepgens are used. To
get a pinout list for your configuration after loading Machinekit in the
terminal window type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dmesg &gt; hm2.txt</pre>
</div>
</div>
<div class="paragraph">
<p>The resulting text file will contain lots of information as well as
the pinout for the HostMot2 and any error and warning messages.</p>
</div>
<div class="paragraph">
<p>To reduce the clutter by clearing the message buffer before loading
Machinekit type the following in the terminal window:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo dmesg -c</pre>
</div>
</div>
<div class="paragraph">
<p>Now when you run Machinekit and then do a 'dmesg &gt; hm2.txt' in the terminal
only the info from the time you loaded Machinekit will be in your file along
with your pinout. The file will be in the current directory of the
terminal window. Each line will contain the card name, the card number,
the I/O Pin number, the connector and pin, and the usage. From this
printout you will know the physical connections to your card based on
your configuration.</p>
</div>
<div class="paragraph">
<p>An example of a 5i20 configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[HOSTMOT2]
DRIVER=hm2_pci
BOARD=5i20
CONFIG="firmware=hm2/5i20/SVST8_4.BIT num_encoders=1 num_pwmgens=1 num_stepgens=3"</pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration produced this printout.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ 1141.053386] hm2/hm2_5i20.0: 72 I/O Pins used:
[ 1141.053394] hm2/hm2_5i20.0: IO Pin 000 (P2-01): IOPort
[ 1141.053397] hm2/hm2_5i20.0: IO Pin 001 (P2-03): IOPort
[ 1141.053401] hm2/hm2_5i20.0: IO Pin 002 (P2-05): Encoder #0, pin B (Input)
[ 1141.053405] hm2/hm2_5i20.0: IO Pin 003 (P2-07): Encoder #0, pin A (Input)
[ 1141.053408] hm2/hm2_5i20.0: IO Pin 004 (P2-09): IOPort
[ 1141.053411] hm2/hm2_5i20.0: IO Pin 005 (P2-11): Encoder #0, pin Index (Input)
[ 1141.053415] hm2/hm2_5i20.0: IO Pin 006 (P2-13): IOPort
[ 1141.053418] hm2/hm2_5i20.0: IO Pin 007 (P2-15): PWMGen #0, pin Out0 (PWM or Up) (Output)
[ 1141.053422] hm2/hm2_5i20.0: IO Pin 008 (P2-17): IOPort
[ 1141.053425] hm2/hm2_5i20.0: IO Pin 009 (P2-19): PWMGen #0, pin Out1 (Dir or Down) (Output)
[ 1141.053429] hm2/hm2_5i20.0: IO Pin 010 (P2-21): IOPort
[ 1141.053432] hm2/hm2_5i20.0: IO Pin 011 (P2-23): PWMGen #0, pin Not-Enable (Output)
&lt;snip&gt;...
[ 1141.053589] hm2/hm2_5i20.0: IO Pin 060 (P4-25): StepGen #2, pin Step (Output)
[ 1141.053593] hm2/hm2_5i20.0: IO Pin 061 (P4-27): StepGen #2, pin Direction (Output)
[ 1141.053597] hm2/hm2_5i20.0: IO Pin 062 (P4-29): StepGen #2, pin (unused) (Output)
[ 1141.053601] hm2/hm2_5i20.0: IO Pin 063 (P4-31): StepGen #2, pin (unused) (Output)
[ 1141.053605] hm2/hm2_5i20.0: IO Pin 064 (P4-33): StepGen #2, pin (unused) (Output)
[ 1141.053609] hm2/hm2_5i20.0: IO Pin 065 (P4-35): StepGen #2, pin (unused) (Output)
[ 1141.053613] hm2/hm2_5i20.0: IO Pin 066 (P4-37): IOPort
[ 1141.053616] hm2/hm2_5i20.0: IO Pin 067 (P4-39): IOPort
[ 1141.053619] hm2/hm2_5i20.0: IO Pin 068 (P4-41): IOPort
[ 1141.053621] hm2/hm2_5i20.0: IO Pin 069 (P4-43): IOPort
[ 1141.053624] hm2/hm2_5i20.0: IO Pin 070 (P4-45): IOPort
[ 1141.053627] hm2/hm2_5i20.0: IO Pin 071 (P4-47): IOPort
[ 1141.053811] hm2/hm2_5i20.0: registered
[ 1141.053815] hm2_5i20.0: initialized AnyIO board at 0000:02:02.0</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
That the I/O Pin nnn will correspond to the pin number shown on
the HAL Configuration screen for GPIOs. Some of the Stepgen, Encoder
and PWMGen will also show up as GPIOs in the HAL Configuration screen.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pin-files">PIN Files</h3>
<div class="paragraph">
<p>The default pinout is described in a .PIN file (human-readable text).
When you install a firmware package the .PIN files are installed in</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/usr/share/doc/hostmot2-firmware-&lt;board&gt;/</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="firmware">Firmware</h3>
<div class="paragraph">
<p>The selected firmware (.BIT file) and configuration is uploaded from
the PC motherboard to the Mesa mothercard on Machinekit startup.
If you are using Run In Place, you must still install a
hostmot2-firmware-&lt;board&gt; package. There is more information about
firmware and configuration in the 'Configurations' section.</p>
</div>
</div>
<div class="sect2">
<h3 id="hal-pins">HAL Pins</h3>
<div class="paragraph">
<p>The HAL pins for each configuration can be seen by opening up 'Show
HAL Configuration' from the Machine menu. All the HAL pins and
parameters can be found there. The following figure is of the 5i20
configuration used above.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../drivers/images/5i20-halpins.png" alt="5i20 halpins">
</div>
<div class="title">Figure 25. 5i20 HAL Pins<a id="cap:5i20-HAL-Pins"></a></div>
</div>
</div>
<div class="sect2">
<h3 id="configurations">Configurations</h3>
<div class="paragraph">
<p>The Hostmot2 firmware is available in several versions, depending on
what you are trying to accomplish. You can get a reminder of what a
particular firmware is for by looking at the name. Let&#8217;s look at a
couple of examples.</p>
</div>
<div class="paragraph">
<p>In the 7i43 (two ports), SV8 ('Servo 8') would be for having 8 servos
or fewer, using the 'classic' 7i33 4-axis (per port) servo board.
So 8 servos would use up all 48 signals in the two ports. But if
you only needed 3 servos, you could say 'num_encoders=3' and 'num_pwmgens=3'
and recover 5 servos at 6 signals each, thus gaining 30 bits of GPIO.</p>
</div>
<div class="paragraph">
<p>Or, in the 5i22 (four ports), SVST8_24 ('Servo 8, Stepper 24') would be
for having 8 servos or fewer (7i33 x2 again), and 24 steppers or fewer
(7i47 x2). This would use up all four ports.
If you only needed 4 servos you could say 'num_encoders=4' and
'num_pwmgens=4' and recover 1 port (and save a 7i33).
And if you only needed 12 steppers you could say 'num_stepgens=12' and
free up one port (and save a 7i47).
So in this way we can save two ports (48 bits) for GPIO.</p>
</div>
<div class="paragraph">
<p>Here are tables of the firmwares available in the official packages.
There may be additional firmwares available at the Mesanet.com website
that have not yet made it into the Machinekit official firmware packages, so
check there too.</p>
</div>
<div class="paragraph">
<p>3x20 (6-port various) Default Configurations (The 3x20 comes in 1M, 1.5M, and 2M gate versions.
So far, all firmware is available in all gate sizes.)</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Firmware</th>
<th class="tableblock halign-left valign-top">Encoder</th>
<th class="tableblock halign-left valign-top">PWMGen</th>
<th class="tableblock halign-left valign-top">StepGen</th>
<th class="tableblock halign-left valign-top">GPIO</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SV24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST16_24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>5i22 (4-port PCI) Default Configurations (The 5i22 comes in 1M and 1.5M gate versions.
So far, all firmware is available in all gate sizes.)</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Firmware</th>
<th class="tableblock halign-left valign-top">Encoder</th>
<th class="tableblock halign-left valign-top">PWM</th>
<th class="tableblock halign-left valign-top">StepGen</th>
<th class="tableblock halign-left valign-top">GPIO</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SV16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST2_4_7I47</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">72</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST8_8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST8_24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>5i23 (3-port PCI) Default Configurations (The 5i23 has 400k gates.)</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Firmware</th>
<th class="tableblock halign-left valign-top">Encoder</th>
<th class="tableblock halign-left valign-top">PWM</th>
<th class="tableblock halign-left valign-top">StepGen</th>
<th class="tableblock halign-left valign-top">GPIO</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SV12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST2_8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 (tbl5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST2_4_7I47</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SV12_2X7I48_72</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SV12IM_2X7I48_72</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12 (+IM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST4_8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 (tbl5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST8_4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 (tbl5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST8_4IM2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 (+IM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST8_8IM2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 (+IM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVTP6_7I39</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 (6 BLDC)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>5i20 (3-port PCI) Default Configurations (The 5i20 has 200k gates.)</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Firmware</th>
<th class="tableblock halign-left valign-top">Encoder</th>
<th class="tableblock halign-left valign-top">PWM</th>
<th class="tableblock halign-left valign-top">StepGen</th>
<th class="tableblock halign-left valign-top">GPIO</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SV12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST2_8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 (tbl5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST2_4_7I47</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SV12_2X7I48_72</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SV12IM_2X7I48_72</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12 (+IM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST8_4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 (tbl5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST8_4IM2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 (+IM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>4i68 (3-port PC/104) Default Configurations (The 4i68 has 400k gates.)</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Firmware</th>
<th class="tableblock halign-left valign-top">Encoder</th>
<th class="tableblock halign-left valign-top">PWM</th>
<th class="tableblock halign-left valign-top">StepGen</th>
<th class="tableblock halign-left valign-top">GPIO</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SV12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST2_4_7I47</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST4_8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST8_4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST8_4IM2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 (+IM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST8_8IM2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 (+IM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>4i65 (3-port PC/104) Default Configurations (The 4i65 has 200k gates.)</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Firmware</th>
<th class="tableblock halign-left valign-top">Encoder</th>
<th class="tableblock halign-left valign-top">PWM</th>
<th class="tableblock halign-left valign-top">StepGen</th>
<th class="tableblock halign-left valign-top">GPIO</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SV12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST8_4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST8_4IM2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 (+IM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>7i43 (2-port parallel) 400k gate versions, Default Configurations</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Firmware</th>
<th class="tableblock halign-left valign-top">Encoder</th>
<th class="tableblock halign-left valign-top">PWM</th>
<th class="tableblock halign-left valign-top">StepGen</th>
<th class="tableblock halign-left valign-top">GPIO</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SV8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST4_4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 (tbl5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST4_6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6 (tbl3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST4_12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST2_4_7I47</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>7i43 (2-port parallel) 200k gate versions, Default Configurations</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Firmware</th>
<th class="tableblock halign-left valign-top">Encoder</th>
<th class="tableblock halign-left valign-top">PWM</th>
<th class="tableblock halign-left valign-top">StepGen</th>
<th class="tableblock halign-left valign-top">GPIO</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SV8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST4_4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 (tbl5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST4_6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6 (tbl3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVST2_4_7I47</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Even though several cards may have the same named .BIT file you cannot use
a .BIT file that is not for that card. Different cards have different
clock frequencies so make sure you load the proper .BIT file for your
card. Custom hm2 firmwares can be created for special applications and
you may see some custom hm2 firmwares in the directories with the
default ones.</p>
</div>
<div class="paragraph">
<p>When you load the board-driver (hm2_pci or hm2_7i43), you can tell it
to disable instances of the three primary modules (pwmgen, stepgen, and
encoder) by setting the count lower. Any I/O pins belonging to disabled
module instances become GPIOs.</p>
</div>
</div>
<div class="sect2">
<h3 id="gpio">GPIO</h3>
<div class="paragraph">
<p>General Purpose I/O pins on the board which are not used by a module
instance are exported to HAL as 'full' GPIO pins. Full GPIO pins can be
configured at run-time to be inputs, outputs, or open drains, and have
a HAL interface that exposes this flexibility. I/O pins that are owned
by an active module instance are constrained by the requirements of the
owning module, and have a restricted HAL interface.</p>
</div>
<div class="paragraph">
<p>GPIOs have names like 'hm2_&lt;BoardType&gt;.&lt;BoardNum&gt;.gpio.&lt;IONum&gt;.'
IONum. is a three-digit number. The mapping from IONum to connector and
pin-on-that-connector is written to the syslog when the driver loads,
and it&#8217;s documented in Mesa&#8217;s manual for the Anything I/O boards.</p>
</div>
<div class="paragraph">
<p>The hm2 GPIO representation is modeled after the Digital Inputs and
Digital Outputs described in the Canonical Device Interface (part of
the HAL General Reference document).</p>
</div>
<div class="paragraph">
<p>GPIO pins default to input.</p>
</div>
<div class="sect3">
<h4 id="pins-10">Pins</h4>
<div class="ulist">
<ul>
<li>
<p>'in' -
 (Bit, Out) Normal state of the hardware input pin. Both full GPIO pins
and I/O pins used as inputs by active module instances have this pin.</p>
</li>
<li>
<p>'in_not' -
 (Bit, Out) Inverted state of the hardware input pin. Both full GPIO
pins and I/O pins used as inputs by active module instances have this
pin.</p>
</li>
<li>
<p>'out' -
 (Bit, In) Value to be written (possibly inverted) to the hardware
output pin. Only full GPIO pins have this pin.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="parameters-10">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p>'invert_output' -
 (Bit, RW) This parameter only has an effect if the 'is_output'
parameter is true. If this parameter is true, the output value of the
GPIO will be the inverse of the value on the 'out' HAL pin. Only full
GPIO pins and I/O pins used as outputs by active module instances have
this parameter. To invert an active module pin you have to invert the
GPIO pin not the module pin.</p>
</li>
<li>
<p>'is_opendrain' -
 (Bit, RW) This parameter only has an effect if the 'is_output'
parameter is true. If this parameter is false, the GPIO behaves as a
normal output pin: the I/O pin on the connector is driven to the value
specified by the 'out' HAL pin (possibly inverted), and the value of
the 'in' and 'in_not' HAL pins is undefined. If this parameter is true,
the GPIO behaves as an open-drain pin. Writing 0 to the 'out' HAL pin
drives the I/O pin low, writing 1 to the 'out' HAL pin puts the I/O pin
in a high-impedance state. In this high-impedance state the I/O pin
floats (weakly pulled high), and other devices can drive the value; the
resulting value on the I/O pin is available on the 'in' and 'in_not'
pins. Only full GPIO pins and I/O pins used as outputs by active module
instances have this parameter.</p>
</li>
<li>
<p>'is_output' -
 (Bit, RW) If set to 0, the GPIO is an input. The I/O pin is put in a
high-impedance state (weakly pulled high), to be driven by other
devices. The logic value on the I/O pin is available in the 'in' and
'in_not' HAL pins. Writes to the 'out' HAL pin have no effect. If this
parameter is set to 1, the GPIO is an output; its behavior then depends
on the 'is_opendrain' parameter. Only full GPIO pins have this
parameter.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stepgen">StepGen</h3>
<div class="paragraph">
<p>Stepgens have names like
'hm2_&lt;BoardType&gt;.&lt;BoardNum&gt;.stepgen.&lt;Instance&gt;.'. 'Instance' is a
two-digit number that corresponds to the HostMot2 stepgen instance
number. There are 'num_stepgens' instances, starting with 00.</p>
</div>
<div class="paragraph">
<p>Each stepgen allocates 2-6 I/O pins (selected at firmware compile
time), but currently only uses two: Step and Direction outputs.<sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnote_10" title="View footnote.">10</a>]</sup></p>
</div>
<div class="paragraph">
<p>The stepgen representation is modeled on the stepgen software
component. Stepgen default is active high step output (high during step
time low during step space). To invert a StepGen output pin you invert
the corresponding GPIO pin that is being used by StepGen. To find the
GPIO pin being used for the StepGen output run dmesg as shown above.</p>
</div>
<div class="paragraph">
<p>Each stepgen instance has the following pins and parameters:</p>
</div>
<div class="sect3">
<h4 id="pins-11">Pins</h4>
<div class="ulist">
<ul>
<li>
<p>'control-type' -
 (Bit, In) Switches between position control mode (0) and velocity
control mode (1). Defaults to position control (0).</p>
</li>
<li>
<p>'counts' -
(s32, Out) Feedback position in counts (number of steps).</p>
</li>
<li>
<p>'enable' -
(Bit, In) Enables output steps. When false, no steps are generated.</p>
</li>
<li>
<p>'position-cmd' -
 (Float, In) Target position of stepper motion, in user-defined
position units.</p>
</li>
<li>
<p>'position-fb' -
 (Float, Out) Feedback position in user-defined position units (counts
/ position_scale).</p>
</li>
<li>
<p>'velocity-cmd' -
 (Float, In) Target velocity of stepper motion, in user-defined
position units per second. This pin is only used when the stepgen is in
velocity control mode (control-type=1).</p>
</li>
<li>
<p>'velocity-fb' -
 (Float, Out) Feedback velocity in user-defined position units per
second.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="parameters-11">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p>'dirhold' -
 (u32, RW) Minimum duration of stable Direction signal after a step
ends, in nanoseconds.</p>
</li>
<li>
<p>'dirsetup' -
 (u32, RW) Minimum duration of stable Direction signal before a step
begins, in nanoseconds.</p>
</li>
<li>
<p>'maxaccel' -
 (Float, RW) Maximum acceleration, in position units per second per
second. If set to 0, the driver will not limit its acceleration.</p>
</li>
<li>
<p>'maxvel' -
 (Float, RW) Maximum speed, in position units per second. If set to 0,
the driver will choose the maximum velocity based on the values of
steplen and stepspace (at the time that maxvel was set to 0).</p>
</li>
<li>
<p>'position-scale' -
 (Float, RW) Converts from counts to position units. position = counts
/ position_scale</p>
</li>
<li>
<p>'step_type' -
 (u32, RW) Output format, like the step_type modparam to the software
stegen(9) component. 0 = Step/Dir, 1 = Up/Down, 2 = Quadrature. In
Quadrature mode (step_type=2), the stepgen outputs one complete Gray
cycle (00 -&gt; 01 -&gt; 11 -&gt; 10 -&gt; 00) for each 'step' it takes.</p>
</li>
<li>
<p>'steplen' -
(u32, RW) Duration of the step signal, in nanoseconds.</p>
</li>
<li>
<p>'stepspace' -
(u32, RW) Minimum interval between step signals, in nanoseconds.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="output-parameters">Output Parameters</h4>
<div class="paragraph">
<p>The Step and Direction pins of each StepGen have two additional
parameters. To find which I/O pin belongs to which step and direction
output run dmesg as described above.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'invert_output' -
 (Bit, RW) This parameter only has an effect if the 'is_output'
parameter is true. If this parameter is true, the output value of the
GPIO will be the inverse of the value on the 'out' HAL pin.</p>
</li>
<li>
<p>'is_opendrain' -
 (Bit, RW) If this parameter is false, the GPIO behaves as a normal
output pin: the I/O pin on the connector is driven to the value
specified by the 'out' HAL pin (possibly inverted). If this parameter
is true, the GPIO behaves as an open-drain pin. Writing 0 to the 'out'
HAL pin drives the I/O pin low, writing 1 to the 'out' HAL pin puts the
I/O pin in a high-impedance state. In this high-impedance state the I/O
pin floats (weakly pulled high), and other devices can drive the value;
the resulting value on the I/O pin is available on the 'in' and 'in_not'
pins. Only full GPIO pins and I/O pins used as outputs by active module
instances have this parameter.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pwmgen">PWMGen</h3>
<div class="paragraph">
<p>PWMgens have names like
'hm2_&lt;BoardType&gt;.&lt;BoardNum&gt;.pwmgen.&lt;Instance&gt;.'. 'Instance' is a
two-digit number that corresponds to the HostMot2 pwmgen instance
number. There are 'num_pwmgens' instances, starting with 00.</p>
</div>
<div class="paragraph">
<p>In HM2, each pwmgen uses three output I/O pins: Not-Enable, Out0, and
Out1. To invert a PWMGen output pin you invert the corresponding GPIO
pin that is being used by PWMGen. To find the GPIO pin being used for
the PWMGen output run dmesg as shown above.</p>
</div>
<div class="paragraph">
<p>The function of the Out0 and Out1 I/O pins varies with output-type
parameter (see below).</p>
</div>
<div class="paragraph">
<p>The hm2 pwmgen representation is similar to the software pwmgen
component. Each pwmgen instance has the following pins and parameters:</p>
</div>
<div class="sect3">
<h4 id="pins-12">Pins</h4>
<div class="ulist">
<ul>
<li>
<p>'enable' -
 (Bit, In) If true, the pwmgen will set its Not-Enable pin false and
output its pulses. If 'enable' is false, pwmgen will set its Not-Enable
pin true and not output any signals.</p>
</li>
<li>
<p>'value' -
(Float, In) The current pwmgen command value, in arbitrary units.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="parameters-12">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p>'output-type' -
 (s32, RW) This emulates the output_type load-time argument to the
software pwmgen component. This parameter may be changed at runtime,
but most of the time you probably want to set it at startup and then
leave it alone. Accepted values are 1 (PWM on Out0 and Direction on
Out1), 2 (Up on Out0 and Down on Out1), 3 (PDM mode, PDM on Out0 and
Dir on Out1), and 4 (Direction on Out0 and PWM on Out1, 'for locked
antiphase').</p>
</li>
<li>
<p>'scale' -
 (Float, RW) Scaling factor to convert 'value' from arbitrary units to
duty cycle: dc = value / scale. Duty cycle has an effective range of
-1.0 to +1.0 inclusive, anything outside that range gets clipped.</p>
</li>
<li>
<p>'pdm_frequency' -
 (u32, RW) This specifies the PDM frequency, in Hz, of all the pwmgen
instances running in PDM mode (mode 3). This is the 'pulse slot
frequency'; the frequency at which the pdm generator in the Anything I/O board
chooses whether to emit a pulse or a space. Each pulse (and space) in
the PDM pulse train has a duration of 1/pdm_frequency seconds. For
example, setting the pdm_frequency to 2e6 (2 MHz) and the duty cycle to
50% results in a 1 MHz square wave, identical to a 1 MHz PWM signal
with 50% duty cycle. The effective range of this parameter is from
about 1525 Hz up to just under 100 MHz. Note that the max frequency is
determined by the ClockHigh frequency of the Anything I/O board; the
5i20 and 7i43 both have a 100 MHz clock, resulting in a 100 Mhz max PDM
frequency. Other boards may have different clocks, resulting in
different max PDM frequencies. If the user attempts to set the
frequency too high, it will be clipped to the max supported frequency
of the board.</p>
</li>
<li>
<p>'pwm_frequency' -
 (u32, RW) This specifies the PWM frequency, in Hz, of all the pwmgen
instances running in the PWM modes (modes 1 and 2). This is the
frequency of the variable-duty-cycle wave. Its effective range is from
1 Hz up to 193 KHz. Note that the max frequency is determined by the
ClockHigh frequency of the Anything I/O board; the 5i20 and 7i43 both
have a 100 MHz clock, resulting in a 193 KHz max PWM frequency. Other
boards may have different clocks, resulting in different max PWM
frequencies. If the user attempts to set the frequency too high, it
will be clipped to the max supported frequency of the board.
Frequencies below about 5 Hz are not terribly accurate, but above 5 Hz
they&#8217;re pretty close.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="output-parameters-2">Output Parameters</h4>
<div class="paragraph">
<p>The output pins of each PWMGen have two additional parameters. To find
which I/O pin belongs to which output run dmesg as described above.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'invert_output' -
 (Bit, RW) This parameter only has an effect if the 'is_output'
parameter is true. If this parameter is true, the output value of the
GPIO will be the inverse of the value on the 'out' HAL pin.</p>
</li>
<li>
<p>'is_opendrain' -
 (Bit, RW) If this parameter is false, the GPIO behaves as a normal
output pin: the I/O pin on the connector is driven to the value
specified by the 'out' HAL pin (possibly inverted). If this parameter
is true, the GPIO behaves as an open-drain pin. Writing 0 to the 'out'
HAL pin drives the I/O pin low, writing 1 to the 'out' HAL pin puts the
I/O pin in a high-impedance state. In this high-impedance state the I/O
pin floats (weakly pulled high), and other devices can drive the value;
the resulting value on the I/O pin is available on the 'in' and 'in_not'
pins. Only full GPIO pins and I/O pins used as outputs by active module
instances have this parameter.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="encoder">Encoder</h3>
<div class="paragraph">
<p>Encoders have names like
'hm2_&lt;BoardType&gt;.&lt;BoardNum&gt;.encoder.&lt;Instance&gt;.'. 'Instance' is a
two-digit number that corresponds to the HostMot2 encoder instance
number. There are 'num_encoders' instances, starting with 00.</p>
</div>
<div class="paragraph">
<p>Each encoder uses three or four input I/O pins, depending on how the
firmware was compiled. Three-pin encoders use A, B, and Index
(sometimes also known as Z). Four-pin encoders use A, B, Index, and
Index-mask.</p>
</div>
<div class="paragraph">
<p>The hm2 encoder representation is similar to the one described by the
Canonical Device Interface (in the HAL General Reference document), and
to the software encoder component. Each encoder instance has the
following pins and parameters:</p>
</div>
<div class="sect3">
<h4 id="pins-13">Pins</h4>
<div class="ulist">
<ul>
<li>
<p>'count' -
(s32, Out) Number of encoder counts since the previous reset.</p>
</li>
<li>
<p>'index-enable' -
 (Bit, I/O) When this pin is set to True, the count (and therefore also
position) are reset to zero on the next Index (Phase-Z) pulse. At the
same time, index-enable is reset to zero to indicate that the pulse has
occurred.</p>
</li>
<li>
<p>'position' -
(Float, Out) Encoder position in position units (count / scale).</p>
</li>
<li>
<p>'rawcounts' -
 (s32, Out) Total number of encoder counts since the start, not
adjusted for index or reset.</p>
</li>
<li>
<p>'reset' -
 (Bit, In) When this pin is TRUE, the count and position pins are set
to 0. (The value of the velocity pin is not affected by this.) The
driver does not reset this pin to FALSE after resetting the count to 0,
that is the user&#8217;s job.</p>
</li>
<li>
<p>'velocity' -
(Float, Out) Estimated encoder velocity in position units per second.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="parameters-13">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p>'counter-mode' -
 (Bit, RW) Set to False (the default) for Quadrature. Set to True for
Up/Down or for single input on Phase A. Can be used for a frequency to
velocity converter with a single input on Phase A when set to true.</p>
</li>
<li>
<p>'filter' -
 (Bit, RW) If set to True (the default), the quadrature counter needs
15 clocks to register a change on any of the three input lines (any
pulse shorter than this is rejected as noise). If set to False, the
quadrature counter needs only 3 clocks to register a change. The
encoder sample clock runs at 33 MHz on the PCI Anything I/O cards and 50 MHz
on the 7i43.</p>
</li>
<li>
<p>'index-invert' -
 (Bit, RW) If set to True, the rising edge of the Index input pin
triggers the Index event (if index-enable is True). If set to False,
the falling edge triggers.</p>
</li>
<li>
<p>'index-mask' -
 (Bit, RW) If set to True, the Index input pin only has an effect if
the Index-Mask input pin is True (or False, depending on the
index-mask-invert pin below).</p>
</li>
<li>
<p>'index-mask-invert' -
 (Bit, RW) If set to True, Index-Mask must be False for Index to have
an effect. If set to False, the Index-Mask pin must be True.</p>
</li>
<li>
<p>'scale' -
 (Float, RW) Converts from 'count' units to 'position' units. A
quadrature encoder will normally have 4 counts per pulse so a 100 PPR
encoder would be 400 counts per revolution. In '.counter-mode' a 100
PPR encoder would have 100 counts per revelution as it only uses the
rising edge of A and direction is B.</p>
</li>
<li>
<p>'vel-timeout' -
 (Float, RW) When the encoder is moving slower than one pulse for each
time that the driver reads the count from the FPGA (in the hm2_read()
function), the velocity is harder to estimate. The driver can wait
several iterations for the next pulse to arrive, all the while
reporting the upper bound of the encoder velocity, which can be
accurately guessed. This parameter specifies how long to wait for the
next pulse, before reporting the encoder stopped. This parameter is in
seconds.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="5i25-configuration">5i25 Configuration</h3>
<div class="sect3">
<h4 id="firmware-2">Firmware</h4>
<div class="paragraph">
<p>The 5i25 firmware comes preloaded for the daughter card it is purchased with.
So the 'firmware=xxx.BIT' is not part of the hm2_pci configuration string when
using a 5i25.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration">Configuration</h4>
<div class="paragraph">
<p>Example configurations of the 5i25/7i76 and 5i25/7i77 cards are included in
the <a href="#sub:configuration-selector">Configuration Selector</a>.</p>
</div>
<div class="paragraph">
<p>If you like to roll your own configuration the following examples show how
to load the drivers in the HAL file.</p>
</div>
<div class="listingblock">
<div class="title">5i25 + 7i76 Card</div>
<div class="content">
<pre># load the generic driver
loadrt hostmot2

# load the PCI driver and configure
loadrt hm2_pci config="num_encoders=1 num_stepgens=5 sserial_port_0=0XXX"</pre>
</div>
</div>
<div class="listingblock">
<div class="title">5i25 + 7i77 Card</div>
<div class="content">
<pre># load the generic driver
loadrt hostmot2

# load the PCI driver and configure
loadrt hm2_pci config="num_encoders=6 num_pwmgens=6 sserial_port_0=0XXX"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sserial-configuration">SSERIAL Configuration</h4>
<div class="paragraph">
<p>The 'sserial_port_0=0XXX' configuration string sets some options for the smart
serial daughter card. These options are specific for each daughter card. See
the Mesa manual for more information on the exact usuage.</p>
</div>
</div>
<div class="sect3">
<h4 id="7i77-limits">7i77 Limits</h4>
<div class="paragraph">
<p>The minlimit and maxlimit are bounds on the pin value (in this case the analog
out value) fullscalemax is the scale factor.</p>
</div>
<div class="paragraph">
<p>These are by default set to the analog in or analog range (most likely in
volts).</p>
</div>
<div class="paragraph">
<p>So for example on the 7I77 +-10V analog outputs, the default values are:</p>
</div>
<div class="paragraph">
<p>minlimit -10
maxlimit +10
maxfullscale 10</p>
</div>
<div class="paragraph">
<p>If you wanted to say scale the analog out of a channel to IPS for a velocity
mode servo (say 24 IPS max) you could set the limits like this:</p>
</div>
<div class="paragraph">
<p>minlimit -24
maxlimit +24
maxfullscale 24</p>
</div>
<div class="paragraph">
<p>If you wanted to scale the analog out of a channel to RPM for a 0 to 6000 RPM
spindle with 0-10V control you could set the limits like this:</p>
</div>
<div class="paragraph">
<p>minlimit 0
maxlimit 6000
maxfullscale 6000
(this would prevent unwanted negative output voltages from being set)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="example-configurations">Example Configurations</h3>
<div class="paragraph">
<p>Several example configurations for Mesa hardware are included with Machinekit.
The configurations are located in the hm2-servo and hm2-stepper sections of
the <a href="#sub:configuration-selector">Configuration Selector</a>. Typically you
will need the board installed for the configuration you pick to
load. The examples are a good place to start and will save you time.
Just pick the proper example from the Machinekit Configuration Selector and
save a copy to your computer so you can edit it. To see the exact pins
and parameters that your configuration gave you, open the Show HAL
Configuration window from the Machine menu, or do dmesg as outlined
above.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="motenc-driver">Motenc Driver</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:montec-driver"></a> </p>
</div>
<div class="paragraph">
<p>Vital Systems Motenc-100 and Motenc-LITE</p>
</div>
<div class="paragraph">
<p>The Vital Systems Motenc-100 and Motenc-LITE are 8- and 4-channel
servo control boards. The Motenc-100 provides 8 quadrature encoder
counters, 8 analog inputs, 8 analog outputs, 64 (68?) digital inputs,
and 32 digital outputs. The Motenc-LITE has only 4 encoder counters, 32
digital inputs and 16 digital outputs, but it still has 8 analog inputs
and 8 analog outputs. The driver automatically identifies the installed
board and exports the appropriate HAL objects.</p>
</div>
<div class="paragraph">
<p>Installing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt hal_motenc</pre>
</div>
</div>
<div class="paragraph">
<p>During loading (or attempted loading) the driver prints some useful
debugging messages to the kernel log, which can be viewed with dmesg.</p>
</div>
<div class="paragraph">
<p>Up to 4 boards may be used in one system.</p>
</div>
<div class="sect2">
<h3 id="pins-14">Pins</h3>
<div class="paragraph">
<p>In the following pins, parameters, and functions, &lt;board&gt; is the board
ID. According to the naming conventions the first board should always
have an ID of zero. However this driver sets the ID based on a pair of
jumpers on the board, so it may be non-zero even if there is only one
board.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(s32) motenc.&lt;board&gt;.enc-&lt;channel&gt;-count' - Encoder position, in counts.</p>
</li>
<li>
<p>'(float) motenc.&lt;board&gt;.enc-&lt;channel&gt;-position' - Encoder position, in
user units.</p>
</li>
<li>
<p>'(bit) motenc.&lt;board&gt;.enc-&lt;channel&gt;-index' - Current status of index
pulse input.</p>
</li>
<li>
<p>'(bit) motenc.&lt;board&gt;.enc-&lt;channel&gt;-idx-latch' - Driver sets this pin
true when it latches an index pulse (enabled by latch-index). Cleared
by clearing latch-index.</p>
</li>
<li>
<p>'(bit) motenc.&lt;board&gt;.enc-&lt;channel&gt;-latch-index' - If this pin is true,
the driver will reset the counter on the next index pulse.</p>
</li>
<li>
<p>'(bit) motenc.&lt;board&gt;.enc-&lt;channel&gt;-reset-count' - If this pin is true,
the counter will immediately be reset to zero, and the pin will be
cleared.</p>
</li>
<li>
<p>'(float) motenc.&lt;board&gt;.dac-&lt;channel&gt;-value' - Analog output value for
DAC (in user units, see -gain and -offset)</p>
</li>
<li>
<p>'(float) motenc.&lt;board&gt;.adc-&lt;channel&gt;-value' - Analog input value read
by ADC (in user units, see -gain and -offset)</p>
</li>
<li>
<p>'(bit) motenc.&lt;board&gt;.in-&lt;channel&gt;' - State of digital input pin, see
canonical digital input.</p>
</li>
<li>
<p>'(bit) motenc.&lt;board&gt;.in-&lt;channel&gt;-not' - Inverted state of digital
input pin, see canonical digital input.</p>
</li>
<li>
<p>'(bit) motenc.&lt;board&gt;.out-&lt;channel&gt;' - Value to be written to digital
output, seen canonical digital output.</p>
</li>
<li>
<p>'(bit) motenc.&lt;board&gt;.estop-in' - Dedicated estop input, more details
needed.</p>
</li>
<li>
<p>'(bit) motenc.&lt;board&gt;.estop-in-not' - Inverted state of dedicated estop
input.</p>
</li>
<li>
<p>'(bit) motenc.&lt;board&gt;.watchdog-reset' - Bidirectional, - Set TRUE to
reset watchdog once, is automatically cleared.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="parameters-14">Parameters</h3>
<div class="ulist">
<ul>
<li>
<p>'(float) motenc.&lt;board&gt;.enc-&lt;channel&gt;-scale' - The number of counts /
user unit (to convert from counts to units).</p>
</li>
<li>
<p>'(float) motenc.&lt;board&gt;.dac-&lt;channel&gt;-offset' - Sets the DAC offset.</p>
</li>
<li>
<p>'(float) motenc.&lt;board&gt;.dac-&lt;channel&gt;-gain' - Sets the DAC gain (scaling).</p>
</li>
<li>
<p>'(float) motenc.&lt;board&gt;.adc-&lt;channel&gt;-offset' - Sets the ADC offset.</p>
</li>
<li>
<p>'(float) motenc.&lt;board&gt;.adc-&lt;channel&gt;-gain' - Sets the ADC gain (scaling).</p>
</li>
<li>
<p>'(bit) motenc.&lt;board&gt;.out-&lt;channel&gt;-invert' - Inverts a digital output,
see canonical digital output.</p>
</li>
<li>
<p>'(u32) motenc.&lt;board&gt;.watchdog-control' - Configures the watchdog. The
value may be a bitwise OR of the following values:</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit #</th>
<th class="tableblock halign-center valign-top">Value</th>
<th class="tableblock halign-center valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Timeout is 16ms if set, 8ms if unset</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Watchdog is enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Watchdog is automatically reset by DAC writes (the HAL dac-write function)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Typically, the useful values are 0 (watchdog disabled) or 20 (8ms
watchdog enabled, cleared by dac-write).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(u32) motenc.&lt;board&gt;.led-view' - Maps some of the I/O to onboard LEDs.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="functions-7">Functions</h3>
<div class="ulist">
<ul>
<li>
<p>'(funct) motenc.&lt;board&gt;.encoder-read' - Reads all encoder counters.</p>
</li>
<li>
<p>'(funct) motenc.&lt;board&gt;.adc-read' - Reads the analog-to-digital converters.</p>
</li>
<li>
<p>'(funct) motenc.&lt;board&gt;.digital-in-read' - Reads digital inputs.</p>
</li>
<li>
<p>'(funct) motenc.&lt;board&gt;.dac-write' - Writes the voltages to the DACs.</p>
</li>
<li>
<p>'(funct) motenc.&lt;board&gt;.digital-out-write' - Writes digital outputs.</p>
</li>
<li>
<p>'(funct) motenc.&lt;board&gt;.misc-update' - Updates misc stuff.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="opto22-driver">Opto22 Driver</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:opto22-driver"></a> </p>
</div>
<div class="paragraph">
<p>PCI AC5 ADAPTER CARD / HAL DRIVER</p>
</div>
<div class="sect2">
<h3 id="the-adapter-card">The Adapter Card</h3>
<div class="paragraph">
<p>This is a card made by Opto22 for adapting the PCI port to solid state
relay racks such as their standard or G4 series. It has 2 ports that
can control up to 24 points each and has 4 on board LEDs. The ports use
50 pin connectors the same as Mesa boards. Any relay racks/breakout
boards thats work with Mesa Cards should work with this card with the
understanding any encoder counters, PWM, etc., would have to be done in
software. The AC5 does not have any 'smart' logic on board, it is just
an adapter.</p>
</div>
<div class="paragraph">
<p>See the manufacturer&#8217;s website for more info:</p>
</div>
<div class="paragraph">
<p><a href="http://www.opto22.com/site/pr_details.aspx?cid=4&amp;item=PCI-AC5" class="bare">http://www.opto22.com/site/pr_details.aspx?cid=4&amp;item=PCI-AC5</a></p>
</div>
<div class="paragraph">
<p>I would like to thank Opto22 for releasing info in their manual,
easing the writing of this driver!</p>
</div>
</div>
<div class="sect2">
<h3 id="the-driver">The Driver</h3>
<div class="paragraph">
<p>This driver is for the PCI AC5 card and will not work with the ISA AC5
card. The HAL driver is a realtime module. It will support 4 cards as
is (more cards are possible with a change in the source code). Load the
basic driver like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt opto_ac5</pre>
</div>
</div>
<div class="paragraph">
<p>This will load the driver which will search for max 4 boards. It will
set I/O of each board&#8217;s 2 ports to a default setting. The default
configuration is for 12 inputs then 12 outputs. The pin name numbers
correspond to the position on the relay rack. For example the pin names
for the default I/O setting of port 0 would be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'opto_ac5.0.port0.in-00' - They would be numbered from 00 to 11</p>
</li>
<li>
<p>'opto_ac5.0.port0.out-12' - They would be numbered 12 to 23 port 1 would
be the same.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="pins-15">Pins</h3>
<div class="ulist">
<ul>
<li>
<p>'opto_ac5.[BOARDNUMBER].port[PORTNUMBER].in-[PINNUMBER] OUT bit' -</p>
</li>
<li>
<p>'opto_ac5.[BOARDNUMBER].port[PORTNUMBER].in-[PINNUMBER]-not OUT bit' -
Connect a HAL bit signal to this pin to read an I/O point from the
card. The PINNUMBER represents the position in the relay rack. Eg.
PINNUMBER 0 is position 0 in a Opto22 relay rack and would be pin 47 on
the 50 pin header connector. The -not pin is inverted so that LOW gives
TRUE and HIGH gives FALSE.</p>
</li>
<li>
<p>'opto_ac5.[BOARDNUMBER].port[PORTNUMBER].out-[PINNUMBER] IN bit' -
Connect a HAL bit signal to this pin to write to an I/O point of the
card. The PINNUMBER represents the position in the relay rack.Eg.
PINNUMBER 23 is position 23 in a Opto22 relay rack and would be pin 1
on the 50 pin header connector.</p>
</li>
<li>
<p>'opto_ac5.[BOARDNUMBER].led[NUMBER] OUT bit' -
Turns one of the 4 onboard LEDs on/off. LEDs are numbered 0 to 3.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>BOARDNUMBER can be 0-3 PORTNUMBER can be 0 or 1. Port 0 is closest to
the card bracket.</p>
</div>
</div>
<div class="sect2">
<h3 id="parameters-15">Parameters</h3>
<div class="ulist">
<ul>
<li>
<p>'opto_ac5.[BOARDNUMBER].port[PORTNUMBER].out-[PINNUMBER]-invert W bit' -
When TRUE, invert the meaning of the corresponding -out pin so that
TRUE gives LOW and FALSE gives HIGH.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="functions-8">FUNCTIONS</h3>
<div class="ulist">
<ul>
<li>
<p>'opto_ac5.0.digital-read' - Add this to a thread to read all the input
points.</p>
</li>
<li>
<p>'opto_ac5.0.digital-write' - Add this to a thread to write all the output
points and LEDs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example the pin names for the default I/O setting of port 0 would
be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>opto_ac5.0.port0.in-00</pre>
</div>
</div>
<div class="paragraph">
<p>They would be numbered from 00 to 11</p>
</div>
<div class="listingblock">
<div class="content">
<pre>opto_ac5.0.port0.out-12</pre>
</div>
</div>
<div class="paragraph">
<p>They would be numbered 12 to 23 port 1 would be the same.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-i-o-ports">Configuring I/O Ports</h3>
<div class="paragraph">
<p>To change the default setting load the driver something like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt opto_ac5 portconfig0=0xffff portconfig1=0xff0000</pre>
</div>
</div>
<div class="paragraph">
<p>Of course changing the numbers to match the I/O you would like. Each
port can be set up different.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s how to figure out the number: The configuration number
represents a 32 bit long code to tell the card which I/O points are
output vrs input. The lower 24 bits are the I/O points of one port. The
2 highest bits are for 2 of the on board LEDs. A one in any bit
position makes the I/O point an output. The two highest bits must be
output for the LEDs to work. The driver will automatically set the two
highest bits for you, we won&#8217;t talk about them.</p>
</div>
<div class="paragraph">
<p>The easiest way to do this is to fire up the calculator under
APPLICATIONS/ACCESSORIES. Set it to scientific (click view). Set it
BINARY (radio button Bin). Press 1 for every output you want and/or
zero for every input. Remember that HAL pin 00 corresponds to the
rightmost bit. 24 numbers represent the 24 I/O points of one port. So
for the default setting (12 inputs then 12 outputs) you would push 1
twelve times (thats the outputs) then 0 twelve times (thats the
inputs). Notice the first I/O point is the lowest (rightmost) bit.
(that bit corresponds to HAL pin 00 .looks backwards) You should have
24 digits on the screen. Now push the Hex radio button. The displayed
number (fff000) is the configport number ( put a '0x' in front of it
designating it as a HEX number).</p>
</div>
<div class="paragraph">
<p>Another example: To set the port for 8 outputs and 16 inputs (the
same as a Mesa card). Here is the 24 bits represented in a BINARY
number. Bit 1 is the rightmost number.</p>
</div>
<div class="paragraph">
<p>000000000000000011111111</p>
</div>
<div class="paragraph">
<p>16 zeros for the 16 inputs and 8 ones for the 8 outputs</p>
</div>
<div class="paragraph">
<p>Which converts to FF on the calculator so 0xff is the number to use
for portconfig0 and/or portconfig1 when loading the driver.</p>
</div>
</div>
<div class="sect2">
<h3 id="pin-numbering">Pin Numbering</h3>
<div class="paragraph">
<p>HAL pin 00 corresponds to bit 1 (the rightmost) which represents
position 0 on an Opto22 relay rack. HAL pin 01 corresponds to bit 2
(one spot to the left of the rightmost) which represents position 1 on
an Opto22 relay rack. HAL pin 23 corresponds to bit 24 (the
leftmost) which represents position 23 on an Opto22 relay rack.</p>
</div>
<div class="paragraph">
<p>HAL pin 00 connects to pin 47 on the 50 pin connector of each port.
HAL pin 01 connects to pin 45 on the 50 pin connector of each port.
HAL pin 23 connects to pin 1 on the 50 pin connector of each port.</p>
</div>
<div class="paragraph">
<p>Note that Opto22 and Mesa use opposite numbering systems: Opto22
position 23 = connector pin 1, and the position goes down as the
connector pin number goes up. Mesa Hostmot2 position 1 = connector pin
1, and the position number goes up as the connector pin number goes up.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pico-drivers">Pico Drivers</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:pico-drivers"></a> </p>
</div>
<div class="paragraph">
<p>Pico Systems has a family of boards for doing analog servo, stepper,
and PWM (digital) servo control. The boards connect to the PC through a
parallel port working in EPP mode. Although most users connect one
board to a parallel port, in theory any mix of up to 8 or 16 boards can
be used on a single parport. One driver serves all types of boards. The
final mix of I/O depends on the connected board(s). The driver doesn&#8217;t
distinguish between boards, it simply numbers I/O channels (encoders,
etc) starting from 0 on the first board.  The driver is named hal_ppmc.ko
The analog servo interface is also called the PPMC for Parallel Port Motion
Control.  There is also the Universal Stepper Controller, abbreviated the
USC.  And the Universal PWM Controller, or UPC.</p>
</div>
<div class="paragraph">
<p>Installing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt hal_ppmc port_addr=&lt;addr1&gt;[,&lt;addr2&gt;[,&lt;addr3&gt;...]]</pre>
</div>
</div>
<div class="paragraph">
<p>The 'port_addr' parameter tells the driver what parallel port(s) to
check. By default, '&lt;addr1&gt;' is 0x0378, and '&lt;addr2&gt;' and following
are not used. The driver searches the entire address
space of the enhanced parallel port(s) at 'port_addr', looking for
any board(s) in the PPMC family. It then exports HAL
pins for whatever it finds. During loading (or attempted loading) the
driver prints some useful debugging messages to the kernel log, which
can be viewed with 'dmesg'.</p>
</div>
<div class="paragraph">
<p>Up to 3 parport busses may be used, and each bus may have up to 8 (or
possibly 16 PPMC) devices on it.</p>
</div>
<div class="sect2">
<h3 id="command-line-options-3">Command Line Options</h3>
<div class="paragraph">
<p>There are several options that can be specified on the loadrt command line.
First, the USC and UPC can have an 8-bit DAC added for spindle speed
control and similar functions.  This can be specified with the
extradac='0xnn[,0xmm]' parameter.  The part enclosed in [ ] allows you
to specify this option on more than one board of the system.  The first
hex digit tells which EPP bus is being referred to, it corresponds to
the order of the port addresses in the port_addr parameter, where
&lt;addr1&gt; would be zero here.  So, for the first EPP bus, the first
USC or UPC board would be described as '0x00', the second USC or UPC
on the same bus would be '0x02'.  (Note that each USC or UPC takes up
two addresses, so if one is at 00, the next would have to be 02.)</p>
</div>
<div class="paragraph">
<p>Alternatively, the 8 digital output pins can be used as additional
digital outputs, it works the same way as above with the syntax :
extradout=0xnn'.  The extradac and extradout options are mutually
exclusive on each board, you can only specify one.</p>
</div>
<div class="paragraph">
<p>The UPC and PPMC encoder boards can timestamp the arrival of encoder
counts to refine the derivation of axis velocity.  This derived velocity
can be fed to the PID hal component to produce smoother D term
response.  The syntax is : timestamp='0xnn[,0xmm]', this works the
same way as above to select which board is being configured.
Default is to not enable the timestamp option.  If you put
this option on the command line, it enables the option.  The
first 'n' selects the EPP bus, the second one matches the
address of the board having the option enabled.  The driver checks the
revision level of the board to make sure it has firmware supporting
the feature, and produces an error message if the board does not
support it.</p>
</div>
<div class="paragraph">
<p>The PPMC encoder board has an option to select the encoder digital
filter frequeency.  (The UPC has the same ability via DIP switches
on the board.)  Since the PPMC encoder board doesn&#8217;t have these
extra DIP switches, it needs to be selected via a command-line
option.  By default, the filter runs at 1 MHz, allowing encoders
to be counted up to about 900 KHz (depending on noise and quadrature
accuracy of the encoder.)  The options are 1, 2.5, 5 and 10 MHz.
These are set with a parameter of 1,2,5 and 10 (decimal) which
is specified as the hex digit "A".  These are specified in a manner
similar to the above options, but with the frequency setting to
the left of the bus/address digits.  So, to set 5 MHz on the
encoder board at address 3 on the first EPP bus, you would write :
enc_clock='0x503'</p>
</div>
</div>
<div class="sect2">
<h3 id="pins-16">Pins</h3>
<div class="paragraph">
<p>In the following pins, parameters, and functions, &lt;port&gt; is the parallel
port ID. According to the naming conventions the first port should always
have an ID of zero.  All the boards have some method of setting the
address on the EPP bus.  USC and UPC have simple provisions for only
two addresses, but jumper foil cuts allow up to 4 boards to be addressed.
The PPMC boards have 16 possible addresses.  In all cases, the driver
enumerates the boards by type and exports the appropriate HAL pins.
For instance, the encoders will be enumerated from zero up, in the
same order as the address switches on the board specify.  So, the first
board will have encoders 0&#8201;&#8212;&#8201;3, the second board would have encoders
4&#8201;&#8212;&#8201;7.
The first column after the bullet tells which boards will have this
HAL pin or parameter associated with it.  All means that this pin is
available on all three board types.  Option means that this pin
will only be exported when that option is enabled by an optional
parameter in the loadrt HAL command.  These options require the
board to have a sufficient revision level to support the feature.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'(All s32 output) ppmc.&lt;port&gt;.encoder.&lt;channel&gt;.count' - Encoder
position, in counts.</p>
</li>
<li>
<p>'(All s32 output) ppmc.&lt;port&gt;.encoder.&lt;channel&gt;.delta' - Change in
counts since last read, in raw encoder count units.</p>
</li>
<li>
<p>'(All float output) 'ppmc.&lt;port&gt;.encoder.&lt;channel&gt;.velocity'  -
Velocity scaled in user units per second. On PPMC and USC this is
derived from raw encoder counts per servo period, and hence is affected
by encoder granularity. On UPC boards with the 8/21/09 and later
firmware, velocity estimation by timestamping encoder counts can be
used to improve the smoothness of this velocity output. This can be fed
to the PID HAL component to produce a more stable servo response. This
function has to be enabled in the HAL command line that starts the PPMC
driver, with the timestamp=0x00 option.</p>
</li>
<li>
<p>'(All float output) ppmc.&lt;port&gt;.encoder.&lt;channel&gt;.position' -
Encoder position, in user units.</p>
</li>
<li>
<p>'(All bit bidir) ppmc.&lt;port&gt;.encoder.&lt;channel&gt;.index-enable'  -
Connect to axis.#.index-enable for home-to-index. This is a
bidirectional HAL signal. Setting it to true causes the encoder
hardware to reset the count to zero on the next encoder index pulse.
The driver will detect this and set the signal back to false.</p>
</li>
<li>
<p>'(PPMC float output) ppmc.&lt;port&gt;.DAC.&lt;channel&gt;.value' - sends a
signed value to the 16-bit Digital to Analog Converter on the PPMC DAC16
board commanding the analog output voltage of that DAC channel.</p>
</li>
<li>
<p>'(UPC bit input) ppmc.&lt;port&gt;.pwm.&lt;channel&gt;.enable' - Enables a
PWM generator.</p>
</li>
<li>
<p>'(UPC float input) ppmc.&lt;port&gt;.pwm.&lt;channel&gt;.value'  - Value
which determines the duty cycle of the PWM waveforms. The
value is divided by 'pwm.&lt;channel&gt;.scale', and if the result is 0.6
the duty cycle will be 60%, and so on.
Negative values result in the duty cycle being based on the absolute
value, and the direction pin is set to indicate negative.</p>
</li>
<li>
<p>'(USC bit input) ppmc.&lt;port&gt;.stepgen.&lt;channel&gt;.enable' -
Enables a step pulse generator.</p>
</li>
<li>
<p>'(USC float input) ppmc.&lt;port&gt;.stepgen.&lt;channel&gt;.velocity'  -
Value which determines the step frequency. The value is multiplied
by 'stepgen.&lt;channel&gt;.scale' , and the result is the frequency in
steps per second. Negative values
result in the frequency being based on the absolute value, and the
direction pin is set to indicate negative.</p>
</li>
<li>
<p>'(All bit output) ppmc.&lt;port&gt;.din.&lt;channel&gt;.in' - State of digital
input pin, see canonical digital input.</p>
</li>
<li>
<p>'(All bit output) ppmc.&lt;port&gt;.din.&lt;channel&gt;.in-not' - Inverted
state of digital input pin, see canonical digital input.</p>
</li>
<li>
<p>'(All bit input) ppmc.&lt;port&gt;.dout.&lt;channel&gt;.out'  - Value to be
written to digital output, see canonical digital output.</p>
</li>
<li>
<p>'(Option float input) ppmc.&lt;port&gt;.DAC8-&lt;channel&gt;.value'  - Value to
be written to analog output, range from 0 to 255. This
sends 8 output bits to J8, which should have a Spindle DAC board
connected to it. 0 corresponds to zero Volts, 255 corresponds to 10
Volts. The polarity of the output can be set for always minus, always
plus, or can be controlled by the state of SSR1 (plus when on) and SSR2
(minus when on). You must specify extradac = 0x00 on the HAL command
line that loads the PPMC driver to enable this function on the first
USC ur UPC board.</p>
</li>
<li>
<p>'(Option bit input) ppmc.&lt;port&gt;.dout.&lt;channel&gt;.out'  - Value to be
written to one of the 8 extra digital output pins on
J8. You must specify extradout = 0x00 on the HAL command line that
loads the ppmc driver to enable this function on the first USC or UPC
board. extradac and extradout are mutually exclusive features as they
use the same signal lines for different purposes.  These output pins
will be enumerated after the standard digital outputs of the board.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="parameters-16">Parameters</h3>
<div class="ulist">
<ul>
<li>
<p>'(All float) ppmc.&lt;port&gt;.encoder.&lt;channel&gt;.scale' - The number of
counts / user unit (to convert from counts to units).</p>
</li>
<li>
<p>'(UPC float) ppmc.&lt;port&gt;.pwm.&lt;channel-range&gt;.freq' - The PWM
carrier frequency, in Hz. Applies to a group of four
consecutive PWM generators, as indicated by '&lt;channel-range&gt;'. Minimum
is 610Hz, maximum is 500KHz.</p>
</li>
<li>
<p>'(PPMC float) ppmc.&lt;port&gt;.DAC.&lt;channel&gt;.scale'  - Sets scale
of DAC16 output channel such that an output value equal to the 1/scale
value will produce an output of + or - value Volts.  So, if the scale
parameter is 0.1 and you send a value of 0.5, the output will be 5.0 Volts.</p>
</li>
<li>
<p>'(UPC float) ppmc.&lt;port&gt;.pwm.&lt;channel&gt;.scale' - Scaling for PWM
generator. If 'scale' is X, then the duty cycle will be 100% when the
'value' pin is X (or -X).</p>
</li>
<li>
<p>'(UPC float) ppmc.&lt;port&gt;.pwm.&lt;channel&gt;.max-dc' - Maximum duty
cycle, from 0.0 to 1.0.</p>
</li>
<li>
<p>'(UPC float) ppmc.&lt;port&gt;.pwm.&lt;channel&gt;.min-dc' - Minimum duty
cycle, from 0.0 to 1.0.</p>
</li>
<li>
<p>'(UPC float) ppmc.&lt;port&gt;.pwm.&lt;channel&gt;.duty-cycle' - Actual duty
cycle (used mostly for troubleshooting.)</p>
</li>
<li>
<p>'(UPC bit) ppmc.&lt;port&gt;.pwm.&lt;channel&gt;.bootstrap' - If true, the
PWM generator will generate a short sequence of
pulses of both polarities when E-stop goes false, to reset the
shutdown latches on some PWM servo drives.</p>
</li>
<li>
<p>'(USC u32) ppmc.&lt;port&gt;.stepgen.&lt;channel-range&gt;.setup-time' - Sets
   minimum time between direction change and step pulse, in
   units of 100ns. Applies to a group of four consecutive step generators,
   as indicated by '&lt;channel-range&gt;'. Values between 200 ns and 25.5 us
can be specified.</p>
</li>
<li>
<p>'(USC u32) ppmc.&lt;port&gt;.stepgen.&lt;channel-range&gt;.pulse-width' - Sets
 width of step pulses, in units of 100ns. Applies to a group
 of four consecutive step generators, as indicated by '&lt;channel-range&gt;'.
Values between 200 ns and 25.5 us may be specified.</p>
</li>
<li>
<p>'(USC u32) ppmc.&lt;port&gt;.stepgen.&lt;channel-range&gt;.pulse-space-min' - Sets
minimum time between pulses, in units of 100ns.
Applies to a group of four consecutive step generators, as indicated by
'&lt;channel-range&gt;'. Values between 200 ns and 25.5 us can be specified.
The maximum step rate is:
<span class="image"><img src="../drivers/images/pico-ppmc-math.png" alt="pico ppmc math"></span></p>
</li>
<li>
<p>'(USC float) ppmc.&lt;port&gt;.stepgen.&lt;channel&gt;.scale' - Scaling for
step pulse generator. The step frequency in Hz is the
absolute value of 'velocity' * 'scale'.</p>
</li>
<li>
<p>'(USC float) ppmc.&lt;port&gt;.stepgen.&lt;channel&gt;.max-vel' - The maximum
value for 'velocity'. Commands greater than 'max-vel'  will be clamped.
Also applies to negative values. (The absolute value is clamped.)</p>
</li>
<li>
<p>'(USC float) ppmc.&lt;port&gt;.stepgen.&lt;channel&gt;.frequency' - Actual
step pulse frequency in Hz (used mostly for troubleshooting.)</p>
</li>
<li>
<p>'(Option float) ppmc.&lt;port&gt;.DAC8.&lt;channel&gt;.scale' - Sets scale
of extra DAC output such that an output value equal to
scale gives a magnitude of 10.0 V output. (The sign of the output is
set by jumpers and/or other digital outputs.)</p>
</li>
<li>
<p>'(Option bit) ppmc.&lt;port&gt;.dout.&lt;channel&gt;.invert' - Inverts a
digital output, see canonical digital output.</p>
</li>
<li>
<p>'(Option bit) ppmc.&lt;port&gt;.dout.&lt;channel&gt;.invert' - Inverts a
digital output pin of J8, see canonical digital output.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="functions-9">Functions</h3>
<div class="ulist">
<ul>
<li>
<p>'(All funct) ppmc.&lt;port&gt;.read' - Reads all inputs (digital inputs
and encoder counters) on one port. These reads are organized into
blocks of contiguous registers to be read in a block to
minimize CPU overhead.</p>
</li>
<li>
<p>'(All funct) ppmc.&lt;port&gt;.write' - Writes all outputs (digital
outputs, stepgens, PWMs) on one port.
These writes are organized into blocks of contiguous registers to be
written in a block to minimize CPU overhead.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pluto-p-driver">Pluto P Driver</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:pluto-p-driver"></a> </p>
</div>
<div class="sect2">
<h3 id="general-info">General Info</h3>
<div class="paragraph">
<p>The Pluto-P is a FPGA board featuring the
ACEX1K chip from Altera.</p>
</div>
<div class="sect3">
<h4 id="requirements">Requirements</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A Pluto-P board</p>
</li>
<li>
<p>An EPP-compatible parallel port, configured for EPP mode in the system BIOS
or a PCI EPP compatible parallel port card.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Pluto P board requires EPP mode. Netmos98xx chips do not work in EPP mode.
The Pluto P board  will work on some computers and not on others.
There is no known pattern to which computers work and which don&#8217;t work.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on PCI EPP compatible parallel port cards see the
<a href="http://wiki.machinekit.org/cgi-bin/wiki.pl?Machinekit_Supported_Hardware">Machinekit
Supported Hardware</a> page on the wiki.</p>
</div>
</div>
<div class="sect3">
<h4 id="connectors">Connectors</h4>
<div class="ulist">
<ul>
<li>
<p>The Pluto-P board is shipped with the left connector presoldered, with
the key in the indicated position. The other connectors are
unpopulated. There does not seem to be a standard 12-pin IDC connector,
but some of the pins of a 16P connector can hang off the board next to
QA3/QZ3.</p>
</li>
<li>
<p>The bottom and right connectors are on the same .1" grid, but the left
connector is not. If OUT2…OUT9 are not required, a single IDC connector
can span the bottom connector and the bottom two rows of the right
connector.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="physical-pins">Physical Pins</h4>
<div class="ulist">
<ul>
<li>
<p>Read the ACEX1K datasheet for information about input and output
voltage thresholds. The pins are all configured in 'LVTTL/LVCMOS' mode
and are generally compatible with 5V TTL logic.</p>
</li>
<li>
<p>Before configuration and after properly exiting Machinekit, all Pluto-P pins
are tristated with weak pull-ups (20k-ohms min, 50k-ohms max). If the
watchdog timer is enabled (the default),
these pins are also tristated after an interruption of communication
between Machinekit and the board. The watchdog timer takes approximately
6.5ms to activate. However, software bugs in the pluto_servo firmware
or Machinekit can leave the Pluto-P pins in an undefined state.</p>
</li>
<li>
<p>In pwm+dir mode, by default dir is HIGH for negative values and LOW
for positive values. To select HIGH for positive values and LOW for
negative values, set the corresponding dout-NN-invert parameter TRUE to
invert the signal.</p>
</li>
<li>
<p>The index input is triggered on the rising edge. Initial testing has
shown that the QZx inputs are particularly noise sensitive, due to
being polled every 25ns. Digital filtering has been added to filter
pulses shorter than 175ns (seven polling times). Additional external
filtering on all input pins, such as a Schmitt buffer or inverter, RC
filter, or differential receiver (if applicable) is recommended.</p>
</li>
<li>
<p>The IN1…IN7 pins have 22-ohm series resistors to their associated FPGA
pins. No other pins have any sort of protection for out-of-spec
voltages or currents. It is up to the integrator to add appropriate
isolation and protection. Traditional parallel port optoisolator boards
do not work with pluto_servo due to the bidirectional nature of the EPP
protocol.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="led">LED</h4>
<div class="ulist">
<ul>
<li>
<p>When the device is unprogrammed, the LED glows faintly. When the
device is programmed, the LED glows according to the duty cycle of PWM0
('LED' = 'UP0' 'xor' 'DOWN0') or STEPGEN0 ('LED' = 'STEP0' 'xor'
'DIR0').</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="power">Power</h4>
<div class="ulist">
<ul>
<li>
<p>A small amount of current may be drawn from VCC. The available current
depends on the unregulated DC input to the board. Alternately,
regulated +3.3VDC may be supplied to the FPGA through these VCC pins.
The required current is not yet known, but is probably around 50mA plus
I/O current.</p>
</li>
<li>
<p>The regulator on the Pluto-P board is a low-dropout type. Supplying 5V
at the power jack will allow the regulator to work properly.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="pc-interface">PC interface</h4>
<div class="ulist">
<ul>
<li>
<p>Only a single pluto_servo or pluto_step board is supported.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="rebuilding-the-fpga-firmware">Rebuilding the FPGA firmware</h4>
<div class="paragraph">
<p>The 'src/hal/drivers/pluto_servo_firmware/' and
'src/hal/drivers/pluto_step_firmware/'  subdirectories contain the
Verilog source code plus additional files
used by Quartus for the FPGA firmwares. Altera&#8217;s Quartus II software is
required to rebuild the FPGA firmware. To rebuild the firmware from the
 .hdl and other source files, open the '.qpf' file and press CTRL-L.
Then, recompile Machinekit.</p>
</div>
<div class="paragraph">
<p>Like the HAL hardware driver, the FPGA firmware is licensed under the
terms of the GNU General Public License.</p>
</div>
<div class="paragraph">
<p>The gratis version of Quartus II runs only on Microsoft Windows,
although there is apparently a paid version that runs on Linux.</p>
</div>
</div>
<div class="sect3">
<h4 id="for-more-information">For more information</h4>
<div class="paragraph">
<p>Some additional information about it is available from
<a href="http://www.knjn.com/FPGA-Parallel.html">KNJC LLC</a>
and from <a href="http://emergent.unpy.net/01165081407">the developer&#8217;s blog</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pluto-servo-a-id-sec-pluto-servo-a">Pluto Servo<a id="sec:pluto-servo"></a></h3>
<div class="paragraph">
<p>The pluto_servo system is suitable for control of a 4-axis CNC mill
with servo motors, a 3-axis mill with PWM spindle control, a lathe with
spindle encoder, etc. The large number of inputs allows a full set of
limit switches.</p>
</div>
<div class="paragraph">
<p>This driver features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>4 quadrature channels with 40MHz sample rate. The counters operate in
'4x' mode. The maximum useful quadrature rate is 8191 counts per Machinekit
servo cycle, or about 8MHz for Machinekit&#8217;s default 1ms servo rate.</p>
</li>
<li>
<p>4 PWM channels, 'up/down' or 'pwm+dir' style. 4095 duty cycles from
-100% to +100%, including 0%. The PWM period is approximately 19.5kHz
(40MHz / 2047). A PDM-like mode is also available.</p>
</li>
<li>
<p>18 digital outputs: 10 dedicated, 8 shared with PWM functions.
(Example: A lathe with unidirectional PWM spindle control may use 13
total digital outputs)</p>
</li>
<li>
<p>20 digital inputs: 8 dedicated, 12 shared with Quadrature functions.
(Example: A lathe with index pulse only on the spindle may use 13 total
digital inputs)</p>
</li>
<li>
<p>EPP communication with the PC. The EPP communication typically takes
around 100 us on machines tested so far, enabling servo rates above
1kHz.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="pinout">Pinout</h4>
<div class="ulist">
<ul>
<li>
<p>'UPx' - The 'up' (up/down mode) or 'pwm' (pwm+direction mode) signal from PWM
generator X. May be used as a digital output if the corresponding PWM
channel is unused, or the output on the channel is always negative. The
corresponding digital output invert may be set to TRUE to make UPx
active low rather than active high.</p>
</li>
<li>
<p>'DNx' - The 'down' (up/down mode) or 'direction' (pwm+direction mode) signal
from PWM generator X. May be used as a digital output if the
corresponding PWM channel is unused, or the output on the channel is
never negative. The corresponding digital ouput invert may be set to
TRUE to make DNx active low rather than active high.</p>
</li>
<li>
<p>'QAx, QBx' - The A and B signals for Quadrature counter X. May be used as a digital
input if the corresponding quadrature channel is unused.</p>
</li>
<li>
<p>'QZx' - The Z (index) signal for quadrature counter X. May be used as a
digital input if the index feature of the corresponding quadrature
channel is unused.</p>
</li>
<li>
<p>'INx' - Dedicated digital input #x</p>
</li>
<li>
<p>'OUTx' - Dedicated digital output #x</p>
</li>
<li>
<p>'GND' - Ground</p>
</li>
<li>
<p>'VCC' - +3.3V regulated DC</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../drivers/images/pluto-pinout.png" alt="pluto pinout">
</div>
<div class="title">Figure 26. Pluto-Servo Pinout<a id="fig:Pluto-Servo-Pinout"></a></div>
</div>
<table class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 4. Pluto-Servo Alternate Pin Functions<a id="table:Pluto-Servo-Alternate-Pin"></a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Primary function</th>
<th class="tableblock halign-left valign-top">Alternate Function</th>
<th class="tableblock halign-left valign-top">Behavior if both functions used</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UP0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWM0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When pwm-0-pwmdir is TRUE, this pin is the PWM output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OUT10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XOR&#8217;d with UP0 or PWM0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UP1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWM1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When pwm-1-pwmdir is TRUE, this pin is the PWM output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OUT12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XOR&#8217;d with UP1 or PWM1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UP2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWM2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When pwm-2-pwmdir is TRUE, this pin is the PWM output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OUT14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XOR&#8217;d with UP2 or PWM2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UP3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWM3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When pwm-3-pwmdir is TRUE, this pin is the PWM output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OUT16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XOR&#8217;d with UP3 or PWM3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>DN0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DIR0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When pwm-0-pwmdir is TRUE, this pin is the DIR output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OUT11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XOR&#8217;d with DN0 or DIR0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>DN1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DIR1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When pwm-1-pwmdir is TRUE, this pin is the DIR output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OUT13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XOR&#8217;d with DN1 or DIR1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>DN2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DIR2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When pwm-2-pwmdir is TRUE, this pin is the DIR output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OUT15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XOR&#8217;d with DN2 or DIR2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>DN3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DIR3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When pwm-3-pwmdir is TRUE, this pin is the DIR output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OUT17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XOR&#8217;d with DN3 or DIR3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>QZ0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IN8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read same value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>QZ1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IN9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read same value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>QZ2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IN10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read same value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>QZ3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IN11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read same value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>QA0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IN12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read same value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>QA1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IN13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read same value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>QA2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IN14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read same value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>QA3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IN15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read same value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>QB0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IN16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read same value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>QB1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IN17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read same value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>QB2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IN18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read same value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>QB3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IN19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read same value</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="input-latching-and-output-updating">Input latching and output updating</h4>
<div class="ulist">
<ul>
<li>
<p>PWM duty cycles for each channel are updated at different times.</p>
</li>
<li>
<p>Digital outputs OUT0 through OUT9 are all updated at the same time.
Digital outputs OUT10 through OUT17 are updated at the same time as the
pwm function they are shared with.</p>
</li>
<li>
<p>Digital inputs IN0 through IN19 are all latched at the same time.</p>
</li>
<li>
<p>Quadrature positions for each channel are latched at different times.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="hal-functions-pins-and-parameters">HAL Functions, Pins and Parameters</h4>
<div class="paragraph">
<p>A list of all 'loadrt' arguments, HAL function names, pin names and
parameter names is in the manual page, 'pluto_servo.9'.</p>
</div>
</div>
<div class="sect3">
<h4 id="compatible-driver-hardware">Compatible driver hardware</h4>
<div class="paragraph">
<p>A schematic for a 2A, 2-axis PWM servo amplifier board is available from the
(<a href="http://emergent.unpy.net/projects/01148303608">the software developer</a>).
The L298 H-Bridge can be used for motors up to 4A (one motor per
L298) or up to 2A (two motors per L298) with the supply voltage up to
46V. However, the L298 does not have built-in current limiting, a
problem for motors with high stall currents. For higher currents and
voltages, some users have reported success with International
Rectifier&#8217;s integrated high-side/low-side drivers.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pluto-step-a-id-sec-pluto-step-hardware-step-a">Pluto Step<a id="sec:Pluto-step:-Hardware-step"></a></h3>
<div class="paragraph">
<p>Pluto-step is suitable for control of a 3- or 4-axis CNC mill with
stepper motors. The large number of inputs allows for a full set of
limit switches.</p>
</div>
<div class="paragraph">
<p>The board features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>4 'step+direction' channels with 312.5kHz maximum step rate,
programmable step length, space, and direction change times</p>
</li>
<li>
<p>14 dedicated digital outputs</p>
</li>
<li>
<p>16 dedicated digital inputs</p>
</li>
<li>
<p>EPP communication with the PC</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="pinout-2">Pinout</h4>
<div class="ulist">
<ul>
<li>
<p>'STEPx' - The 'step' (clock) output of stepgen channel 'x'</p>
</li>
<li>
<p>'DIRx' - The 'direction' output of stepgen channel 'x'</p>
</li>
<li>
<p>'INx' - Dedicated digital input #x</p>
</li>
<li>
<p>'OUTx' - Dedicated digital output #x</p>
</li>
<li>
<p>'GND' - Ground</p>
</li>
<li>
<p>'VCC' - +3.3V regulated DC</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While the 'extended main connector' has a superset of signals usually
found on a Step &amp; Direction DB25 connector&#8212;&#8203;4 step generators, 9
inputs, and 6 general-purpose outputs&#8212;&#8203;the layout on this header is
different than the layout of a standard 26-pin ribbon cable to DB25
connector.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../drivers/images/pluto-step-pinout.png" alt="pluto step pinout">
</div>
<div class="title">Figure 27. Pluto-Step Pinout<a id="fig:Pluto-Step-Pinout"></a></div>
</div>
</div>
<div class="sect3">
<h4 id="input-latching-and-output-updating-2">Input latching and output updating</h4>
<div class="ulist">
<ul>
<li>
<p>Step frequencies for each channel are updated at different times.</p>
</li>
<li>
<p>Digital outputs are all updated at the same time.</p>
</li>
<li>
<p>Digital inputs are all latched at the same time.</p>
</li>
<li>
<p>Feedback positions for each channel are latched at different times.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="step-waveform-timings">Step Waveform Timings</h4>
<div class="paragraph">
<p>The firmware and driver enforce step length, space, and direction
change times. Timings are rounded up to the next multiple of
1.6μs, with a maximum of 49.6μs. The timings
are the same as for the software stepgen component, except that
'dirhold' and 'dirsetup' have been merged into a single parameter
'dirtime' which should be the maximum of the two, and that the same
step timings are always applied to all channels.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../drivers/images/pluto_step_waveform.png" alt="pluto step waveform">
</div>
<div class="title">Figure 28. Pluto-Step Timings<a id="fig:Pluto-Step-Timings"></a></div>
</div>
</div>
<div class="sect3">
<h4 id="hal-functions-pins-and-parameters-2">HAL Functions, Pins and Parameters</h4>
<div class="paragraph">
<p>A list of all 'loadrt' arguments, HAL function names, pin names and
parameter names is in the manual page, 'pluto_step.9'.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="servo-to-go-driver">Servo To Go Driver</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:servo-to-go-driver"></a> </p>
</div>
<div class="paragraph">
<p>The Servo-To-Go (STG) is one of the first PC motion control cards supported
by Machinekit. It is an ISA card and it exists in different flavors (all
supported by this driver). The board includes up to 8 channels of
quadrature encoder input, 8 channels of analog input and output, 32
bits digital I/O, an interval timer with interrupt and a watchdog. For more
information see the <a href="http://www.servotogo.com/">Servo To Go</a> web page.</p>
</div>
<div class="sect2">
<h3 id="installing-5">Installing</h3>
<div class="listingblock">
<div class="content">
<pre>loadrt hal_stg [base=&lt;address&gt;] [num_chan=&lt;nr&gt;] [dio="&lt;dio-string&gt;"] [model=&lt;model&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>The base address field is optional; if it&#8217;s not provided the driver
attempts to autodetect the board. The num_chan field is used to specify
the number of channels available on the card, if not used the 8 axis
version is assumed. The digital inputs/outputs configuration is
determined by a config string passed to insmod when loading the module.
The format consists of a four character string that sets the direction
of each group of pins. Each character of the direction string is either
"I" or "O". The first character sets the direction of port A (Port A -
DIO.0-7), the next sets port B (Port B - DIO.8-15), the next sets port
C (Port C - DIO.16-23), and the fourth sets port D (Port D -
DIO.24-31). The model field can be used in case the driver doesn&#8217;t
autodetect the right card version.</p>
</div>
<div class="paragraph">
<p>hint: after starting up the driver, 'dmesg' can be consulted for
messages relevant to the driver (e.g. autodetected version number and
base address). For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt hal_stg base=0x300 num_chan=4 dio="IOIO"</pre>
</div>
</div>
<div class="paragraph">
<p>This example installs the STG driver for a card found at the base
address of 0x300, 4 channels of encoder feedback, DACs and ADCs,
along with 32 bits of I/O configured like this: the first 8 (Port A)
configured as Input, the next 8 (Port B) configured as Output, the next
8 (Port C) configured as Input, and the last 8 (Port D) configured as
Output</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt hal_stg</pre>
</div>
</div>
<div class="paragraph">
<p>This example installs the driver and attempts to autodetect the board
address and board model, it installs 8 axes by default along with a
standard I/O setup: Port A &amp; B configured as Input, Port C &amp; D
configured as Output.</p>
</div>
</div>
<div class="sect2">
<h3 id="pins-17">Pins</h3>
<div class="ulist">
<ul>
<li>
<p>'stg.&lt;channel&gt;.counts' - (s32) Tracks the counted encoder ticks.</p>
</li>
<li>
<p>'stg.&lt;channel&gt;.position' - (float) Outputs a converted position.</p>
</li>
<li>
<p>'stg.&lt;channel&gt;.dac-value' - (float) Drives the voltage for the
corresponding DAC.</p>
</li>
<li>
<p>'stg.&lt;channel&gt;.adc-value' - (float) Tracks the measured voltage from the
corresponding ADC.</p>
</li>
<li>
<p>'stg.in-&lt;pinnum&gt;' - (bit) Tracks a physical input pin.</p>
</li>
<li>
<p>'stg.in-&lt;pinnum&gt;-not' - (bit) Tracks a physical input pin, but inverted.</p>
</li>
<li>
<p>'stg.out-&lt;pinnum&gt;' - (bit) Drives a physical output pin</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For each pin, &lt;channel&gt; is the axis number, and &lt;pinnum&gt; is the logic
pin number of the STG if <code>IIOO</code> is defined, there are 16 input pins (in-00
.. in-15) and 16 output pins (out-00 .. out-15), and they correspond to
PORTs ABCD (in-00 is PORTA.0, out-15 is PORTD.7).</p>
</div>
<div class="paragraph">
<p>The in-&lt;pinnum&gt; HAL pin is TRUE if the physical pin is high, and FALSE if the
physical pin is low. The in-&lt;pinnum&gt;-not HAL pin is inverted&#8201;&#8212;&#8201;it is
FALSE if the physical pin is high. By connecting a signal to one or the
other, the user can determine the state of the input.</p>
</div>
</div>
<div class="sect2">
<h3 id="parameters-17">Parameters</h3>
<div class="ulist">
<ul>
<li>
<p>'stg.&lt;channel&gt;.position-scale' - (float) The number of counts / user unit
(to convert from counts to units).</p>
</li>
<li>
<p>'stg.&lt;channel&gt;.dac-offset' - (float) Sets the offset for the corresponding
DAC.</p>
</li>
<li>
<p>'stg.&lt;channel&gt;.dac-gain' - (float) Sets the gain of the corresponding DAC.</p>
</li>
<li>
<p>'stg.&lt;channel&gt;.adc-offset' - (float) Sets the offset of the corresponding
ADC.</p>
</li>
<li>
<p>'stg.&lt;channel&gt;.adc-gain' - (float) Sets the gain of the corresponding ADC.</p>
</li>
<li>
<p>'stg.out-&lt;pinnum&gt;-invert' - (bit) Inverts an output pin.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The -invert parameter determines whether an output pin is active high
or active low. If -invert is FALSE, setting the HAL out- pin TRUE
drives the physical pin high, and FALSE drives it low. If -invert is
TRUE, then setting the HAL out- pin TRUE will drive the physical pin
low.</p>
</div>
<div class="sect3">
<h4 id="functions-10">Functions</h4>
<div class="ulist">
<ul>
<li>
<p>'stg.capture-position' - Reads the encoder counters from the axis
&lt;channel&gt;.</p>
</li>
<li>
<p>'stg.write-dacs' - Writes the voltages to the DACs.</p>
</li>
<li>
<p>'stg.read-adcs' - Reads the voltages from the ADCs.</p>
</li>
<li>
<p>'stg.di-read' - Reads physical in- pins of all ports and updates
all HAL in-&lt;pinnum&gt; and in-&lt;pinnum&gt;-not pins.</p>
</li>
<li>
<p>'stg.do-write' - Reads all HAL out-&lt;pinnum&gt; pins and updates all
physical output pins.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="general-mechatronics-driver">General Mechatronics Driver</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="cha:gm-driver"></a> </p>
</div>
<div class="paragraph">
<p>General Mechatronics GM6-PCI card based motion control system</p>
</div>
<div class="paragraph">
<p>For detailed description, please refer to the <a href="http://www.generalmechatronics.com/data/products/robot_controller/PCI_UserManual_eng.pdf">System integration manual</a>.</p>
</div>
<div class="paragraph">
<p>The GM6-PCI motion control card is based on an FPGA and a PCI bridge
interface ASIC. A small automated manufacturing cell can be controlled,
with a short time system integration procedure. The following figure
demonstrating the typical connection of devices related to the control
system:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It can control up to six axis, each can be stepper or CAN bus
interface or analogue servo.</p>
</li>
<li>
<p>GPIO: Four time eight I/O pins are placed on standard flat cable headers.</p>
</li>
<li>
<p>RS485 I/O expander modules: RS485 bus was designed for interfacing
with compact DIN-rail mounted expander modules. An 8-channel digital input,
an 8-channel relay output and an analogue I/O (4x +/-10 Volts output and 8x
+/-5 Volts input) modules are available now. Up to 16 modules can be
connected to the bus altogether.</p>
</li>
<li>
<p>20 optically isolated input pins: Six times three for the direct
connection of two end switch and one homing sensor for each axis. And
additionally, two optically isolated E-stop inputs.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../drivers/images/GMsystem.png" alt="GM servo control system">
</div>
</div>
<div class="paragraph">
<p>Installing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loadrt hal_gm</pre>
</div>
</div>
<div class="paragraph">
<p>During loading (or attempted loading) the driver prints some useful
debugging messages to the kernel log, which can be viewed with dmesg.</p>
</div>
<div class="paragraph">
<p>Up to 3 boards may be used in one system.</p>
</div>
<div class="paragraph">
<p>The following connectors can be found on the GM6-PCI card:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../drivers/images/GM_PCIpinout.png" alt="GM PCIpinout">
</div>
<div class="title">Figure 29. GM6-PCI card connectors and LEDs<a id="fig:PCI-card-connectors"></a></div>
</div>
<div class="sect2">
<h3 id="i-o-connectors">I/O connectors</h3>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../drivers/images/GM_IOpinout.png" alt="GM IOpinout">
</div>
<div class="title">Figure 30. Pin numbering of GPIO connectors<a id="fig:pin-numbering-gpio"></a></div>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<caption class="title">Table 5. Pinout of GPIO connectors<a id="table:gpio-pinout"></a></caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">9</th>
<th class="tableblock halign-center valign-top">7</th>
<th class="tableblock halign-center valign-top">5</th>
<th class="tableblock halign-center valign-top">3</th>
<th class="tableblock halign-center valign-top">1</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">IOx/7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">IOx/5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">IOx/3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">IOx/1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">VCC</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">10</th>
<th class="tableblock halign-center valign-top">8</th>
<th class="tableblock halign-center valign-top">6</th>
<th class="tableblock halign-center valign-top">4</th>
<th class="tableblock halign-center valign-top">2</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">GND</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">IOx/6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">IOx/4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">IOx/2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">IOx/0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each pin can be configured as digital input or output.
GM6-PCI motion control card has 4 general purpose I/O
(GPIO) connectors, with eight configurable I/O on each.
Every GPIO pin and parameter name begins as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr. of card&gt;.gpio.&lt;nr of gpio con&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>,where &lt;nr of gpio con&gt; is form 0 to 3. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.0.gpio.0.in-0</pre>
</div>
</div>
<div class="paragraph">
<p>indicates the state of the first pin of the first GPIO
connector on the GM6-PCI card. Hal pins are updated by function</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr of card&gt;.read</pre>
</div>
</div>
<div class="sect3">
<h4 id="pins-18">Pins</h4>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 6. GPIO pins<a id="table:gpio-pins"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pins</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Pin description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.in-&lt;0-7&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input pin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.in-not-&lt;0-7&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Negated input pin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.out-&lt;0-7&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, In)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output pin. Used only when GPIO is set to output.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="parameters-18">Parameters</h4>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 7. GPIO parameters<a id="table:gpio-parameters"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pins</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Parameter description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.is-out-&lt;0-7&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When True, the corresponding GPIO is set to totem-pole output, other wise set to high impedance input.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.invert-out-&lt;0-7&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When True, pin value will be inverted. Used when pin is configured as output.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="axis-connectors">Axis connectors</h3>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../drivers/images/GM_AXISpinout.png" alt="GM AXISpinout">
</div>
<div class="title">Figure 31. Pin numbering of axis connectors<a id="fig:pin-numbering-axis"></a></div>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<caption class="title">Table 8. Pinout of axis connectors<a id="table:axis-pinout"></a></caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encoder A</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+5 Volt (PC)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encoder B</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encoder Index</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fault</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Power Enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Step/CCW/B</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direction/CW/A</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ground (PC)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAC serial line</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="axis-interface-modules">Axis interface modules</h4>
<div class="paragraph">
<p>Small sized DIN rail mounted interface modules gives easy way of connecting
different types of servo modules to the axis connectors.
Seven different system configurations are presented in the
<a href="http://www.generalmechatronics.com/data/products/robot_controller/PCI_UserManual_eng.pdf">System integration manual</a>
for evaluating typical applications. Also the detailed description of the
Axis modules can be found in the System integration manual.</p>
</div>
<div class="paragraph">
<p>For evaluating the appropriate servo-drive structure the modules
have to be connected as the following block diagram shows:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../drivers/images/GM_AxisInterface.png" alt="GM AxisInterface">
</div>
<div class="title">Figure 32. Servo axis interfaces<a id="fig:axis-iterface"></a></div>
</div>
</div>
<div class="sect3">
<h4 id="encoder-2">Encoder</h4>
<div class="paragraph">
<p>The GM6-PCI motion control card has six encoder modules.
Each encoder module has three channels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Channel-A</p>
</li>
<li>
<p>Channel-B</p>
</li>
<li>
<p>Channel-I (index)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is able to count quadrature encoder signals or step/dir signals.
Each encoder module is connected to the inputs of the corresponding
RJ50 axis connector.</p>
</div>
<div class="paragraph">
<p>Every encoder pin and parameter name begins as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr. of card&gt;.encoder.&lt;nr of axis&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>,where &lt;nr of axis&gt; is form 0 to 5. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.0.encoder.0.position</pre>
</div>
</div>
<div class="paragraph">
<p>refers to the position of encoder module of axis 0.</p>
</div>
<div class="paragraph">
<p>The GM6-PCI card counts the encoder signal independently from Machinekit.
Hal pins are updated by function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr of card&gt;.read</pre>
</div>
</div>
<div class="sect4">
<h5 id="pins-19">Pins</h5>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 9. Encoder pins<a id="table:encoder-pins"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pins</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Pin description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.reset</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, In)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When True, resets counts and position to zero.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.rawcounts</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(s32, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The raw count is the counts, but unaffected by reset or the index pulse.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.counts</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(s32, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Position in encoder counts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.position</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Position in scaled units (=.counts/.position-scale).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.index-enabled</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, IO)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When True, counts and position are rounded or reset
                                            (depends on index-mode) on next rising edge of channel-I.
											Every time position is reset because of Index, index-enabled
											pin is set to 0 and remain 0 until connected hal pin does
											not set it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.velocity</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Velocity in scaled units per second. GM encoder uses high
                                            frequency hardware timer to measure time between encoder
											pulses in order to calculate velocity. It greatly reduces
											quantization noise as compared to simply differentiating
											the position output. When the measured velocity is below
											min-velocity-estimate, the velocity output is 0.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="parameters-19">Parameters</h5>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 10. Encoder parameters<a id="table:encoder-parameters"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameters</th>
<th class="tableblock halign-center valign-top">Type and Read/Write</th>
<th class="tableblock halign-left valign-top">Parameter description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.counter-mode</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When True, the counter counts each rising edge of the
                                              channel-A input to the direction determined by channel-B.
			 	 							  This is useful for counting the output of a single channel
			 								  (non-quadrature) or step/dir signal sensor. When false, it
											  counts in quadrature mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.index-mode</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When True and .index-enabled is also true, .counts and
                                              .position are rounded (based on .counts-per-rev) at rising
											  edge of channel-I. This is useful to correct few pulses
											  error caused by noise. In round mode, it is essential to
											  set .counts-per-rev parameter correctly. When .index-mode
											  is False and .index-enabled is true, .counts and .position
											  are reset at channel-I pulse.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.counts-per-rev</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(s32, R/V)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determine how many counts are between two index pulses. It
                                              is used only in round mode, so when both .index-enabled and
											  .index-mode parameters are True. GM encoder process encoder signal
											  in 4x mode, so for example in case of a 500 CPR encoder it should
											  be set to 2000. This parameter can be easily measured by setting
											  .index-enabled True and .index-mode False (so that .counts resets
											  at channel-I pulse), than move axis by hand and see the maximum
						    				  magnitude of .counts pin in halmeter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.index-invert</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When True, channel-I event (reset or round) occur on falling
                                              edge of channel-I signal, otherwise on rising edge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.min-speed-estimate</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determine the minimum measured velocity magnitude at which
                                              .velocity will be set as nonzero. Setting this parameter too
											  low will cause it to take a long time for velocity to go to zero
											  after encoder pulses have stopped arriving.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.position-scale</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scale in counts per length unit. .position=.counts/.position-scale.
                                              For example, if position-scale is 2000, then 1000 counts of the
											  encoder will produce a position of 0.5 units.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="hal-example-2">HAL example</h5>
<div class="paragraph">
<p>Setting encoder module of axis 0 to receive 500 CPR quadrature encoder signal and use reset to round position.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>setp gm.0.encoder.0.counter-mode 0         # 0: quad, 1: stepDir
setp gm.0.encoder.0.index-mode 1           # 0: reset pos at index, 1:round pos at index
setp gm.0.encoder.0.counts-per-rev 2000      # GM process encoder in 4x mode, 4x500=2000
setp gm.0.encoder.0.index-invert 0
setp gm.0.encoder.0.min-speed-estimate 0.1 # in position unit/s
setp gm.0.encoder.0.position-scale 20000   # 10 encoder rev cause the machine to
                                             move one position unit (10x2000)</pre>
</div>
</div>
<div class="paragraph">
<p>Connect encoder position to Machinekit position feedback:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>net Xpos-fb gm.0.encoder.0.position =&gt; axis.0.motor-pos-fb</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="stepgen-module">Stepgen module</h4>
<div class="paragraph">
<p>The GM6-PCI motion control card has six stepgen modules, one for each axis.
Each module has two output signals. It can produce Step/Direction,
Up/Down or Quadrature (A/B) pulses. Each stepgen module is connected
to the pins of the corresponding RJ50 axis connector.</p>
</div>
<div class="paragraph">
<p>Every stepgen pin and parameter name begins as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr. of card&gt;.stepgen.&lt;nr of axis&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>,where nr of axis is form 0 to 5. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.0.stepgen.0.position-cmd</pre>
</div>
</div>
<div class="paragraph">
<p>refers to the position command of stepgen module of axis 0 on card 0.</p>
</div>
<div class="paragraph">
<p>The GM6-PCI card generates step pulses independently from Machinekit.
Hal pins are updated by function</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr of card&gt;.write</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="sect4">
<h5 id="pins-20">Pins</h5>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 11. Stepgen module pins<a id="table:stepgen-pins"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pins</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Pin description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.enable</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, In)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stepgen produces pulses only when this pin is true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.count-fb</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(s32, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Position feedback in counts unit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.position-fb</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Position feedback in position unit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.position-cmd</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, In)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Commanded position in position units. Used in position mode only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.velocity-cmd</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, In)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Commanded velocity in position units per second. Used in velocity mode only.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="parameters-20">Parameters</h5>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 12. Stepgen module parameters<a id="table:stepgen-parameters"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameters</th>
<th class="tableblock halign-center valign-top">Type and Read/Write</th>
<th class="tableblock halign-left valign-top">Parameter description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.step-type</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(u32, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When 0, module produces Step/Dir signal. When 1, it
                                             produces Up/Down step signals. And when it is 2, it
											 produces quadrature output signals.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.control-type</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When True, .velocity-cmd is used as reference and velocity
                                             control calculate pulse rate output. When False, .position-cmd
											 is used as reference and position control calculate pulse rate output.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.invert-step1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invert the output of channel 1 (Step signal in StepDir mode)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.invert-step2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invert the output of channel 2 (Dir signal in StepDir mode)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.maxvel</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum velocity in position units per second. If it is set to 0.0,
                                             .maxvel parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.maxaccel</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum acceleration in position units per second squared. If
                                             it is set to 0.0, .maxaccel parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.position-scale</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scale in steps per length unit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.steplen</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(u32, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Length of step pulse in nano-seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.stepspace</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(u32, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum time between two step pulses in nano-seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.dirdelay</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(u32, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum time between step pulse and direction change in nano-seconds.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>For evaluating the appropriate values see the timing diagrams below:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../drivers/images/GM_RefSignals.png" alt="GM RefSignals">
</div>
<div class="title">Figure 33. Reference signal timing diagrams<a id="fig:refsig-timing-diagram"></a></div>
</div>
</div>
<div class="sect4">
<h5 id="hal-example-3">HAL example</h5>
<div class="paragraph">
<p>Setting stepgen module of axis 0 to generate 1000 step pulse per position unit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>setp gm.0.stepgen.0.step-type 0         # 0:stepDir, 1:UpDown, 2:Quad
setp gm.0.stepgen.0.control-type 0      # 0:Pos. control, 1:Vel. Control
setp gm.0.stepgen.0.invert-step1 0
setp gm.0.stepgen.0.invert-step2 0
setp gm.0.stepgen.0.maxvel 0            # do not set maxvel for step
                                        # generator, let interpolator control it.
setp gm.0.stepgen.0.maxaccel 0          # do not set max acceleration for
                                        # step generator, let interpolator control it.
setp gm.0.stepgen.0.position-scale 1000 # 1000 step/position unit
setp gm.0.stepgen.0.steplen 1000        # 1000 ns = 1 us
setp gm.0.stepgen.0.stepspace1000       # 1000 ns = 1 us
setp gm.0.stepgen.0.dirdelay 2000       # 2000 ns = 2 us</pre>
</div>
</div>
<div class="paragraph">
<p>Connect stepgen to axis 0 position reference and enable pins:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>net Xpos-cmd axis.0.motor-pos-cmd =&gt; gm.0.stepgen.0.position-cmd
net Xen axis.0.amp-enable-out =&gt; gm.0.stepgen.0.enable</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enable-and-fault-signals">Enable and Fault signals</h4>
<div class="paragraph">
<p>The GM6-PCI motion control card has one enable output and one fault
input HAL pins, both are connected to each RJ50 axis connector
and to the CAN connector.</p>
</div>
<div class="paragraph">
<p>Hal pins are updated by function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr of card&gt;.read</pre>
</div>
</div>
<div class="sect4">
<h5 id="pins-21">Pins</h5>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 13. Enable and Fault signal pins<a id="table:enable-pins"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pins</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Pin description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gm.&lt;nr of card&gt;.power-enable</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, In)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this pin is True,
</p><p class="tableblock">                                                      * and Watch Dog Timer is not expired
                                                      * and there is no power fault
                                                      Then power enable pins of axis- and CAN connectors
													  are set to high, otherwise set to low.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gm.&lt;nr of card&gt;.power-fault</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Power fault input.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="axis-dac">Axis DAC</h4>
<div class="paragraph">
<p>The GM6-PCI motion control card has six serial axis DAC driver modules,
one for each axis. Each module is connected to the pin of the
corresponding RJ50 axis connector.
Every axis DAC pin and parameter name begins as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr. of card&gt;.dac.&lt;nr of axis&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>,where nr of axis is form 0 to 5. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.0.dac.0.value</pre>
</div>
</div>
<div class="paragraph">
<p>refers to the output voltage of DAC module of axis 0.
Hal pins are updated by function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr of card&gt;.write</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="sect4">
<h5 id="pins-22">Pins</h5>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 14. Axis DAC pins<a id="table:dac-pins"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pins</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Pin description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.enable</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, In)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable DAC output. When enable is
                                 false, DAC output is 0.0 V.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.value</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, In)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of DAC output in Volts.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="parameters-21">Parameters</h5>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 15. Axis DAC parameters<a id="table:dac-parameters"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameters</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Parameter description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.offset</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Offset is added to the value before
                                        the hardware is updated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.high-limit</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum output voltage of the
                                        hardware in volts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.low-limit</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum output voltage of the
                                        hardware in volts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.invert-serial</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GM6-PCI card is communicating with DAC
                                        hardware via fast serial communication
										to highly reduce time delay compared to
										PWM. DAC module is recommended to be
										isolated which is negating serial
										communication line. In case of isolation,
										leave this parameter to default (0),
										while in case of none-isolation, set
										this parameter to 1.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="can-bus-servo-amplifiers">CAN-bus servo amplifiers</h3>
<div class="paragraph">
<p>The GM6-PCI motion control card has CAN module to drive CAN
servo amplifiers. Implementation of higher level protocols
like CANopen is further development. Currently GM produced
power amplifiers has upper level driver which export pins
and parameters to HAL. They receive position reference and
provide encoder feedback via CAN bus.</p>
</div>
<div class="paragraph">
<p>The frames are standard (11 bit) ID frames, with 4 byte data length.
Tha baud rate is 1 Mbit.
The position commad IDs for axis 0..5 are 0x10..0x15.
The position feedback IDs for axis 0..5 are 0x20..0x25.</p>
</div>
<div class="paragraph">
<p>These configuration can be changed with the modifivation
of hal_gm.c and recompiling Machinekit.</p>
</div>
<div class="paragraph">
<p>Every CAN pin and parameter name begins as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr. of card&gt;.can-gm.&lt;nr of axis&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>,where &lt;nr of axis&gt; is form 0 to 5. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.0.can-gm.0.position</pre>
</div>
</div>
<div class="paragraph">
<p>refers to the output position of axis 0 in position units.</p>
</div>
<div class="paragraph">
<p>Hal pins are updated by function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr of card&gt;.write</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="pins-23">Pins</h4>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 16. CAN module pins<a id="table:can-pins"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pins</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Pin description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.enable</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, In)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable sending position references.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.position-cmd</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, In)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Commanded position in position units.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.position-fb</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, In)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feed back position in position units.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="parameters-22">Parameters</h4>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 17. CAN module parameters<a id="table:can-parameters"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameters</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Parameter description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.position-scale</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scale in per length unit.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="watchdog-timer">Watchdog timer</h3>
<div class="paragraph">
<p>Watchdog timer resets at function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr of card&gt;.read</pre>
</div>
</div>
<div class="sect3">
<h4 id="pins-24">Pins</h4>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 18. Watchdog pins<a id="table:watchdog-pins"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pins</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Pin description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gm.&lt;nr of card&gt;.watchdog-expired</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that watchdog timer is expired.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Watchdog timer overrun causes the set of power-enable to low in hardware.</p>
</div>
</div>
<div class="sect3">
<h4 id="parameters-23">Parameters</h4>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 19. Watchdog parameters<a id="table:watchdog-parameters"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameters</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Parameter description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gm.&lt;nr of card&gt;.watchdog-enable</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable watchdog timer.
                                                             It is strongly recommended to
														     enable watchdog timer, because
														     it can disables all the servo
														     amplifiers by pulling down all
														     enable signal in case of PC error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gm.&lt;nr of card&gt;.watchdog-timeout-ns</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time interval in within the
                                                             gm.&lt;nr of card&gt;.read function
															 must be executed. The gm.&lt;nr of card&gt;.read
															 is typically added to servo-thread, so
															 watch timeout is typically set to 3 times
															 of the servo period.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="end-homing-and-e-stop-switches">End-, homing- and E-stop switches</h3>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../drivers/images/GM_ENDSWpinout.png" alt="GM ENDSWpinout">
</div>
<div class="title">Figure 34. Pin numbering of homing &amp; end switch connector<a id="fig:pin-numbering-endsw"></a></div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 20. End- and homing switch connector pinout<a id="table:end-and-homing-switch-connector-pinout"></a></caption>
<colgroup>
<col style="width: 4.1666%;">
<col style="width: 4.1666%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3338%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle"><strong>25</strong></th>
<th class="tableblock halign-center valign-middle"><strong>23</strong></th>
<th class="tableblock halign-center valign-middle"><strong>21</strong></th>
<th class="tableblock halign-center valign-middle"><strong>19</strong></th>
<th class="tableblock halign-center valign-middle"><strong>17</strong></th>
<th class="tableblock halign-center valign-middle"><strong>15</strong></th>
<th class="tableblock halign-center valign-middle"><strong>13</strong></th>
<th class="tableblock halign-center valign-middle"><strong>11</strong></th>
<th class="tableblock halign-center valign-middle"><strong>9</strong></th>
<th class="tableblock halign-center valign-middle"><strong>7</strong></th>
<th class="tableblock halign-center valign-middle"><strong>5</strong></th>
<th class="tableblock halign-center valign-middle"><strong>3</strong></th>
<th class="tableblock halign-center valign-middle"><strong>1</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle" colspan="2"><p class="tableblock">GND</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1/End-</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2/End+</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2/Hom-ing</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">3/End-</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">4/End+</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">4/Hom-ing</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">5/End-</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">6/End+</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">6/Hom-ing</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">E-Stop 2</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">V+ (Ext.)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 4.1666%;">
<col style="width: 4.1666%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3338%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle"><strong>26</strong></th>
<th class="tableblock halign-center valign-middle"><strong>24</strong></th>
<th class="tableblock halign-center valign-middle"><strong>22</strong></th>
<th class="tableblock halign-center valign-middle"><strong>20</strong></th>
<th class="tableblock halign-center valign-middle"><strong>18</strong></th>
<th class="tableblock halign-center valign-middle"><strong>16</strong></th>
<th class="tableblock halign-center valign-middle"><strong>14</strong></th>
<th class="tableblock halign-center valign-middle"><strong>12</strong></th>
<th class="tableblock halign-center valign-middle"><strong>10</strong></th>
<th class="tableblock halign-center valign-middle"><strong>8</strong></th>
<th class="tableblock halign-center valign-middle"><strong>6</strong></th>
<th class="tableblock halign-center valign-middle"><strong>4</strong></th>
<th class="tableblock halign-center valign-middle"><strong>2</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle" colspan="2"><p class="tableblock">GND</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1/End+</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1/Hom-ing</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2/End-</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">3/End+</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">3/Hom-ing</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">4/End-</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">5/End+</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">5/Hom-ing</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">6/End-</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">E-Stop 1</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">V+ (Ext.)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The GM6-PCI motion control card has two limit- and one homing switch input for each axis. All the names of these pins begin as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr. of card&gt;.axis.&lt;nr of axis&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>,where nr of axis is form 0 to 5. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.0.axis.0.home-sw-in</pre>
</div>
</div>
<div class="paragraph">
<p>indicates the state of the axis 0 home switch.</p>
</div>
<div class="paragraph">
<p>Hal pins are updated by function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr of card&gt;.read</pre>
</div>
</div>
<div class="sect3">
<h4 id="pins-25">Pins</h4>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 21. End- and homing switch pins<a id="table:end-and-homing-switch-pins"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pins</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Pin description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.home-sw-in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Home switch input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.home-sw-in-not</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Negated home switch input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.neg-lim-sw-in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Negative limit switch input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.neg-lim-sw-in-not</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Negated negative limit switch input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.pos-lim-sw-in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Positive limit switch input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.pos-lim-sw-in-not</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Negated positive limit switch input</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="parameters-24">Parameters</h4>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 22. E-stop switch parameters<a id="table:e-stop-switch-parameters"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameters</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Parameter description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gm.0.estop.0.in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Estop 0 input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gm.0.estop.0.in-not</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Negated Estop 0 input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gm.0.estop.1.in</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Estop 1 input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gm.0.estop.1.in-not</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Negated Estop 1 input</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="status-leds">Status LEDs</h3>
<div class="sect3">
<h4 id="can">CAN</h4>
<div class="paragraph">
<p>Color: Orange</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Blink, during data communication.</p>
</li>
<li>
<p>On, when any of the buffers are full - communication error.</p>
</li>
<li>
<p>Off, when no data communication.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="rs485">RS485</h4>
<div class="paragraph">
<p>Color: Orange</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Blink, during initialization of modules on the bus</p>
</li>
<li>
<p>On, when the data communication is up between all initialized modules.</p>
</li>
<li>
<p>Off, when any of the initialized modules dropped off because of an error.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="emc">EMC</h4>
<div class="paragraph">
<p>Color: White</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Blink, when Machinekit is running.</p>
</li>
<li>
<p>Otherwise off.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="boot">Boot</h4>
<div class="paragraph">
<p>Color: Green</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On, when system booted successfully.</p>
</li>
<li>
<p>Otherwise off.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="error">Error</h4>
<div class="paragraph">
<p>Color: Red</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Off, when there is no fault in the system.</p>
</li>
<li>
<p>Blink, when PCI communication error.</p>
</li>
<li>
<p>On, when watchdog timer overflowed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rs485-i-o-expander-modules">RS485 I/O expander modules</h3>
<div class="paragraph">
<p>These modules were developed for expanding the I/O and function
capability along an RS485 line of the GM6-PCI motion control card.</p>
</div>
<div class="paragraph">
<p>Available module types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>8-channel relay output module - gives eight NO-NC relay output
on a three pole terminal connector for each channel.</p>
</li>
<li>
<p>8-channel digital input module - gives eight optical
isolated digital input pins.</p>
</li>
<li>
<p>8 channel ADC and 4-channel DAC module - gives four digital-to-analogue
converter outputs and eight analogue-to-digital inputs.
This module is also optically isolated from the GM6-PCI card.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Automatic node recognizing:</strong></p>
</div>
<div class="paragraph">
<p>Each node connected to the bus was recognized by the GM6-PCI card automatically.
During starting Machinekit, the driver export pins and parameters of all
available modules automatically.</p>
</div>
<div class="paragraph">
<p><strong>Fault handling:</strong></p>
</div>
<div class="paragraph">
<p>If a module does not answer regularly the GM6-PCI card drops down the module.
If a module with output do not gets data with correct CRC regularly, the
module switch to error sate (green LED blinking), and turns all outputs
to error sate.</p>
</div>
<div class="paragraph">
<p><strong>Connecting the nodes:</strong></p>
</div>
<div class="paragraph">
<p>The modules on the bus have to be connected in serial topology, with
termination resistors on the end. The start of the topology is the PCI
card, and the end is the last module.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../drivers/images/GM_RS485topology.png" alt="GM RS485topology">
</div>
<div class="title">Figure 35. Connecting the RS485 nodes to the GM6-PCI card<a id="fig:connecting-rs485"></a></div>
</div>
<div class="paragraph">
<p><strong>Adressing:</strong></p>
</div>
<div class="paragraph">
<p>Each node on the bus has a 4 bit unique address that can be set with a red DIP switch.</p>
</div>
<div class="paragraph">
<p><strong>Status LED:</strong></p>
</div>
<div class="paragraph">
<p>A green LED indicates the status of the module:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Blink, when the module is only powered, but not jet identified, or when module is dropped down.</p>
</li>
<li>
<p>Off, during identification (computer is on, but Machinekit not started)</p>
</li>
<li>
<p>On, when it communicates continuously.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="relay-output-module">Relay output module</h4>
<div class="paragraph">
<p>For pinout, connection and electrical charasteristics of the module, please refer to the
<a href="http://www.generalmechatronics.com/data/products/robot_controller/PCI_UserManual_eng.pdf">System integration manual</a>.</p>
</div>
<div class="paragraph">
<p>All the pins and parameters are updated by the following function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr. of card&gt;.rs485</pre>
</div>
</div>
<div class="paragraph">
<p>It should be added to servo thread or other thread with
larger period to avoid CPU overload.
Every RS485 module pin and parameter name begins as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr. of card&gt;.rs485.&lt;modul ID&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>,where &lt;modul ID&gt; is form 00 to 15.</p>
</div>
<div class="sect4">
<h5 id="pins-26">Pins</h5>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 23. Relay output module pins<a id="table:rs485-relay-pins"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pins</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Pin description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.relay-&lt;0-7&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output pin for relay</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="parameters-25">Parameters</h5>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 24. Relay output module parameters<a id="table:rs485-relay-parameters"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameters</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Parameter description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.invert-relay-&lt;0-7&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Negate relay output pin</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="hal-example-4">HAL example</h5>
<div class="listingblock">
<div class="content">
<pre>gm.0.rs485.0.relay-0 # First relay of the node.
gm.0                 # Means the first GM6-PCI motion control card (PCI card address = 0)
.rs485.0             # Select node with address 0 on the RS485 bus
.relay-0             # Select the first relay</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="digital-input-module">Digital input module</h4>
<div class="paragraph">
<p>For pinout, connection and electrical charasteristics of the module, please refer to the
<a href="http://www.generalmechatronics.com/data/products/robot_controller/PCI_UserManual_eng.pdf">System integration manual</a>.</p>
</div>
<div class="paragraph">
<p>All the pins and parameters are updated by the following function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr. of card&gt;.rs485</pre>
</div>
</div>
<div class="paragraph">
<p>It should be added to servo thread or other thread with larger period to avoid CPU overload.
Every RS485 module pin and parameter name begins as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr. of card&gt;.rs485.&lt;modul ID&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>,where &lt;modul ID&gt; is form 00 to 15.</p>
</div>
<div class="sect4">
<h5 id="pins-27">Pins</h5>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 25. Digital input output module pins<a id="table:rs485-input-pins"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pins</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Pin description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.in-&lt;0-7&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input pin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.in-not-&lt;0-7&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Negated input pin</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="hal-example-5">HAL example</h5>
<div class="listingblock">
<div class="content">
<pre>gm.0.rs485.0.in-0 # First input of the node.
# gm.0     - Means the first GM6-PCI motion control card (PCI card address = 0)
# .rs485.0 - Select node with address 0 on the RS485 bus
# .in-0    - Select the first digital input module</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dac-adc-module">DAC &amp; ADC module</h4>
<div class="paragraph">
<p>For pinout, connection and electrical charasteristics of the module, please refer to the
<a href="http://www.generalmechatronics.com/data/products/robot_controller/PCI_UserManual_eng.pdf">System integration manual</a>.</p>
</div>
<div class="paragraph">
<p>All the pins and parameters are updated by the following function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr. of card&gt;.rs485</pre>
</div>
</div>
<div class="paragraph">
<p>It should be added to servo thread or other thread with larger period to avoid CPU overload.
Every RS485 module pin and parameter name begins as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr. of card&gt;.rs485.&lt;modul ID&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>,where &lt;modul ID&gt; is form 00 to 15.</p>
</div>
<div class="sect4">
<h5 id="pins-28">Pins</h5>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 26. DAC &amp; ADC module pins<a id="table:rs485-dacadc-pins"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pins</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Pin description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.adc-&lt;0-7&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of ADC input in Volts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.dac-enable-&lt;0-3&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, In)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable DAC output. When enable is
                                             false DAC output is set to 0.0 V.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.dac-&lt;0-3&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, In)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of DAC output in Volts.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="parameters-26">Parameters</h5>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 27. DAC &amp; ADC module parameters<a id="table:rs485-dacadc-parameters"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameters</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Parameter description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.adc-scale-&lt;0-7&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input voltage will be multiplied by
                                               scale before being output to .adc- pin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.adc-offset-&lt;0-7&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Offset is subtracted from the hardware input
                                               voltage after the scale multiplier has been applied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.dac-offset-&lt;0-3&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Offset is added to the value before the hardware is updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.dac-high-limit-&lt;0-3&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum output voltage of the hardware in volts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.dac-low-limit-&lt;0-3&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum output voltage of the hardware in volts.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="hal-example-6">HAL example</h5>
<div class="listingblock">
<div class="content">
<pre>gm.0.rs485.0.adc-0 # First analogue channel of the node.
# gm.0     - Means the first GM6-PCI motion control card (PCI card address = 0)
# .rs485.0 - Select node with address 0 on the RS485 bus
# .adc-0   - Select the first analogue input of the module</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="teach-pendant-module">Teach Pendant module</h4>
<div class="paragraph">
<p>For pinout, connection and electrical charasteristics of the module, please refer to the
<a href="http://www.generalmechatronics.com/data/products/robot_controller/PCI_UserManual_eng.pdf">System integration manual</a>.</p>
</div>
<div class="paragraph">
<p>All the pins and parameters are updated by the following function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr. of card&gt;.rs485</pre>
</div>
</div>
<div class="paragraph">
<p>It should be added to servo thread or other thread with larger period to avoid CPU overload.
Every RS485 module pin and parameter name begins as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gm.&lt;nr. of card&gt;.rs485.&lt;modul ID&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>,where &lt;modul ID&gt; is form 00 to 15. Note that on the Teach Pendant module it cannot be changed, and pre-programmed as zero. Upon request it can be delivered with firmware pre-programmed different ID.</p>
</div>
<div class="sect4">
<h5 id="pins-29">Pins</h5>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 28. Teach Pendant module pins<a id="table:rs485-teachpendant-pins"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pins</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Pin description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.adc-&lt;0-5&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of ADC input in Volts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.enc-reset</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, In)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When True, resets counts and position to zero.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.enc-counts</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(s32, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Position in encoder counts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.enc-rawcounts</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(s32, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The raw count is the counts, but unaffected by reset.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.enc-position</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Position in scaled units (=.enc-counts/.enc-position-scale).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.in-&lt;0-7&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input pin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.in-not-&lt;0-7&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(bit, Out)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Negated input pin</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="parameters-27">Parameters</h5>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 29. Teach Pendant module parameters<a id="table:rs485-teachpendant-parameters"></a></caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameters</th>
<th class="tableblock halign-center valign-top">Type and direction</th>
<th class="tableblock halign-left valign-top">Parameter description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.adc-scale-&lt;0-5&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input voltage will be multiplied by
                                               scale before being output to .adc- pin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.adc-offset-&lt;0-5&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Offset is subtracted from the hardware input
                                               voltage after the scale multiplier has been applied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.enc-position-scale</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(float, R/W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scale in per length unit.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="hal-example-7">HAL example</h5>
<div class="listingblock">
<div class="content">
<pre>gm.0.rs485.0.adc-0 # First analogue channel of the node.
# gm.0     - Means the first GM6-PCI motion control card (PCI card address = 0)
# .rs485.0 - Select node with address 0 on the RS485 bus
# .adc-0   - Select the first analogue input of the module</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="errata">Errata</h3>
<div class="sect3">
<h4 id="gm6-pci-card-errata">GM6-PCI card Errata</h4>
<div class="paragraph">
<p>The revision number in this section refers to the revision of the GM6-PCI card device.</p>
</div>
<div class="sect4">
<h5 id="rev-1-2">Rev. 1.2</h5>
<div class="ulist">
<ul>
<li>
<p>Error:
The PCI card do not boot, when Axis 1. END B switch is active (low).
Found on November 16, 2013.</p>
</li>
<li>
<p>Reason:
This switch is connected to a boot setting pin of FPGA</p>
</li>
<li>
<p>Problem fix/workaround:
Use other switch pin, or connect only normally open switch to this switch input pin.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. Neutral Message Language provides a mechanism for handling multiple types of messages in the same buffer as well as simplifying the interface for encoding and decoding buffers in neutral format and the configuration mechanism.
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. Run In Place, when the source files have been downloaded to a user directory.
</div>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. One exception to the “channel numbers start at zero” rule is the parallel port. Its HAL pins are numbered with the corresponding pin number on the DB-25 connector. This is convenient for wiring, but inconsistent with other drivers. There is some debate over whether this is a bug or a feature.
</div>
<div class="footnote" id="_footnote_4">
<a href="#_footnoteref_4">4</a>. Note to driver programmers: do NOT implement separate functions for different I/O types unless they are interruptible and can work in independent threads. If interrupting an encoder read, reading digital inputs, and then resuming the encoder read will cause problems, then implement a single function that does everything.
</div>
<div class="footnote" id="_footnote_5">
<a href="#_footnoteref_5">5</a>. In the Machinekit packages for Debian, the file /etc/modprobe.d/emc2 generally prevents 'parport_pc' from being automatically loaded.
</div>
<div class="footnote" id="_footnote_6">
<a href="#_footnoteref_6">6</a>. FF2 is not currently implemented, but it will be added. Consider this note a “FIXME” for the code
</div>
<div class="footnote" id="_footnote_7">
<a href="#_footnoteref_7">7</a>. Each individual filter also has an internal state variable. There is a compile time switch that can export that variable as a parameter. This is intended for testing, and simply wastes shared memory under normal circumstances.
</div>
<div class="footnote" id="_footnote_8">
<a href="#_footnoteref_8">8</a>. Prior to version 2.1, frequency, amplitude, and offset were parameters. They were changed to pins to allow control by other components.
</div>
<div class="footnote" id="_footnote_9">
<a href="#_footnoteref_9">9</a>. The refresh rate of the watch display is much lower than Halmeter or Halscope. If you need good resolution of the timing of signals those tools are much more effective.
</div>
<div class="footnote" id="_footnote_10">
<a href="#_footnoteref_10">10</a>. At present, the firmware supports multi-phase stepper outputs, but the driver doesn&#8217;t. Interested volunteers are solicited.
</div>
</div>
          <div class="section-nav-docs">
  <div class="left align-right">
  </div>
  <div class="right align-left">
  </div>
  <div class="clear"></div>
</div>

        </article>
      </div>

      <div class="unit one-fifth hide-on-mobiles">
  <aside>
    
    <h4>For starters</h4>
    

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="http://test.machinekit.io/docs/index-getting-started/">
	  Getting Started</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="http://test.machinekit.io/docs/index-user/">
	  Machinekit Introduction</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class="current"><a href="http://test.machinekit.io/docs/index-HAL/">
	  Hardware Abstract Layer</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="http://test.machinekit.io/docs/getting-help/">
	  Getting help</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


</ul>

    
    <h4>Developing</h4>
    

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="http://test.machinekit.io/docs/index-integrator/">
	  Integrator Manual</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="http://test.machinekit.io/docs/index-developer/">
	  Developer manual</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="http://test.machinekit.io/docs/documenting/documenting/">
	  Documenting</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="http://test.machinekit.io/docs/developing/develop-index/">
	  Various developing links</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


</ul>

    
    <h4>Manpages</h4>
    

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="http://test.machinekit.io/docs/man/man1/">
	  HAL Utilities and GUIs</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="http://test.machinekit.io/docs/man/man3/">
	  RTAPI and HAL Functions</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="http://test.machinekit.io/docs/man/man9/">
	  HAL Components</a></li>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


</ul>

    
    <sandbox>
    <div class="unit align-left center-on-mobiles">
      <p>
        <a href="http://preview.machinekit.io/docs/sandbox/index.html"> SandBox </a>
      </p>
    </div>
</sandbox>

    <search-bar>
  <div class="grid">
    <div class="unit align-left center-on-mobiles">
      <p>
        <div class="top-search">
        <form method="get" id="searchform" id="searchbox_013132401186084955638:rss8-mkzi3u" action="http://preview.machinekit.io/search-result.html">
        <div>
        <input value="013132401186084955638:rss8-mkzi3u" name="cx" type="hidden"/>
        <input value="FORID:11" name="cof" type="hidden"/>
        Search:<BR>
        <input type="text" value="" name="s" id="s" onfocus="defaultInput(this)" onblur="clearInput(this)" />
        </div>
        </form>
        </div>
      </p>
    </div>
  </div>
</search-bar>

    


<a href=https://github.com/machinekit/machinekit-docs//edit/master/docs/index-HAL.asciidoc>Edit this page</a>




  </aside>
</div>


      <div class="clear"></div>

    </div>
  </section>

  </div>
  <footer>
  <div class="grid">
    <div class="unit two-thirds align-right center-on-mobiles">
      <p>
      </p>
    </div>
  </div>
</footer>

  

</body>
</html>
